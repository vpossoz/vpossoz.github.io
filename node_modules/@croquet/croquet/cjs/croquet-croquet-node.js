/**
 * Copyright Croquet Corporation 2022
 * Bundle of @croquet/croquet
 * Date: 2022-12-19
 * Version: 1.1.0-15
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("stream"),t=require("events"),r=require("http"),s=require("https"),n=require("net"),i=require("tls"),o=require("crypto"),a=require("zlib"),l=require("url"),c=require("node:http"),d=require("node:https"),h=require("node:zlib"),u=require("node:stream"),f=require("node:buffer"),p=require("node:util"),m=require("node:url"),b=require("node:net");function y(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}require("node:fs"),require("node:path");var g=y(e),w=y(t),S=y(r),v=y(s),_=y(n),Z=y(i),X=y(o),L=y(a),x=y(l),T=y(c),G=y(d),k=y(h),R=y(u);if(void 0===globalThis.TextEncoder){globalThis.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t=e.length,r=-1,s="undefined"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),n=0,i=0,o=0;o!==t;){if(n=e.charCodeAt(o),o+=1,n>=55296&&n<=56319){if(o===t){s[r+=1]=239,s[r+=1]=191,s[r+=1]=189;break}if(!((i=e.charCodeAt(o))>=56320&&i<=57343)){s[r+=1]=239,s[r+=1]=191,s[r+=1]=189;continue}if(o+=1,(n=1024*(n-55296)+i-56320+65536)>65535){s[r+=1]=240|n>>>18,s[r+=1]=128|n>>>12&63,s[r+=1]=128|n>>>6&63,s[r+=1]=128|63&n;continue}}n<=127?s[r+=1]=0|n:n<=2047?(s[r+=1]=192|n>>>6,s[r+=1]=128|63&n):(s[r+=1]=224|n>>>12,s[r+=1]=128|n>>>6&63,s[r+=1]=128|63&n)}return"undefined"!=typeof Uint8Array?s.subarray(0,r+1):(s.length=r+1,s)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(od){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}var W="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};!function(e){var t=function(e){var t,r=Object.prototype,s=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",o=n.asyncIterator||"@@asyncIterator",a=n.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,s){var n=t&&t.prototype instanceof b?t:b,i=Object.create(n.prototype),o=new G(s||[]);return i._invoke=function(e,t,r){var s=h;return function(n,i){if(s===f)throw new Error("Generator is already running");if(s===p){if("throw"===n)throw i;return R()}for(r.method=n,r.arg=i;;){var o=r.delegate;if(o){var a=L(o,r);if(a){if(a===m)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(s===h)throw s=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);s=f;var l=d(e,t,r);if("normal"===l.type){if(s=r.done?p:u,l.arg===m)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(s=p,r.method="throw",r.arg=l.arg)}}}(e,r,o),i}function d(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var h="suspendedStart",u="suspendedYield",f="executing",p="completed",m={};function b(){}function y(){}function g(){}var w={};l(w,i,(function(){return this}));var S=Object.getPrototypeOf,v=S&&S(S(k([])));v&&v!==r&&s.call(v,i)&&(w=v);var _=g.prototype=b.prototype=Object.create(w);function Z(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function X(e,t){function r(n,i,o,a){var l=d(e[n],e,i);if("throw"!==l.type){var c=l.arg,h=c.value;return h&&"object"==typeof h&&s.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,a)}),(function(e){r("throw",e,o,a)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,a)}))}a(l.arg)}var n;this._invoke=function(e,s){function i(){return new t((function(t,n){r(e,s,t,n)}))}return n=n?n.then(i,i):i()}}function L(e,r){var s=e.iterator[r.method];if(s===t){if(r.delegate=null,"throw"===r.method){if(e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method))return m;r.method="throw",r.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var n=d(s,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,m;var i=n.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,m):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,m)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function G(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function k(e){if(e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(s.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return y.prototype=g,l(_,"constructor",g),l(g,"constructor",y),y.displayName=l(g,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,a,"GeneratorFunction")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},Z(X.prototype),l(X.prototype,o,(function(){return this})),e.AsyncIterator=X,e.async=function(t,r,s,n,i){void 0===i&&(i=Promise);var o=new X(c(t,r,s,n),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},Z(_),l(_,a,"Generator"),l(_,i,(function(){return this})),l(_,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var s=t.pop();if(s in e)return r.value=s,r.done=!1,r}return r.done=!0,r}},e.values=k,G.prototype={constructor:G,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)"t"===r.charAt(0)&&s.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(s,n){return a.type="throw",a.arg=e,r.next=s,n&&(r.method="next",r.arg=t),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if("throw"===s.type){var n=s.arg;T(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,s){return this.delegate={iterator:k(e),resultName:r,nextLoc:s},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{globalThis.regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}}({exports:{}});const C="node",P="1.1.0-15";function I(e){return"number"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(e))}function V(e,t){return"constructor"===t&&"function"==typeof e[t]||"__proto__"===t}const M=function(e,t){t||(t={});var r={bools:{},strings:{},unknownFn:null};"function"==typeof t.unknown&&(r.unknownFn=t.unknown),"boolean"==typeof t.boolean&&t.boolean?r.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach((function(e){r.bools[e]=!0}));var s={};Object.keys(t.alias||{}).forEach((function(e){s[e]=[].concat(t.alias[e]),s[e].forEach((function(t){s[t]=[e].concat(s[e].filter((function(e){return t!==e})))}))})),[].concat(t.string).filter(Boolean).forEach((function(e){r.strings[e]=!0,s[e]&&(r.strings[s[e]]=!0)}));var n=t.default||{},i={_:[]};Object.keys(r.bools).forEach((function(e){a(e,void 0!==n[e]&&n[e])}));var o=[];function a(e,t,n){if(!n||!r.unknownFn||function(e,t){return r.allBools&&/^--[^=]+$/.test(t)||r.strings[e]||r.bools[e]||s[e]}(e,n)||!1!==r.unknownFn(n)){var o=!r.strings[e]&&I(t)?Number(t):t;l(i,e.split("."),o),(s[e]||[]).forEach((function(e){l(i,e.split("."),o)}))}}function l(e,t,s){for(var n=e,i=0;i<t.length-1;i++){if(V(n,o=t[i]))return;void 0===n[o]&&(n[o]={}),n[o]!==Object.prototype&&n[o]!==Number.prototype&&n[o]!==String.prototype||(n[o]={}),n[o]===Array.prototype&&(n[o]=[]),n=n[o]}var o;V(n,o=t[t.length-1])||(n!==Object.prototype&&n!==Number.prototype&&n!==String.prototype||(n={}),n===Array.prototype&&(n=[]),void 0===n[o]||r.bools[o]||"boolean"==typeof n[o]?n[o]=s:Array.isArray(n[o])?n[o].push(s):n[o]=[n[o],s])}function c(e){return s[e].some((function(e){return r.bools[e]}))}-1!==e.indexOf("--")&&(o=e.slice(e.indexOf("--")+1),e=e.slice(0,e.indexOf("--")));for(var d=0;d<e.length;d++){var h=e[d];if(/^--.+=/.test(h)){var u=h.match(/^--([^=]+)=([\s\S]*)$/),f=u[1],p=u[2];r.bools[f]&&(p="false"!==p),a(f,p,h)}else if(/^--no-.+/.test(h)){a(f=h.match(/^--no-(.+)/)[1],!1,h)}else if(/^--.+/.test(h)){f=h.match(/^--(.+)/)[1];void 0===(g=e[d+1])||/^-/.test(g)||r.bools[f]||r.allBools||s[f]&&c(f)?/^(true|false)$/.test(g)?(a(f,"true"===g,h),d++):a(f,!r.strings[f]||"",h):(a(f,g,h),d++)}else if(/^-[^-]+/.test(h)){for(var m=h.slice(1,-1).split(""),b=!1,y=0;y<m.length;y++){var g;if("-"!==(g=h.slice(y+2))){if(/[A-Za-z]/.test(m[y])&&/=/.test(g)){a(m[y],g.split("=")[1],h),b=!0;break}if(/[A-Za-z]/.test(m[y])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(g)){a(m[y],g,h),b=!0;break}if(m[y+1]&&m[y+1].match(/\W/)){a(m[y],h.slice(y+2),h),b=!0;break}a(m[y],!r.strings[m[y]]||"",h)}else a(m[y],g,h)}f=h.slice(-1)[0];b||"-"===f||(!e[d+1]||/^(-|--)[^-]/.test(e[d+1])||r.bools[f]||s[f]&&c(f)?e[d+1]&&/^(true|false)$/.test(e[d+1])?(a(f,"true"===e[d+1],h),d++):a(f,!r.strings[f]||"",h):(a(f,e[d+1],h),d++))}else if(r.unknownFn&&!1===r.unknownFn(h)||i._.push(r.strings._||!I(h)?h:Number(h)),t.stopEarly){i._.push.apply(i._,e.slice(d+1));break}}return Object.keys(n).forEach((function(e){var t,r,o;t=i,r=e.split("."),o=t,r.slice(0,-1).forEach((function(e){o=o[e]||{}})),r[r.length-1]in o||(l(i,e.split("."),n[e]),(s[e]||[]).forEach((function(t){l(i,t.split("."),n[e])})))})),t["--"]?(i["--"]=new Array,o.forEach((function(e){i["--"].push(e)}))):o.forEach((function(e){i._.push(e)})),i}(process.argv.slice(2));const Y=new class{constructor(){!function(e){for(const t of Object.keys(M)){if("_"===t)continue;let r=M[t];"string"==typeof r&&"["===r[0]&&(r=r.slice(1,-1).split(",")),e[t]=r}}(this)}has(e,t,r){"boolean"!=typeof r&&(r=this.isHost(r));const s=this[e];if("string"!=typeof s)return r;const n=s.split(",");return!0===r&&(t=`no${t}`),t.endsWith("s")&&(t=t.slice(0,-1)),n.includes(t)||n.includes(`${t}s`)?!r:r}isHost(e){return"localhost"===e}isLocalhost(){return this.isHost("localhost")}};var K,E=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r="boolean"==typeof t.cycles&&t.cycles,s=t.cmp&&function(e){return function(t){return function(r,s){var n={key:r,value:t[r]},i={key:s,value:t[s]};return e(n,i)}}}(t.cmp),n=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,o;if(Array.isArray(t)){for(o="[",i=0;i<t.length;i++)i&&(o+=","),o+=e(t[i])||"null";return o+"]"}if(null===t)return"null";if(-1!==n.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=n.push(t)-1,l=Object.keys(t).sort(s&&s(t));for(o="",i=0;i<l.length;i++){var c=l[i],d=e(t[c]);d&&(o&&(o+=","),o+=JSON.stringify(c)+":"+d)}return n.splice(a,1),"{"+o+"}"}}(e)},H={exports:{}},F={exports:{}};F.exports=(K=K||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==W&&W.crypto&&(r=W.crypto),!r)try{r=require("crypto")}catch(e){}var s=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},a=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=a.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,s=this.sigBytes,n=e.sigBytes;if(this.clamp(),s%4)for(var i=0;i<n;i++){var o=r[i>>>2]>>>24-i%4*8&255;t[s+i>>>2]|=o<<24-(s+i)%4*8}else for(var a=0;a<n;a+=4)t[s+a>>>2]=r[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(s());return new l.init(t,e)}}),c=i.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push((i>>>4).toString(16)),s.push((15&i).toString(16))}return s.join("")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s+=2)r[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new l.init(r,t/2)}},h=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s++)r[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new l.init(r,t)}},u=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,s=this._data,n=s.words,i=s.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,d=e.min(4*c,i);if(c){for(var h=0;h<c;h+=o)this._doProcessBlock(n,h);r=n.splice(0,c),s.sigBytes-=d}return new l.init(r,d)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=i.algo={};return i}(Math),K);var z=H.exports=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init,s=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,s=[],n=0;n<t;n++)s[n>>>2]|=e[n]<<24-n%4*8;r.call(this,s,t)}else r.apply(this,arguments)};s.prototype=t}}(),e.lib.WordArray}(F.exports),N={exports:{}},j=N.exports=function(e){return function(t){var r=e,s=r.lib,n=s.WordArray,i=s.Hasher,o=r.algo,a=[],l=[];!function(){function e(e){for(var r=t.sqrt(e),s=2;s<=r;s++)if(!(e%s))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var s=2,n=0;n<64;)e(s)&&(n<8&&(a[n]=r(t.pow(s,.5))),l[n]=r(t.pow(s,1/3)),n++),s++}();var c=[],d=o.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],n=r[1],i=r[2],o=r[3],a=r[4],d=r[5],h=r[6],u=r[7],f=0;f<64;f++){if(f<16)c[f]=0|e[t+f];else{var p=c[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=c[f-2],y=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;c[f]=m+c[f-7]+y+c[f-16]}var g=s&n^s&i^n&i,w=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),S=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[f]+c[f];u=h,h=d,d=a,a=o+S|0,o=i,i=n,n=s,s=S+(w+g)|0}r[0]=r[0]+s|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+a|0,r[5]=r[5]+d|0,r[6]=r[6]+h|0,r[7]=r[7]+u|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return r[n>>>5]|=128<<24-n%32,r[14+(n+64>>>9<<4)]=t.floor(s/4294967296),r[15+(n+64>>>9<<4)]=s,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=i._createHelper(d),r.HmacSHA256=i._createHmacHelper(d)}(Math),e.SHA256}(F.exports);let U;function O(e){const t=e.sigBytes,r=e.words,s=new Uint8Array(t);let n=0,i=0;for(;n<t;){const e=r[i++];if(s[n++]=(4278190080&e)>>>24,n===t)break;if(s[n++]=(16711680&e)>>>16,n===t)break;if(s[n++]=(65280&e)>>>8,n===t)break;s[n++]=255&e}return s}function Q(e){function t(e){const t=e.indexOf("{"),r=e.lastIndexOf("}");if(-1===t||-1===r||r<t)return e;const s=e.slice(0,t).replace(/\s+/g," ").replace(/\s\(/,"("),n=e.slice(t+1,r);return`${s.trim()}{${n.trim()}}`}let r=t(""+e);if(!r.startsWith("class")){const s=e.prototype;s&&(r+=Object.getOwnPropertyNames(s).map((e=>`${e}:${t(""+s[e])}`)).join(""))}return r}function J(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function D(){return Y.has("debug","hashing",!1)}U=globalThis.crypto&&globalThis.crypto.subtle&&"function"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(e,t)=>{if("SHA-256"!==e)throw Error("Croquet: only SHA-256 available");const r=z.create(t);return O(j(r)).buffer};const B={},A=new TextEncoder;async function $(e){const t=A.encode(e),r=await async function(e){return 0===e.length?"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU":J(await U("SHA-256",e))}(t);return D()&&(B[r]={string:e,buffer:t}),r}const q=[],ee={};const te=new Set;const re=require("crypto");function se(e,t={}){return e&&oe.showMessage(e,{...t,level:"warning"})}function ne(e,t={}){return e&&oe.showMessage(e,{...t,level:"status"})}function ie(e,t,r="error"){console.error(`Error during ${e}`,t);const s=(t.stack||"").split("\n").filter((e=>!e.match(/croquet-.*\.min.js/))).join("\n");oe.showMessage(`Error during ${e}: ${t.message}\n\n${s}`,{level:r,duration:"error"===r?1e4:void 0,stopOnFocus:!0})}const oe={sessionURL:null,root:!1,sync:!1,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock(){},makeSessionWidgets(){},makeQRCanvas:()=>null,clearSessionMoniker(){},showSyncWait(e){},messageFunction:function(e,t={}){const r=t.level;console.log(`${"status"===r?"":r+": "} ${e}`)},showMessage:(e,t={})=>Y.nomessages||!1===oe.root||!1===oe.messages||!oe.messageFunction?("warning"===t.level&&console.warn(e),"error"===t.level&&console.error(e),null):oe.messageFunction(e,t),isCroquetHost:e=>e.endsWith("croquet.io")||["localhost","127.0.0.1","[::1]"].includes(e)||e.endsWith("ngrok.io"),referrerURL:()=>"http://localhost/node.html",autoSession(e={key:"q"}){"string"==typeof e&&(e={key:e}),e||(e={});const t=e.key||"q";let r=Y[t]||"";if(r)try{r=decodeURIComponent(r)}catch(e){}else r=Math.floor(Math.random()*36**10).toString(36);Y.has("debug","session")&&console.log(`Croquet.App.autoSession: "${r}"`);const s=Promise.resolve(r);return s[Symbol.toPrimitive]=()=>(console.warn("Deprecated: Croquet.App.autoSession() return value used directly. It returns a promise now!"),r),s},autoPassword(e={key:"pw"}){const t=e.key||"pw";let r=Y[t]||"";if(!r){const e=re.randomBytes(16);r=J(e)}Y.has("debug","session")&&console.log(`Croquet.App.autoPassword: "${r}"`);const s=Promise.resolve(r);return s[Symbol.toPrimitive]=()=>(console.warn("Deprecated: Croquet.App.autoPassword() return value used directly. It returns a promise now!"),r),s}};globalThis.crypto||(globalThis.crypto=require("crypto"));function ae(e,t,r=null){function s(e){for(const s of e)(null!==r&&s.unbound===r||null===r&&s.for===t)&&e.delete(s)}return s(e.immediate),s(e.oncePerFrame),s(e.oncePerFrameWhileSynced),s(e.queued),e.immediate.size+e.queued.size+e.oncePerFrame.size+e.oncePerFrameWhileSynced.size}const le=new class{constructor(){this.subscriptions={},this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.id=function(){const e=()=>crypto.randomBytes(1)[0];return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^e()&15>>t/4).toString(16)))}(),this.lastId=0}register(e){return"V"+ ++this.lastId}deregister(e){}addSubscription(e,t,r,s,n){if("vote"===n)return void this.addSubscription(e,t+"#__vote",r,s,"immediate");const i=e+":"+t,o=s;o.for=r;let a=this.subscriptions[i];if(a||(a=this.subscriptions[i]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[n])throw Error(`Unknown subscribe() option: handling="${n}"`);a[n].add(o)}removeSubscription(e,t,r,s=null){const n=e+":"+t,i=this.subscriptions[n];if(i){0===ae(i,r,s)&&delete this.subscriptions[n]}t.endsWith("#__vote")||this.removeSubscription(e,t+"#__vote",r)}removeAllSubscriptionsFor(e){const t=`${e}:`;for(const[r,s]of Object.entries(this.subscriptions))if(r.startsWith(t))delete this.subscriptions[r];else{0===ae(s,e)&&delete this.subscriptions[r]}}handleEvent(e,t,r=(e=>e())){const s=this.subscriptions[e];s&&(s.queued.size>0&&this.queuedEvents.push({topic:e,data:t}),s.oncePerFrame.size>0&&this.perFrameEvents.set(e,t),s.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(e,t),s.immediate.size>0&&r((()=>{for(const r of s.immediate)try{r(t)}catch(t){console.error(t),console.warn(`Croquet: error "${t.message}" in "immediate" subscription ${e}`)}})))}processFrameEvents(e,t){let r=0;const s=(e,t,s)=>{const n=this.subscriptions[e];if(n)for(const i of n[s]){try{i(t)}catch(t){console.error(t),console.warn(`Croquet: error "${t.message}" in "${s}" subscription ${e}`)}r++}};for(const{topic:e,data:t}of this.queuedEvents)s(e,t,"queued");if(this.queuedEvents.length=0,e){for(const[e,t]of this.perFrameEvents)s(e,t,"oncePerFrame");if(this.perFrameEvents.clear(),t){for(const[e,t]of this.perSyncedFrameEvents)s(e,t,"oncePerFrameWhileSynced");this.perSyncedFrameEvents.clear()}for(const{topic:e,data:t}of this.queuedEvents)s(e,t,"queued");this.queuedEvents.length=0}return r}};let ce={get subscribe(){return ce={subscribe:Y.has("debug","subscribe",!1)},ce.subscribe}};class de{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,r){this.vm.publishFromModel(r,e,t)}subscribe(e,t,r,s){return ce.subscribe&&console.log(`Model.subscribe("${t}:${r}", ${e} ${(""+s).replace(/\([\s\S]*/,"")})`),this.vm.addSubscription(e,t,r,s)}unsubscribe(e,t,r,s="*"){ce.subscribe&&console.log(`Model.unsubscribe(${t}:${r}", ${e} ${(""+s).replace(/\([\s\S]*/,"")})`),this.vm.removeSubscription(e,t,r,s)}unsubscribeAll(e){ce.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,r,s){if(ue&&ue.equal(this))return this.vm.future(e,t,r,s);throw Error(`Model.future() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof de&&e.vm===this.vm}isViewRealm(){return!1}}class he{constructor(e){this.vm=e}register(e){return le.register(e)}deregister(e){le.deregister(e)}publish(e,t,r){this.vm.publishFromView(r,e,t)}subscribe(e,t,r,s,n="queued"){ce.subscribe&&console.log(`View.subscribe("${s}:${e}", ${t} ${r?r.name||(""+r).replace(/\([\s\S]*/,""):""+r} [${n}])`),le.addSubscription(s,e,t,r,n)}unsubscribe(e,t,r=null,s){ce.subscribe&&console.log(`View.unsubscribe("${s}:${e}", ${t} ${r?r.name||(""+r).replace(/\([\s\S]*/,""):"*"})`),le.removeSubscription(s,e,t,r)}unsubscribeAll(e){ce.subscribe&&console.log(`View.unsubscribeAll(${e})`),le.removeAllSubscriptionsFor(e)}future(e,t){const r=this.vm;return new Proxy(e,{get(s,n){if("function"==typeof e[n]){return new Proxy(e[n],{apply(s,i,o){setTimeout((()=>{e.id&&me(r,(()=>e[n](...o)),!0)}),t)}})}throw Error("Tried to call "+n+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.vm.controller.reflectorTime}extrapolatedNow(){return this.vm.controller.extrapolatedTime}isSynced(){return!!this.vm.controller.synced}equal(e){return e instanceof he&&e.vm===this.vm}isViewRealm(){return!0}}let ue=null;function fe(e="Tried to execute code that requires realm outside of realm."){if(!ue&&e)throw Error(e);return ue}function pe(e,t){if(null!==ue)throw Error("Can't switch realms from inside realm");try{return ue=new de(e),t()}finally{ue=null}}function me(e,t,r=!1){if(null!==ue&&!r)throw Error("Can't switch realms from inside realm");const s=ue;try{return ue=new he(e),t()}finally{ue=s}}var be={exports:{}};!function(e){!function(t,r,s){var n,i=256,o=s.pow(i,6),a=s.pow(2,52),l=2*a,c=255;function d(e,c,d){var b=[],y=p(f((c=1==c?{entropy:!0}:c||{}).entropy?[e,m(r)]:null==e?function(){try{var e;return n&&(e=n.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),m(e)}catch(e){var s=t.navigator,o=s&&s.plugins;return[+new Date,t,o,t.screen,m(r)]}}():e,3),b),g=new h(b),w=function(){for(var e=g.g(6),t=o,r=0;e<a;)e=(e+r)*i,t*=i,r=g.g(1);for(;e>=l;)e/=2,t/=2,r>>>=1;return(e+r)/t};return w.int32=function(){return 0|g.g(4)},w.quick=function(){return g.g(4)/4294967296},w.double=w,p(m(g.S),r),(c.pass||d||function(e,t,r,n){return n&&(n.S&&u(n,g),e.state=function(){return u(g,{})}),r?(s.random=e,t):e})(w,y,"global"in c?c.global:this==s,c.state)}function h(e){var t,r=e.length,s=this,n=0,o=s.i=s.j=0,a=s.S=[];for(r||(e=[r++]);n<i;)a[n]=n++;for(n=0;n<i;n++)a[n]=a[o=c&o+e[n%r]+(t=a[n])],a[o]=t;(s.g=function(e){for(var t,r=0,n=s.i,o=s.j,a=s.S;e--;)t=a[n=c&n+1],r=r*i+a[c&(a[n]=a[o=c&o+t])+(a[o]=t)];return s.i=n,s.j=o,r})(i)}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var r,s=[],n=typeof e;if(t&&"object"==n)for(r in e)try{s.push(f(e[r],t-1))}catch(e){}return s.length?s:"string"==n?e:e+"\0"}function p(e,t){for(var r,s=e+"",n=0;n<s.length;)t[c&n]=c&(r^=19*t[c&n])+s.charCodeAt(n++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(p(s.random(),r),e.exports){e.exports=d;try{n=require("crypto")}catch(e){}}else s.seedrandom=d}("undefined"!=typeof self?self:W,[],Math)}(be);var ye=be.exports;var ge=function(e){return e!=e},we=ge,Se=Math.sqrt,ve=.7853981633974483;var _e=function(e){var t,r;return 0===e?.16666666666666713:((e<0?-e:e)<=1?(t=e*(19.562619833175948+e*(e*(5.444622390564711+e*(.004253011369004428*e-.6019598008014124))-16.262479672107002))-8.198089802484825,r=e*(139.51056146574857+e*(e*(70.49610280856842+e*(1*e-14.740913729888538))-147.1791292232726))-49.18853881490881):(t=.004253011369004428+(e=1/e)*(e*(5.444622390564711+e*(e*(19.562619833175948+-8.198089802484825*e)-16.262479672107002))-.6019598008014124),r=1+e*(e*(70.49610280856842+e*(e*(139.51056146574857+-49.18853881490881*e)-147.1791292232726))-14.740913729888538)),t/r)};var Ze=function(e){var t,r;return 0===e?.08333333333333809:((e<0?-e:e)<=1?(t=28.536655482610616+e*(e*(6.968710824104713+e*(.002967721961301243*e-.5634242780008963))-25.56901049652825),r=342.43986579130785+e*(e*(147.0656354026815+e*(1*e-21.947795316429207))-383.8770957603691)):(t=.002967721961301243+(e=1/e)*(e*(6.968710824104713+e*(28.536655482610616*e-25.56901049652825))-.5634242780008963),r=1+e*(e*(147.0656354026815+e*(342.43986579130785*e-383.8770957603691))-21.947795316429207)),t/r)};var Xe=function(e){var t,r,s,n,i;if(we(e))return NaN;if(e>0?s=e:(t=!0,s=-e),s>1)return NaN;if(s>.625)n=(r=1-s)*Ze(r),r=Se(r+r),i=ve-r,i-=r=r*n-6123233995736766e-32,i+=ve;else{if(s<1e-8)return e;i=s*(i=(r=s*s)*_e(r))+s}return t?-i:i},Le=Xe;var xe=function(e){var t;return we(e)||e<-1||e>1?NaN:e>.5?2*Le(Se(.5-.5*e)):(t=ve-Le(e),t+=6123233995736766e-32,t+=ve)},Te=xe;var Ge=function(){return"function"==typeof Symbol&&"symbol"==typeof Symbol("foo")}();var ke=function(){return Ge&&"symbol"==typeof Symbol.toStringTag},Re=Object.prototype.toString;var We=function(e){return Re.call(e)},Ce=Object.prototype.hasOwnProperty;var Pe=function(e,t){return null!=e&&Ce.call(e,t)},Ie="function"==typeof Symbol?Symbol.toStringTag:"";var Ve=function(e){var t,r,s;if(null==e)return Re.call(e);r=e[Ie],t=Pe(e,Ie);try{e[Ie]=void 0}catch(t){return Re.call(e)}return s=Re.call(e),t?e[Ie]=r:delete e[Ie],s},Me=ke()?Ve:We,Ye="function"==typeof Uint32Array;var Ke=function(e){return Ye&&e instanceof Uint32Array||"[object Uint32Array]"===Me(e)},Ee="function"==typeof Uint32Array?Uint32Array:null;var He=function(){var e,t;if("function"!=typeof Ee)return!1;try{t=new Ee(t=[1,3.14,-3.14,4294967296,4294967297]),e=Ke(t)&&1===t[0]&&3===t[1]&&4294967293===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Fe="function"==typeof Uint32Array?Uint32Array:null;var ze=function(){throw new Error("not implemented")},Ne=He()?Fe:ze,je="function"==typeof Float64Array;var Ue=function(e){return je&&e instanceof Float64Array||"[object Float64Array]"===Me(e)},Oe="function"==typeof Float64Array?Float64Array:null;var Qe=function(){var e,t;if("function"!=typeof Oe)return!1;try{t=new Oe([1,3.14,-3.14,NaN]),e=Ue(t)&&1===t[0]&&3.14===t[1]&&-3.14===t[2]&&t[3]!=t[3]}catch(t){e=!1}return e},Je="function"==typeof Float64Array?Float64Array:null;var De=function(){throw new Error("not implemented")},Be=Qe()?Je:De,Ae="function"==typeof Uint8Array;var $e=function(e){return Ae&&e instanceof Uint8Array||"[object Uint8Array]"===Me(e)},qe="function"==typeof Uint8Array?Uint8Array:null;var et=function(){var e,t;if("function"!=typeof qe)return!1;try{t=new qe(t=[1,3.14,-3.14,256,257]),e=$e(t)&&1===t[0]&&3===t[1]&&253===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},tt="function"==typeof Uint8Array?Uint8Array:null;var rt=function(){throw new Error("not implemented")},st=et()?tt:rt,nt="function"==typeof Uint16Array;var it=function(e){return nt&&e instanceof Uint16Array||"[object Uint16Array]"===Me(e)},ot="function"==typeof Uint16Array?Uint16Array:null;var at=function(){var e,t;if("function"!=typeof ot)return!1;try{t=new ot(t=[1,3.14,-3.14,65536,65537]),e=it(t)&&1===t[0]&&3===t[1]&&65533===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},lt="function"==typeof Uint16Array?Uint16Array:null;var ct,dt=function(){throw new Error("not implemented")},ht={uint16:at()?lt:dt,uint8:st};(ct=new ht.uint16(1))[0]=4660;var ut=52===new ht.uint8(ct.buffer)[0],ft=!0===ut?1:0,pt=new Be(1),mt=new Ne(pt.buffer);var bt=function(e){return pt[0]=e,mt[ft]},yt=bt,gt=!0===ut?1:0,wt=new Be(1),St=new Ne(wt.buffer);var vt=function(e,t){return wt[0]=e,St[gt]=t>>>0,wt[0]},_t=vt,Zt=Number.POSITIVE_INFINITY,Xt=Number.NEGATIVE_INFINITY;var Lt=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.3999999999940942+e*(.2857142874366239+e*(.22222198432149784+e*(.1818357216161805+e*(.15313837699209373+.14798198605116586*e)))))},xt=.6931471803691238,Tt=1.9082149292705877e-10;var Gt=function(e){var t,r,s,n,i,o,a,l,c,d;if(e<-1||we(e))return NaN;if(-1===e)return Xt;if(e===Zt)return e;if(0===e)return e;if(d=1,(s=e<0?-e:e)<.41421356237309503){if(s<1.862645149230957e-9)return s<5551115123125783e-32?e:e-e*e*.5;e>-.2928932188134525&&(d=0,n=e,r=1)}return 0!==d&&(s<9007199254740992?(i=(d=((r=yt(c=1+e))>>20)-1023)>0?1-(c-e):e-(c-1),i/=c):(d=((r=yt(c=e))>>20)-1023,i=0),(r&=1048575)<434334?c=_t(c,1072693248|r):(d+=1,c=_t(c,1071644672|r),r=1048576-r>>2),n=c-1),t=.5*n*n,0===r?0===n?d*xt+(i+=d*Tt):d*xt-((l=t*(1-.6666666666666666*n))-(d*Tt+i)-n):(l=(a=(o=n/(2+n))*o)*Lt(a),0===d?n-(t-o*(t+l)):d*xt-(t-(o*(t+l)+(d*Tt+i))-n))},kt=Gt,Rt=.6931471805599453;var Wt=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var Ct=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},Pt=.6931471803691238,It=1.9082149292705877e-10;var Vt=function(e){var t,r,s,n,i,o,a,l,c,d,h;return 0===e?Xt:we(e)||e<0?NaN:(n=0,(r=yt(e))<1048576&&(n-=54,r=yt(e*=0x40000000000000)),r>=2146435072?e+e:(n+=(r>>20)-1023|0,n+=(a=(r&=1048575)+614244&1048576|0)>>20|0,o=(e=_t(e,r|1072693248^a))-1,(1048575&2+r)<3?0===o?0===n?0:n*Pt+n*It:(i=o*o*(.5-.3333333333333333*o),0===n?o-i:n*Pt-(i-n*It-o)):(a=r-398458|0,l=440401-r|0,s=(d=(h=(c=o/(2+o))*c)*h)*Wt(d),i=h*Ct(d)+s,(a|=l)>0?(t=.5*o*o,0===n?o-(t-c*(t+i)):n*Pt-(t-(c*(t+i)+n*It)-o)):0===n?o-c*(o-i):n*Pt-(c*(o-i)-n*It-o))))},Mt=Vt;var Yt=function(e){var t;return we(e)||e<1?NaN:1===e?0:e>=268435456?Mt(e)+Rt:e>2?Mt(2*e-1/(e+Se(e*e-1))):kt((t=e-1)+Se(2*t+t*t))},Kt=Yt;var Et=function(e){return e===Zt||e===Xt},Ht=Et;var Ft=function(e){var t,r,s;return we(e)||Ht(e)?e:(e<0&&(e=-e,t=!0),s=e<3.725290298461914e-9?e:e>268435456?Mt(e)+Rt:e>2?Mt(2*e+1/(Se(e*e+1)+e)):kt(e+(r=e*e)/(1+Se(1+r))),t?-s:s)},zt=Ft,Nt=1.5707963267948966;var jt=function(e){return 0===e?-64.85021904942025:e*(e*(e*(-.8750608600031904*e-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var Ut=function(e){return 0===e?194.5506571482614:194.5506571482614+e*(485.3903996359137+e*(432.88106049129027+e*(165.02700983169885+e*(24.858464901423062+1*e))))};var Ot=function(e){var t,r,s,n;return we(e)||0===e?e:e===Zt?Nt:e===Xt?-Nt:(e<0&&(r=!0,e=-e),t=0,e>2.414213562373095?(s=Nt,t=1,e=-1/e):e<=.66?s=0:(s=ve,t=2,e=(e-1)/(e+1)),n=e*(n=(n=e*e)*jt(n)/Ut(n))+e,2===t?n+=3061616997868383e-32:1===t&&(n+=6123233995736766e-32),s+=n,r?-s:s)},Qt=Ot;var Jt,Dt,Bt=function(e){var t,r;return we(e)||e<-1||e>1?NaN:1===e?Zt:-1===e?Xt:(e<0&&(t=!0,e=-e),e<3.725290298461914e-9?t?-e:e:(r=e<.5?.5*kt((r=e+e)+r*e/(1-e)):.5*kt((e+e)/(1-e)),t?-r:r))},At=Bt;!0===ut?(Jt=1,Dt=0):(Jt=0,Dt=1);var $t={HIGH:Jt,LOW:Dt},qt=new Be(1),er=new Ne(qt.buffer),tr=$t.HIGH,rr=$t.LOW;var sr=function(e,t){return qt[0]=t,e[0]=er[tr],e[1]=er[rr],e};var nr,ir,or=function(e,t){return 1===arguments.length?sr([0,0],e):sr(e,t)},ar=or;!0===ut?(nr=1,ir=0):(nr=0,ir=1);var lr={HIGH:nr,LOW:ir},cr=new Be(1),dr=new Ne(cr.buffer),hr=lr.HIGH,ur=lr.LOW;var fr=function(e,t){return dr[hr]=e,dr[ur]=t,cr[0]},pr=fr,mr=[0,0];var br=function(e,t){var r,s;return ar(mr,e),r=mr[0],r&=2147483647,s=yt(t),pr(r|=s&=2147483648,mr[1])},yr=br;var gr=function(e){return!!(yt(e)>>>31)},wr=gr,Sr=3.141592653589793;var vr=function(e,t){var r;return we(t)||we(e)?NaN:Ht(t)?t===Zt?Ht(e)?yr(Sr/4,e):yr(0,e):Ht(e)?yr(3*Sr/4,e):yr(Sr,e):Ht(e)?yr(Sr/2,e):0===e?t>=0&&!wr(t)?yr(0,e):yr(Sr,e):0===t?yr(Sr/2,e):(r=Qt(e/t),t<0?r<=0?r+Sr:r-Sr:r)},_r=vr,Zr=22250738585072014e-324;var Xr=function(e){return 0===e?1.87595182427177:1.87595182427177+e*(e*(1.6214297201053545+e*(.14599619288661245*e-.758397934778766))-1.8849797954337717)};var Lr=function(e){var t,r,s,n,i;return we(e)||Ht(e)||0===e?e:(r=-2147483648&(s=yt(e)),s&=2147483647,i=0,e<Zr?(i=0x40000000000000,t=yt(i*=e),i=pr(r|(t=(2147483647&t)/3+696219795),0)):i=_t(i,r|(t=s/3+715094163)),i*=Xr(n=i*i*(i/e)),t=yt(i),i=pr(t+1,0),i+=i*(n=((n=e/(i*i))-i)/(i+i+n)))},xr=Lr;var Tr=function(e){return 0===e?.0416666666666666:.0416666666666666+e*(2480158728947673e-20*e-.001388888888887411)};var Gr=function(e){return 0===e?-2.7557314351390663e-7:e*(2.087572321298175e-9+-11359647557788195e-27*e)-2.7557314351390663e-7};var kr=function(e,t){var r,s,n,i;return n=(i=e*e)*i,s=i*Tr(i),s+=n*n*Gr(i),(n=1-(r=.5*i))+(1-n-r+(i*s-e*t))},Rr=kr,Wr=-.16666666666666632;var Cr=function(e,t){var r,s,n;return r=.00833333333332249+(n=e*e)*(27557313707070068e-22*n-.0001984126982985795)+n*(n*n)*(1.58969099521155e-10*n-2.5050760253406863e-8),s=n*e,0===t?e+s*(Wr+n*r):e-(n*(.5*t-s*r)-t-s*Wr)},Pr=Cr,Ir=!0===ut?0:1,Vr=new Be(1),Mr=new Ne(Vr.buffer);var Yr=function(e){return Vr[0]=e,Mr[Ir]},Kr=Yr,Er=Math.floor;var Hr=function(e){return e<0?-e:0===e?0:e},Fr=Hr;var zr=function(e,t){return we(t)||Ht(t)?(e[0]=t,e[1]=0,e):0!==t&&Fr(t)<Zr?(e[0]=4503599627370496*t,e[1]=-52,e):(e[0]=t,e[1]=0,e)};var Nr=function(e,t){return 1===arguments.length?zr([0,0],e):zr(e,t)},jr=Nr;var Ur=function(e){var t=yt(e);return(t=(2146435072&t)>>>20)-1023|0},Or=Ur,Qr=[0,0],Jr=[0,0];var Dr=function(e,t){var r,s;return 0===e||we(e)||Ht(e)?e:(jr(Qr,e),t+=Qr[1],(t+=Or(e=Qr[0]))<-1074?yr(0,e):t>1023?e<0?Xt:Zt:(t<=-1023?(t+=52,s=2220446049250313e-31):s=1,ar(Jr,e),r=Jr[0],r&=2148532223,s*pr(r|=t+1023<<20,Jr[1])))},Br=Dr,Ar=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],$r=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],qr=5.960464477539063e-8,es=ns(new Array(20)),ts=ns(new Array(20)),rs=ns(new Array(20)),ss=ns(new Array(20));function ns(e){var t,r=e.length;for(t=0;t<r;t++)e[t]=0;return e}function is(e,t,r,s,n,i,o,a,l){var c,d,h,u,f,p,m,b,y;for(u=i,y=s[r],b=r,f=0;b>0;f++)d=qr*y|0,ss[f]=y-16777216*d|0,y=s[b-1]+d,b-=1;if(y=Br(y,n),y-=8*Er(.125*y),y-=m=0|y,h=0,n>0?(m+=f=ss[r-1]>>24-n,ss[r-1]-=f<<24-n,h=ss[r-1]>>23-n):0===n?h=ss[r-1]>>23:y>=.5&&(h=2),h>0){for(m+=1,c=0,f=0;f<r;f++)b=ss[f],0===c?0!==b&&(c=1,ss[f]=16777216-b):ss[f]=16777215-b;if(n>0)switch(n){case 1:ss[r-1]&=8388607;break;case 2:ss[r-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=Br(1,n)))}if(0===y){for(b=0,f=r-1;f>=i;f--)b|=ss[f];if(0===b){for(p=1;0===ss[i-p];p++);for(f=r+1;f<=r+p;f++){for(l[a+f]=Ar[o+f],d=0,b=0;b<=a;b++)d+=e[b]*l[a+(f-b)];s[f]=d}return is(e,t,r+=p,s,n,i,o,a,l)}}if(0===y)for(r-=1,n-=24;0===ss[r];)r-=1,n-=24;else(y=Br(y,-n))>=16777216?(d=qr*y|0,ss[r]=y-16777216*d|0,n+=24,ss[r+=1]=d):ss[r]=0|y;for(d=Br(1,n),f=r;f>=0;f--)s[f]=d*ss[f],d*=qr;for(f=r;f>=0;f--){for(d=0,p=0;p<=u&&p<=r-f;p++)d+=$r[p]*s[f+p];rs[r-f]=d}for(d=0,f=r;f>=0;f--)d+=rs[f];for(t[0]=0===h?d:-d,d=rs[0]-d,f=1;f<=r;f++)d+=rs[f];return t[1]=0===h?d:-d,7&m}var os=function(e,t,r,s){var n,i,o,a,l,c,d;for(4,(i=(r-3)/24|0)<0&&(i=0),a=r-24*(i+1),c=i-(o=s-1),d=o+4,l=0;l<=d;l++)es[l]=c<0?0:Ar[c],c+=1;for(l=0;l<=4;l++){for(n=0,c=0;c<=o;c++)n+=e[c]*es[o+(l-c)];ts[l]=n}return 4,is(e,t,4,ts,a,4,i,o,es)},as=Math.round;var ls=function(e,t,r){var s,n,i,o,a;return i=e-1.5707963267341256*(s=as(.6366197723675814*e)),o=6077100506506192e-26*s,a=t>>20|0,r[0]=i-o,a-(yt(r[0])>>20&2047)>16&&(o=20222662487959506e-37*s-((n=i)-(i=n-(o=6077100506303966e-26*s))-o),r[0]=i-o,a-(yt(r[0])>>20&2047)>49&&(o=84784276603689e-45*s-((n=i)-(i=n-(o=20222662487111665e-37*s))-o),r[0]=i-o)),r[1]=i-r[0]-o,s},cs=1.5707963267341256,ds=6077100506506192e-26,hs=2*ds,us=4*ds,fs=new Array(3),ps=new Array(2);var ms=function(e,t){var r,s,n,i,o,a,l;if((n=2147483647&yt(e)|0)<=1072243195)return t[0]=e,t[1]=0,0;if(n<=1074752122)return 598523==(1048575&n)?ls(e,n,t):n<=1073928572?e>0?(l=e-cs,t[0]=l-ds,t[1]=l-t[0]-ds,1):(l=e+cs,t[0]=l+ds,t[1]=l-t[0]+ds,-1):e>0?(l=e-2*cs,t[0]=l-hs,t[1]=l-t[0]-hs,2):(l=e+2*cs,t[0]=l+hs,t[1]=l-t[0]+hs,-2);if(n<=1075594811)return n<=1075183036?1074977148===n?ls(e,n,t):e>0?(l=e-3*cs,t[0]=l-1.8231301519518578e-10,t[1]=l-t[0]-1.8231301519518578e-10,3):(l=e+3*cs,t[0]=l+1.8231301519518578e-10,t[1]=l-t[0]+1.8231301519518578e-10,-3):1075388923===n?ls(e,n,t):e>0?(l=e-4*cs,t[0]=l-us,t[1]=l-t[0]-us,4):(l=e+4*cs,t[0]=l+us,t[1]=l-t[0]+us,-4);if(n<1094263291)return ls(e,n,t);if(n>=2146435072)return t[0]=NaN,t[1]=NaN,0;for(r=Kr(e),l=pr(n-((s=(n>>20)-1046)<<20|0),r),o=0;o<2;o++)fs[o]=0|l,l=16777216*(l-fs[o]);for(fs[2]=l,i=3;0===fs[i-1];)i-=1;return a=os(fs,ps,s,i),e<0?(t[0]=-ps[0],t[1]=-ps[1],-a):(t[0]=ps[0],t[1]=ps[1],a)},bs=ms,ys=[0,0];var gs=function(e){var t;if(t=yt(e),(t&=2147483647)<=1072243195)return t<1044381696?1:Rr(e,0);if(t>=2146435072)return NaN;switch(3&bs(e,ys)){case 0:return Rr(ys[0],ys[1]);case 1:return-Pr(ys[0],ys[1]);case 2:return-Rr(ys[0],ys[1]);default:return Pr(ys[0],ys[1])}},ws=gs,Ss=Math.ceil;var vs=function(e){return e<0?Ss(e):Er(e)},_s=vs;var Zs=function(e){return 0===e?.16666666666666602:.16666666666666602+e*(e*(6613756321437934e-20+e*(4.1381367970572385e-8*e-16533902205465252e-22))-.0027777777777015593)};var Xs=function(e,t,r){var s,n,i;return i=(s=e-t)-(n=s*s)*Zs(n),Br(1-(t-s*i/(2-i)-e),r)};var Ls=function(e){var t;return we(e)||e===Zt?e:e===Xt?0:e>709.782712893384?Zt:e<-745.1332191019411?0:e>-3.725290298461914e-9&&e<3.725290298461914e-9?1+e:(t=_s(e<0?1.4426950408889634*e-.5:1.4426950408889634*e+.5),Xs(e-.6931471803691238*t,1.9082149292705877e-10*t,t))},xs=Ls;var Ts=function(e){return we(e)?e:(e<0&&(e=-e),e>21?xs(e)/2:(xs(e)+xs(-e))/2)},Gs=Ts;var ks=function(e){return 0===e?-.03333333333333313:e*(.0015873015872548146+e*(e*(4008217827329362e-21+-2.0109921818362437e-7*e)-793650757867488e-19))-.03333333333333313},Rs=.6931471803691238,Ws=1.9082149292705877e-10;var Cs=function(e){var t,r,s,n,i,o,a,l,c,d,h,u;if(e===Zt||we(e))return e;if(e===Xt)return-1;if(0===e)return e;if(e<0?(r=!0,a=-e):(r=!1,a=e),a>=38.816242111356935){if(r)return-1;if(a>=709.782712893384)return Zt}if(i=0|yt(a),a>.34657359027997264)a<1.0397207708399179?r?(s=e+Rs,n=-Ws,u=-1):(s=e-Rs,n=Ws,u=1):(u=r?1.4426950408889634*e-.5:1.4426950408889634*e+.5,s=e-(d=u|=0)*Rs,n=d*Ws),c=s-(e=s-n)-n;else{if(i<1016070144)return e;u=0}return h=(l=e*(t=.5*e))*(((o=1+l*ks(l))-(d=3-o*t))/(6-e*d)),0===u?e-(e*h-l):(h=e*(h-c)-c,h-=l,-1===u?.5*(e-h)-.5:1===u?e<-.25?-2*(h-(e+.5)):1+2*(e-h):u<=-2||u>56?(s=yt(a=1-(h-e))+(u<<20)|0,(a=_t(a,s))-1):(d=1,u<20?a=(d=_t(d,s=1072693248-(2097152>>u)|0))-(h-e):(a=e-(h+(d=_t(d,s=1023-u<<20|0))),a+=1),s=yt(a)+(u<<20)|0,_t(a,s)))},Ps=Cs,Is=!0===ut?0:1,Vs=new Be(1),Ms=new Ne(Vs.buffer);var Ys=function(e,t){return Vs[0]=e,Ms[Is]=t>>>0,Vs[0]},Ks=Ys;var Es=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var Hs=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))};var Fs=function(e){var t,r,s,n,i,o,a,l,c,d;return n=e-1,(1048575&2+(s=yt(e)))<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(s&=1048575)-398458|0,d=440401-s|0,r=(l=(o=(i=n/(2+n))*i)*o)*Es(l),a=o*Hs(l)+r,(c|=d)>0?i*((t=.5*n*n)+a)-t:i*(a-n))};var zs=function(e){var t,r,s,n,i,o,a;return we(e)||e<0?NaN:0===e?Xt:(i=0,(r=yt(e))<1048576&&(i-=54,r=yt(e*=0x40000000000000)),r>=2146435072?e+e:(i+=(r>>20)-1023|0,e=_t(e,(r&=1048575)|1072693248^(n=r+614244&1048576|0)),o=i+=n>>20|0,s=Fs(e),a=3694239077158931e-28*o+25082946711645275e-27*((e-=1)+s),(a+=.4342944818781689*(e-(t=Ks(e,0))+s)+.4342944818781689*t)+.30102999566361177*o))},Ns=zs;var js=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var Us=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))};var Os=function(e){var t,r,s,n,i,o,a,l,c,d;return n=e-1,(1048575&2+(s=yt(e)))<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(s&=1048575)-398458|0,d=440401-s|0,r=(l=(o=(i=n/(2+n))*i)*o)*js(l),a=o*Us(l)+r,(c|=d)>0?i*((t=.5*n*n)+a)-t:i*(a-n))},Qs=[0,0];var Js=function(e){var t,r,s,n,i;if(we(e)||e<0)return NaN;if(ar(Qs,e),i=0,(r=Qs[0])<1048576){if(0==(2147483647&r|Qs[1]))return Xt;i-=54,r=yt(e*=0x40000000000000)}return r>=2146435072?e+e:(i+=(r>>20)-1023|0,e=_t(e,(r&=1048575)|1072693248^(n=r+614244&1048576|0)),i+=n>>20|0,s=Os(e),1.6751713164886512e-10*((e-=1)+s)+1.4426950407214463*(e-(t=Ks(e,0))+s)+1.4426950407214463*t+i)},Ds=Js,Bs=[0,0];var As=function(e){var t;if(t=yt(e),(t&=2147483647)<=1072243195)return t<1045430272?e:Pr(e,0);if(t>=2146435072)return NaN;switch(3&bs(e,Bs)){case 0:return Pr(Bs[0],Bs[1]);case 1:return Rr(Bs[0],Bs[1]);case 2:return-Pr(Bs[0],Bs[1]);default:return-Rr(Bs[0],Bs[1])}},$s=As;var qs=function(e){var t,r;return 0===e?.16666666666666666:((e<0?-e:e)<=1?(t=e*(e*(-.789474443963537*e-163.72585752598383)-11561.443576500522)-351754.9648081514,r=e*(36157.827983443196+e*(1*e-277.7110814206028))-2110529.7888489086):(t=(e=1/e)*(e*(-351754.9648081514*e-11561.443576500522)-163.72585752598383)-.789474443963537,r=1+e*(e*(36157.827983443196+-2110529.7888489086*e)-277.7110814206028)),t/r)};var en=function(e){var t;return 0===e?e:(t=Fr(e),e>710.4758600739439||e<-709.089565712824?e>0?Zt:Xt:t>1?t>=709.0895657128241?(t=xs(.5*t),t*=.5*t,e<0&&(t=-t),t):(t=.5*(t=xs(t))-.5/t,e<0&&(t=-t),t):e+e*(t*=t)*qs(t))},tn=en;var rn=function(e){return 0===e?.13333333333320124:.13333333333320124+e*(.021869488294859542+e*(.0035920791075913124+e*(.0005880412408202641+e*(7817944429395571e-20+-18558637485527546e-21*e))))};var sn=function(e){return 0===e?.05396825397622605:.05396825397622605+e*(.0088632398235993+e*(.0014562094543252903+e*(.0002464631348184699+e*(7140724913826082e-20+2590730518636337e-20*e))))};var nn=function(e,t,r){var s,n,i,o,a,l,c,d,h;return(n=2147483647&(s=yt(e))|0)>=1072010280&&(e<0&&(e=-e,t=-t),e=(h=.7853981633974483-e)+(d=3061616997868383e-32-t),t=0),o=t+(h=e*e)*((a=h*e)*((o=rn(d=h*h))+(c=h*sn(d)))+t),d=e+(o+=.3333333333333341*a),n>=1072010280?(1-(s>>30&2))*((c=r)-2*(e-(d*d/(d+c)-o))):1===r?d:(Ks(h=d,0),c=o-(h-e),Ks(l=i=-1/d,0),l+i*((a=1+l*h)+l*c))},on=nn,an=[0,0];var ln=function(e){var t,r;return t=yt(e),(t&=2147483647)<=1072243195?t<1044381696?e:on(e,0,1):t>=2146435072?NaN:(r=bs(e,an),on(an[0],an[1],1-((1&r)<<1)))},cn=ln;var dn=function(e){var t,r;return 0===e?-.3333333333333332:((e<0?-e:e)<=1?(t=e*(e*(0*e-.9643991794250523)-99.28772310019185)-1614.6876844170845,r=4844.063053251255+e*(2235.4883906010045+e*(112.81167849163293+1*e))):(t=0+(e=1/e)*(e*(-1614.6876844170845*e-99.28772310019185)-.9643991794250523),r=1+e*(112.81167849163293+e*(2235.4883906010045+4844.063053251255*e))),t/r)};var hn=function(e){var t,r;if((r=Fr(e))>44.014845965556525)return e<0?-1:1;if(r>=.625)r=1-2/((t=xs(2*r))+1),e<0&&(r=-r);else{if(0===e)return e;r=e+e*(t=e*e)*dn(t)}return r},un=hn;void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:Te,acosh:Kt,asin:Le,asinh:zt,atan:Qt,atanh:At,atan2:_r,cbrt:xr,cos:ws,cosh:Gs,exp:xs,expm1:Ps,log:Mt,log1p:kt,log10:Ns,log2:Ds,sin:$s,sinh:tn,tan:cn,tanh:un});const fn=Math.pow;function pn(e){return e===1/0||e===-1/0}globalThis.CroquetMath.pow=(e,t)=>{if(isNaN(e)||isNaN(t))return NaN;if(pn(e)||pn(t))return fn(e,t);if(0===e||0===t)return fn(e,t);if(e<0&&!function(e){return Number.isInteger(e)}(t))return NaN;if(1===t)return e;if(2===t)return e*e;if(3===t)return e*e*e;if(4===t)return e*e*e*e;let r=1;e<0&&(e*=-1,r=fn(-1,t));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(e)*t)*r};var mn=function(e,t){return e<t};function bn(e){if(!(this instanceof bn))return new bn(e);this.array=[],this.size=0,this.compare=e||mn}bn.prototype.clone=function(){var e=new bn(this.compare);return e.size=this.size,e.array=this.array.slice(0,this.size),e},bn.prototype.add=function(e){var t,r,s=this.size;for(this.array[this.size]=e,this.size+=1;s>0&&(t=s-1>>1,r=this.array[t],this.compare(e,r));)this.array[s]=r,s=t;this.array[s]=e},bn.prototype.heapify=function(e){var t;for(this.array=e,this.size=e.length,t=this.size>>1;t>=0;t--)this._percolateDown(t)},bn.prototype._percolateUp=function(e,t){for(var r,s,n=this.array[e];e>0&&(r=e-1>>1,s=this.array[r],t||this.compare(n,s));)this.array[e]=s,e=r;this.array[e]=n},bn.prototype._percolateDown=function(e){for(var t,r,s,n=this.size,i=this.size>>>1,o=this.array[e];e<i&&(r=(t=1+(e<<1))+1,s=this.array[t],r<n&&this.compare(this.array[r],s)&&(t=r,s=this.array[r]),this.compare(s,o));)this.array[e]=s,e=t;this.array[e]=o},bn.prototype._removeAt=function(e){if(!(e>this.size-1||e<0))return this._percolateUp(e,!0),this.poll()},bn.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(!this.compare(this.array[t],e)&&!this.compare(e,this.array[t]))return this._removeAt(t),!0;return!1},bn.prototype.removeOne=function(e){if("function"==typeof e)for(var t=0;t<this.size;t++)if(e(this.array[t]))return this._removeAt(t)},bn.prototype.removeMany=function(e,t){if("function"!=typeof e||this.size<1)return[];t=t?Math.min(t,this.size):this.size;for(var r=0,s=new Array(t),n=0,i=new Array(this.size);r<t&&!this.isEmpty();){var o=this.poll();e(o)?s[r++]=o:i[n++]=o}s.length=r;for(var a=0;a<n;)this.add(i[a++]);return s},bn.prototype.peek=function(){if(0!=this.size)return this.array[0]},bn.prototype.poll=function(){if(0!=this.size){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}},bn.prototype.replaceTop=function(e){if(0!=this.size){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}},bn.prototype.trim=function(){this.array=this.array.slice(0,this.size)},bn.prototype.isEmpty=function(){return 0===this.size},bn.prototype.forEach=function(e){if(!this.isEmpty()&&"function"==typeof e)for(var t=0,r=this.clone();!r.isEmpty();)e(r.poll(),t++)},bn.prototype.kSmallest=function(e){if(0==this.size)return[];e=Math.min(this.size,e);var t=new bn(this.compare);const r=Math.min((e>0?Math.pow(2,e-1):0)+1,this.size);t.size=r,t.array=this.array.slice(0,r);for(var s=new Array(e),n=0;n<e;n++)s[n]=t.poll();return s};var yn=bn;class gn extends yn{poll(){const e=super.poll();return this.array[this.size]=null,e}asArray(){const e=[];return this.forEach((t=>e.push(t))),e}asUnsortedArray(){return this.array.slice(0,this.size)}}let wn=!1,Sn=_n(0),vn={};function _n(e){return{start:e,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:wn}}const Zn=[],Xn={animationFrame(e,t={}){!function(e){Sn.total=e-Sn.start}(e),Sn=_n(e);for(const[e,r]of Object.entries(t))this[e](r)},begin(e){const t=performance.now();Sn.items[e]=(Sn.items[e]||0)-t;const r=Zn[Zn.length-1];return r&&(Sn.items[r]+=t),Zn.push(e),t},end(e){const t=performance.now();Sn.items[e]+=t;const r=Zn.pop();if(r!==e)throw Error(`Unmatched stats calls: expected end("${r}"), got end("${e}")`);const s=Zn[Zn.length-1];return s&&(Sn.items[s]-=t),t},backlog(e){Sn.backlog=Math.max(e,Sn.backlog)},network(e){Sn.network=e},starvation(e){Sn.network=e},latency(e){Sn.latency=e},activity(e){Sn.activity=e},users(e){Sn.users=e},connected(e){Sn.connected=wn=e},perSecondTally(e={}){if(globalThis.logMessageStats)for(const[t,r]of Object.entries(e))vn[t]=(vn[t]||0)+r},stepSession(e,t=!1){const r=Math.floor(Date.now()/1e3);if(!globalThis.logMessageStats)return vn={second:r},null;let s=null;if(r!==vn.second){if(vn.second&&t&&(vn.requestedMessages||vn.sentMessagesTotal)){s={...vn};const e=r-vn.second;1!==e&&(s.sampleSeconds=e),s.sentBundles&&(s.averageDelay=Math.round(10*s.sendDelay/s.sentMessagesTotal)/10,s.averageBundlePayload=Math.round(s.sentBundlePayload/s.sentBundles)),delete s.second,delete s.sendDelay,delete s.sentBundlePayload}vn={second:r}}return s}};var Ln={exports:{}},xn=Ln.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function s(e,t,s){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var a=s[e.charCodeAt(o-1)]<<o%4*2|s[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=a<<24-i%4*8,i++}return r.create(n,i)}t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,s=this._map;e.clamp();for(var n=[],i=0;i<r;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<r;a++)n.push(s.charAt(o>>>6*(3-a)&63));var l=s.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join("")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return s(e,t,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64}(F.exports),Tn={exports:{}},Gn=Tn.exports=function(e){return e.enc.Utf8}(F.exports),kn={exports:{}},Rn={exports:{}};Rn.exports=function(e){return function(){var t=e,r=t.lib,s=r.WordArray,n=r.Hasher,i=t.algo,o=[],a=i.SHA1=n.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],n=r[1],i=r[2],a=r[3],l=r[4],c=0;c<80;c++){if(c<16)o[c]=0|e[t+c];else{var d=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=d<<1|d>>>31}var h=(s<<5|s>>>27)+l+o[c];h+=c<20?1518500249+(n&i|~n&a):c<40?1859775393+(n^i^a):c<60?(n&i|n&a|i&a)-1894007588:(n^i^a)-899497514,l=a,a=i,i=n<<30|n>>>2,n=s,s=h}r[0]=r[0]+s|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(s+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=n._createHelper(a),t.HmacSHA1=n._createHmacHelper(a)}(),e.SHA1}(F.exports);var Wn={exports:{}};Wn.exports=function(e){!function(){var t=e,r=t.lib.Base,s=t.enc.Utf8;t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),a=i.words,l=o.words,c=0;c<r;c++)a[c]^=1549556828,l[c]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})}()}(F.exports);var Cn=kn.exports=function(e){return function(){var t=e,r=t.lib,s=r.Base,n=r.WordArray,i=t.algo,o=i.SHA1,a=i.HMAC,l=i.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,s=a.create(r.hasher,e),i=n.create(),o=n.create([1]),l=i.words,c=o.words,d=r.keySize,h=r.iterations;l.length<d;){var u=s.update(t).finalize(o);s.reset();for(var f=u.words,p=f.length,m=u,b=1;b<h;b++){m=s.finalize(m),s.reset();for(var y=m.words,g=0;g<p;g++)f[g]^=y[g]}i.concat(u),c[0]++}return i.sigBytes=4*d,i}});t.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)}}(),e.PBKDF2}(F.exports),Pn={exports:{}},In={exports:{}};In.exports=function(e){return function(t){var r=e,s=r.lib,n=s.WordArray,i=s.Hasher,o=r.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=o.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var s=t+r,n=e[s];e[s]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i=this._hash.words,o=e[t+0],l=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],b=e[t+5],y=e[t+6],g=e[t+7],w=e[t+8],S=e[t+9],v=e[t+10],_=e[t+11],Z=e[t+12],X=e[t+13],L=e[t+14],x=e[t+15],T=i[0],G=i[1],k=i[2],R=i[3];T=c(T,G,k,R,o,7,a[0]),R=c(R,T,G,k,l,12,a[1]),k=c(k,R,T,G,f,17,a[2]),G=c(G,k,R,T,p,22,a[3]),T=c(T,G,k,R,m,7,a[4]),R=c(R,T,G,k,b,12,a[5]),k=c(k,R,T,G,y,17,a[6]),G=c(G,k,R,T,g,22,a[7]),T=c(T,G,k,R,w,7,a[8]),R=c(R,T,G,k,S,12,a[9]),k=c(k,R,T,G,v,17,a[10]),G=c(G,k,R,T,_,22,a[11]),T=c(T,G,k,R,Z,7,a[12]),R=c(R,T,G,k,X,12,a[13]),k=c(k,R,T,G,L,17,a[14]),T=d(T,G=c(G,k,R,T,x,22,a[15]),k,R,l,5,a[16]),R=d(R,T,G,k,y,9,a[17]),k=d(k,R,T,G,_,14,a[18]),G=d(G,k,R,T,o,20,a[19]),T=d(T,G,k,R,b,5,a[20]),R=d(R,T,G,k,v,9,a[21]),k=d(k,R,T,G,x,14,a[22]),G=d(G,k,R,T,m,20,a[23]),T=d(T,G,k,R,S,5,a[24]),R=d(R,T,G,k,L,9,a[25]),k=d(k,R,T,G,p,14,a[26]),G=d(G,k,R,T,w,20,a[27]),T=d(T,G,k,R,X,5,a[28]),R=d(R,T,G,k,f,9,a[29]),k=d(k,R,T,G,g,14,a[30]),T=h(T,G=d(G,k,R,T,Z,20,a[31]),k,R,b,4,a[32]),R=h(R,T,G,k,w,11,a[33]),k=h(k,R,T,G,_,16,a[34]),G=h(G,k,R,T,L,23,a[35]),T=h(T,G,k,R,l,4,a[36]),R=h(R,T,G,k,m,11,a[37]),k=h(k,R,T,G,g,16,a[38]),G=h(G,k,R,T,v,23,a[39]),T=h(T,G,k,R,X,4,a[40]),R=h(R,T,G,k,o,11,a[41]),k=h(k,R,T,G,p,16,a[42]),G=h(G,k,R,T,y,23,a[43]),T=h(T,G,k,R,S,4,a[44]),R=h(R,T,G,k,Z,11,a[45]),k=h(k,R,T,G,x,16,a[46]),T=u(T,G=h(G,k,R,T,f,23,a[47]),k,R,o,6,a[48]),R=u(R,T,G,k,g,10,a[49]),k=u(k,R,T,G,L,15,a[50]),G=u(G,k,R,T,b,21,a[51]),T=u(T,G,k,R,Z,6,a[52]),R=u(R,T,G,k,p,10,a[53]),k=u(k,R,T,G,v,15,a[54]),G=u(G,k,R,T,l,21,a[55]),T=u(T,G,k,R,w,6,a[56]),R=u(R,T,G,k,x,10,a[57]),k=u(k,R,T,G,y,15,a[58]),G=u(G,k,R,T,X,21,a[59]),T=u(T,G,k,R,m,6,a[60]),R=u(R,T,G,k,_,10,a[61]),k=u(k,R,T,G,f,15,a[62]),G=u(G,k,R,T,S,21,a[63]),i[0]=i[0]+T|0,i[1]=i[1]+G|0,i[2]=i[2]+k|0,i[3]=i[3]+R|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;r[n>>>5]|=128<<24-n%32;var i=t.floor(s/4294967296),o=s;r[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,r,s,n,i,o){var a=e+(t&r|~t&s)+n+o;return(a<<i|a>>>32-i)+t}function d(e,t,r,s,n,i,o){var a=e+(t&s|r&~s)+n+o;return(a<<i|a>>>32-i)+t}function h(e,t,r,s,n,i,o){var a=e+(t^r^s)+n+o;return(a<<i|a>>>32-i)+t}function u(e,t,r,s,n,i,o){var a=e+(r^(t|~s))+n+o;return(a<<i|a>>>32-i)+t}r.MD5=i._createHelper(l),r.HmacMD5=i._createHmacHelper(l)}(Math),e.MD5}(F.exports);var Vn={exports:{}};Vn.exports=function(e){return function(){var t=e,r=t.lib,s=r.Base,n=r.WordArray,i=t.algo,o=i.MD5,a=i.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,s=this.cfg,i=s.hasher.create(),o=n.create(),a=o.words,l=s.keySize,c=s.iterations;a.length<l;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var d=1;d<c;d++)r=i.finalize(r),i.reset();o.concat(r)}return o.sigBytes=4*l,o}});t.EvpKDF=function(e,t,r){return a.create(r).compute(e,t)}}(),e.EvpKDF}(F.exports);var Mn={exports:{}};Mn.exports=function(e){e.lib.Cipher||function(t){var r=e,s=r.lib,n=s.Base,i=s.WordArray,o=s.BufferedBlockAlgorithm,a=r.enc;a.Utf8;var l=a.Base64,c=r.algo.EvpKDF,d=s.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?w:y}return function(t){return{encrypt:function(r,s,n){return e(s).encrypt(t,r,s,n)},decrypt:function(r,s,n){return e(s).decrypt(t,r,s,n)}}}}()});s.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=r.mode={},u=s.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=h.CBC=function(){var e=u.extend();function r(e,r,s){var n,i=this._iv;i?(n=i,this._iv=t):n=this._prevBlock;for(var o=0;o<s;o++)e[r+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize;r.call(this,e,t,n),s.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),e.Decryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize,i=e.slice(t,t+n);s.decryptBlock(e,t),r.call(this,e,t,n),this._prevBlock=i}}),e}(),p=(r.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,s=r-e.sigBytes%r,n=s<<24|s<<16|s<<8|s,o=[],a=0;a<s;a+=4)o.push(n);var l=i.create(o,s);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};s.BlockCipher=d.extend({cfg:d.cfg.extend({mode:f,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,s=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=s.createEncryptor:(e=s.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(s,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var m=s.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),b=(r.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),s=r.words;return 1398893684==s[0]&&1701076831==s[1]&&(t=i.create(s.slice(2,4)),s.splice(0,4),r.sigBytes-=16),m.create({ciphertext:r,salt:t})}},y=s.SerializableCipher=n.extend({cfg:n.extend({format:b}),encrypt:function(e,t,r,s){s=this.cfg.extend(s);var n=e.createEncryptor(r,s),i=n.finalize(t),o=n.cfg;return m.create({ciphertext:i,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:s.format})},decrypt:function(e,t,r,s){return s=this.cfg.extend(s),t=this._parse(t,s.format),e.createDecryptor(r,s).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),g=(r.kdf={}).OpenSSL={execute:function(e,t,r,s){s||(s=i.random(8));var n=c.create({keySize:t+r}).compute(e,s),o=i.create(n.words.slice(t),4*r);return n.sigBytes=4*t,m.create({key:n,iv:o,salt:s})}},w=s.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(e,t,r,s){var n=(s=this.cfg.extend(s)).kdf.execute(r,e.keySize,e.ivSize);s.iv=n.iv;var i=y.encrypt.call(this,e,t,n.key,s);return i.mixIn(n),i},decrypt:function(e,t,r,s){s=this.cfg.extend(s),t=this._parse(t,s.format);var n=s.kdf.execute(r,e.keySize,e.ivSize,t.salt);return s.iv=n.iv,y.decrypt.call(this,e,t,n.key,s)}})}()}(F.exports);var Yn=Pn.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,s=t.algo,n=[],i=[],o=[],a=[],l=[],c=[],d=[],h=[],u=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,s=0;for(t=0;t<256;t++){var p=s^s<<1^s<<2^s<<3^s<<4;p=p>>>8^255&p^99,n[r]=p,i[p]=r;var m=e[r],b=e[m],y=e[b],g=257*e[p]^16843008*p;o[r]=g<<24|g>>>8,a[r]=g<<16|g>>>16,l[r]=g<<8|g>>>24,c[r]=g,g=16843009*y^65537*b^257*m^16843008*r,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,f[p]=g,r?(r=m^e[e[e[y^m]]],s^=e[e[s]]):r=s=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=s.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,s=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],o=0;o<s;o++)o<r?i[o]=t[o]:(c=i[o-1],o%r?r>6&&o%r==4&&(c=n[c>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c]):(c=n[(c=c<<8|c>>>24)>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c],c^=p[o/r|0]<<24),i[o]=i[o-r]^c);for(var a=this._invKeySchedule=[],l=0;l<s;l++){if(o=s-l,l%4)var c=i[o];else c=i[o-4];a[l]=l<4||o<=4?c:d[n[c>>>24]]^h[n[c>>>16&255]]^u[n[c>>>8&255]]^f[n[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,l,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,h,u,f,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,s,n,i,o,a){for(var l=this._nRounds,c=e[t]^r[0],d=e[t+1]^r[1],h=e[t+2]^r[2],u=e[t+3]^r[3],f=4,p=1;p<l;p++){var m=s[c>>>24]^n[d>>>16&255]^i[h>>>8&255]^o[255&u]^r[f++],b=s[d>>>24]^n[h>>>16&255]^i[u>>>8&255]^o[255&c]^r[f++],y=s[h>>>24]^n[u>>>16&255]^i[c>>>8&255]^o[255&d]^r[f++],g=s[u>>>24]^n[c>>>16&255]^i[d>>>8&255]^o[255&h]^r[f++];c=m,d=b,h=y,u=g}m=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^r[f++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^r[f++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^r[f++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[f++],e[t]=m,e[t+1]=b,e[t+2]=y,e[t+3]=g},keySize:8});t.AES=r._createHelper(m)}(),e.AES}(F.exports),Kn={exports:{}},En=Kn.exports=function(e){return e.HmacSHA256}(F.exports);function Hn(e){let t=e.length;for(;--t>=0;)e[t]=0}const Fn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Nn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Un=new Array(576);Hn(Un);const On=new Array(60);Hn(On);const Qn=new Array(512);Hn(Qn);const Jn=new Array(256);Hn(Jn);const Dn=new Array(29);Hn(Dn);const Bn=new Array(30);function An(e,t,r,s,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=s,this.max_length=n,this.has_stree=e&&e.length}let $n,qn,ei;function ti(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Hn(Bn);const ri=e=>e<256?Qn[e]:Qn[256+(e>>>7)],si=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ni=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,si(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ii=(e,t,r)=>{ni(e,r[2*t],r[2*t+1])},oi=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},ai=(e,t,r)=>{const s=new Array(16);let n,i,o=0;for(n=1;n<=15;n++)s[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=oi(s[t]++,t))}},li=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ci=e=>{e.bi_valid>8?si(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},di=(e,t,r,s)=>{const n=2*t,i=2*r;return e[n]<e[i]||e[n]===e[i]&&s[t]<=s[r]},hi=(e,t,r)=>{const s=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&di(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!di(t,s,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=s},ui=(e,t,r)=>{let s,n,i,o,a=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],n=e.pending_buf[e.l_buf+a],a++,0===s?ii(e,n,t):(i=Jn[n],ii(e,i+256+1,t),o=Fn[i],0!==o&&(n-=Dn[i],ni(e,n,o)),s--,i=ri(s),ii(e,i,r),o=zn[i],0!==o&&(s-=Bn[i],ni(e,s,o)))}while(a<e.last_lit);ii(e,256,t)},fi=(e,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,a,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<i;o++)0!==r[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=s[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)hi(e,r,o);l=i;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],hi(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,r[2*l]=r[2*o]+r[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,r[2*o+1]=r[2*a+1]=l,e.heap[1]=l++,hi(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,s=t.max_code,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,h,u,f,p,m=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],u=r[2*r[2*d+1]+1]+1,u>l&&(u=l,m++),r[2*d+1]=u,d>s||(e.bl_count[u]++,f=0,d>=a&&(f=o[d-a]),p=r[2*d],e.opt_len+=p*(u+f),i&&(e.static_len+=p*(n[2*d+1]+f)));if(0!==m){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(u=l;0!==u;u--)for(d=e.bl_count[u];0!==d;)h=e.heap[--c],h>s||(r[2*h+1]!==u&&(e.opt_len+=(u-r[2*h+1])*r[2*h],r[2*h+1]=u),d--)}})(e,t),ai(r,c,e.bl_count)},pi=(e,t,r)=>{let s,n,i=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,s=0;s<=r;s++)n=o,o=t[2*(s+1)+1],++a<l&&n===o||(a<c?e.bl_tree[2*n]+=a:0!==n?(n!==i&&e.bl_tree[2*n]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,i=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4))},mi=(e,t,r)=>{let s,n,i=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),s=0;s<=r;s++)if(n=o,o=t[2*(s+1)+1],!(++a<l&&n===o)){if(a<c)do{ii(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==i&&(ii(e,n,e.bl_tree),a--),ii(e,16,e.bl_tree),ni(e,a-3,2)):a<=10?(ii(e,17,e.bl_tree),ni(e,a-3,3)):(ii(e,18,e.bl_tree),ni(e,a-11,7));a=0,i=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4)}};let bi=!1;const yi=(e,t,r,s)=>{ni(e,0+(s?1:0),3),((e,t,r,s)=>{ci(e),s&&(si(e,r),si(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r})(e,t,r,!0)};var gi=e=>{bi||((()=>{let e,t,r,s,n;const i=new Array(16);for(r=0,s=0;s<28;s++)for(Dn[s]=r,e=0;e<1<<Fn[s];e++)Jn[r++]=s;for(Jn[r-1]=s,n=0,s=0;s<16;s++)for(Bn[s]=n,e=0;e<1<<zn[s];e++)Qn[n++]=s;for(n>>=7;s<30;s++)for(Bn[s]=n<<7,e=0;e<1<<zn[s]-7;e++)Qn[256+n++]=s;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)Un[2*e+1]=8,e++,i[8]++;for(;e<=255;)Un[2*e+1]=9,e++,i[9]++;for(;e<=279;)Un[2*e+1]=7,e++,i[7]++;for(;e<=287;)Un[2*e+1]=8,e++,i[8]++;for(ai(Un,287,i),e=0;e<30;e++)On[2*e+1]=5,On[2*e]=oi(e,5);$n=new An(Un,Fn,257,286,15),qn=new An(On,zn,0,30,15),ei=new An(new Array(0),Nn,0,19,7)})(),bi=!0),e.l_desc=new ti(e.dyn_ltree,$n),e.d_desc=new ti(e.dyn_dtree,qn),e.bl_desc=new ti(e.bl_tree,ei),e.bi_buf=0,e.bi_valid=0,li(e)},wi=(e,t,r,s)=>{let n,i,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),fi(e,e.l_desc),fi(e,e.d_desc),o=(e=>{let t;for(pi(e,e.dyn_ltree,e.l_desc.max_code),pi(e,e.dyn_dtree,e.d_desc.max_code),fi(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*jn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=n&&(n=i)):n=i=r+5,r+4<=n&&-1!==t?yi(e,t,r,s):4===e.strategy||i===n?(ni(e,2+(s?1:0),3),ui(e,Un,On)):(ni(e,4+(s?1:0),3),((e,t,r,s)=>{let n;for(ni(e,t-257,5),ni(e,r-1,5),ni(e,s-4,4),n=0;n<s;n++)ni(e,e.bl_tree[2*jn[n]+1],3);mi(e,e.dyn_ltree,t-1),mi(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ui(e,e.dyn_ltree,e.dyn_dtree)),li(e),s&&ci(e)},Si=(e,t,r)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Jn[r]+256+1)]++,e.dyn_dtree[2*ri(t)]++),e.last_lit===e.lit_bufsize-1),vi=e=>{ni(e,2,3),ii(e,256,Un),(e=>{16===e.bi_valid?(si(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},_i={_tr_init:gi,_tr_stored_block:yi,_tr_flush_block:wi,_tr_tally:Si,_tr_align:vi};var Zi=(e,t,r,s)=>{let n=65535&e|0,i=e>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{n=n+t[s++]|0,i=i+n|0}while(--o);n%=65521,i%=65521}return n|i<<16|0};const Xi=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Li=(e,t,r,s)=>{const n=Xi,i=s+r;e^=-1;for(let r=s;r<i;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},xi={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ti={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Gi,_tr_stored_block:ki,_tr_flush_block:Ri,_tr_tally:Wi,_tr_align:Ci}=_i,{Z_NO_FLUSH:Pi,Z_PARTIAL_FLUSH:Ii,Z_FULL_FLUSH:Vi,Z_FINISH:Mi,Z_BLOCK:Yi,Z_OK:Ki,Z_STREAM_END:Ei,Z_STREAM_ERROR:Hi,Z_DATA_ERROR:Fi,Z_BUF_ERROR:zi,Z_DEFAULT_COMPRESSION:Ni,Z_FILTERED:ji,Z_HUFFMAN_ONLY:Ui,Z_RLE:Oi,Z_FIXED:Qi,Z_DEFAULT_STRATEGY:Ji,Z_UNKNOWN:Di,Z_DEFLATED:Bi}=Ti,Ai=(e,t)=>(e.msg=xi[t],t),$i=e=>(e<<1)-(e>4?9:0),qi=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let eo=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const to=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},ro=(e,t)=>{Ri(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,to(e.strm)},so=(e,t)=>{e.pending_buf[e.pending++]=t},no=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},io=(e,t,r,s)=>{let n=e.avail_in;return n>s&&(n=s),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=Zi(e.adler,t,n,r):2===e.state.wrap&&(e.adler=Li(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},oo=(e,t)=>{let r,s,n=e.max_chain_length,i=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+258;let f=c[i+o-1],p=c[i+o];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(r=t,c[r+o]===p&&c[r+o-1]===f&&c[r]===c[i]&&c[++r]===c[i+1]){i+=2,r++;do{}while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<u);if(s=258-(u-i),i=u-258,s>o){if(e.match_start=t,o=s,s>=a)break;f=c[i+o-1],p=c[i+o]}}}while((t=h[t&d])>l&&0!=--n);return o<=e.lookahead?o:e.lookahead},ao=e=>{const t=e.w_size;let r,s,n,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-262)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,r=s;do{n=e.head[--r],e.head[r]=n>=t?n-t:0}while(--s);s=t,r=s;do{n=e.prev[--r],e.prev[r]=n>=t?n-t:0}while(--s);i+=t}if(0===e.strm.avail_in)break;if(s=io(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=eo(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=eo(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},lo=(e,t)=>{let r,s;for(;;){if(e.lookahead<262){if(ao(e),e.lookahead<262&&t===Pi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=oo(e,r)),e.match_length>=3)if(s=Wi(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=eo(e,e.ins_h,e.window[e.strstart+1]);else s=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Mi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2},co=(e,t)=>{let r,s,n;for(;;){if(e.lookahead<262){if(ao(e),e.lookahead<262&&t===Pi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=oo(e,r),e.match_length<=5&&(e.strategy===ji||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,s=Wi(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(ro(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=Wi(e,0,e.window[e.strstart-1]),s&&ro(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Wi(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Mi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2};function ho(e,t,r,s,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=s,this.func=n}const uo=[new ho(0,0,0,0,((e,t)=>{let r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ao(e),0===e.lookahead&&t===Pi)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const s=e.block_start+r;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,ro(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Mi?(ro(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(ro(e,!1),e.strm.avail_out),1)})),new ho(4,4,8,4,lo),new ho(4,5,16,8,lo),new ho(4,6,32,32,lo),new ho(4,4,16,16,co),new ho(8,16,32,32,co),new ho(8,16,128,128,co),new ho(8,32,128,256,co),new ho(32,128,258,1024,co),new ho(32,258,258,4096,co)];function fo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),qi(this.dyn_ltree),qi(this.dyn_dtree),qi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),qi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),qi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const po=e=>{if(!e||!e.state)return Ai(e,Hi);e.total_in=e.total_out=0,e.data_type=Di;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=Pi,Gi(t),Ki},mo=e=>{const t=po(e);return t===Ki&&(e=>{e.window_size=2*e.w_size,qi(e.head),e.max_lazy_match=uo[e.level].max_lazy,e.good_match=uo[e.level].good_length,e.nice_match=uo[e.level].nice_length,e.max_chain_length=uo[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},bo=(e,t,r,s,n,i)=>{if(!e)return Hi;let o=1;if(t===Ni&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),n<1||n>9||r!==Bi||s<8||s>15||t<0||t>9||i<0||i>Qi)return Ai(e,Hi);8===s&&(s=9);const a=new fo;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=i,a.method=r,mo(e)};var yo=(e,t)=>{let r,s;if(!e||!e.state||t>Yi||t<0)return e?Ai(e,Hi):Hi;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==Mi)return Ai(e,0===e.avail_out?zi:Hi);n.strm=e;const i=n.last_flush;if(n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,so(n,31),so(n,139),so(n,8),n.gzhead?(so(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),so(n,255&n.gzhead.time),so(n,n.gzhead.time>>8&255),so(n,n.gzhead.time>>16&255),so(n,n.gzhead.time>>24&255),so(n,9===n.level?2:n.strategy>=Ui||n.level<2?4:0),so(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(so(n,255&n.gzhead.extra.length),so(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Li(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(so(n,0),so(n,0),so(n,0),so(n,0),so(n,0),so(n,9===n.level?2:n.strategy>=Ui||n.level<2?4:0),so(n,3),n.status=113);else{let t=Bi+(n.w_bits-8<<4)<<8,r=-1;r=n.strategy>=Ui||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=113,no(n,t),0!==n.strstart&&(no(n,e.adler>>>16),no(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(r=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending!==n.pending_buf_size));)so(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,so(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,so(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&to(e),n.pending+2<=n.pending_buf_size&&(so(n,255&e.adler),so(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(to(e),0===e.avail_out)return n.last_flush=-1,Ki}else if(0===e.avail_in&&$i(t)<=$i(i)&&t!==Mi)return Ai(e,zi);if(666===n.status&&0!==e.avail_in)return Ai(e,zi);if(0!==e.avail_in||0!==n.lookahead||t!==Pi&&666!==n.status){let r=n.strategy===Ui?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ao(e),0===e.lookahead)){if(t===Pi)return 1;break}if(e.match_length=0,r=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Mi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Oi?((e,t)=>{let r,s,n,i;const o=e.window;for(;;){if(e.lookahead<=258){if(ao(e),e.lookahead<=258&&t===Pi)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,s=o[n],s===o[++n]&&s===o[++n]&&s===o[++n])){i=e.strstart+258;do{}while(s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&n<i);e.match_length=258-(i-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Wi(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Mi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2})(n,t):uo[n.level].func(n,t);if(3!==r&&4!==r||(n.status=666),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Ki;if(2===r&&(t===Ii?Ci(n):t!==Yi&&(ki(n,0,0,!1),t===Vi&&(qi(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),to(e),0===e.avail_out))return n.last_flush=-1,Ki}return t!==Mi?Ki:n.wrap<=0?Ei:(2===n.wrap?(so(n,255&e.adler),so(n,e.adler>>8&255),so(n,e.adler>>16&255),so(n,e.adler>>24&255),so(n,255&e.total_in),so(n,e.total_in>>8&255),so(n,e.total_in>>16&255),so(n,e.total_in>>24&255)):(no(n,e.adler>>>16),no(n,65535&e.adler)),to(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Ki:Ei)},go=(e,t)=>{let r=t.length;if(!e||!e.state)return Hi;const s=e.state,n=s.wrap;if(2===n||1===n&&42!==s.status||s.lookahead)return Hi;if(1===n&&(e.adler=Zi(e.adler,t,r,0)),s.wrap=0,r>=s.w_size){0===n&&(qi(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(r-s.w_size,r),0),t=e,r=s.w_size}const i=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ao(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=eo(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,ao(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=a,e.avail_in=i,s.wrap=n,Ki},wo={deflateInit:(e,t)=>bo(e,t,Bi,15,8,Ji),deflateInit2:bo,deflateReset:mo,deflateResetKeep:po,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?Hi:(e.state.gzhead=t,Ki):Hi,deflate:yo,deflateEnd:e=>{if(!e||!e.state)return Hi;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?Ai(e,Hi):(e.state=null,113===t?Ai(e,Fi):Ki)},deflateSetDictionary:go,deflateInfo:"pako deflate (from Nodeca project)"};const So=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var vo=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(const t in r)So(r,t)&&(e[t]=r[t])}}return e},_o=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,s=0,n=e.length;t<n;t++){let n=e[t];r.set(n,s),s+=n.length}return r};let Zo=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Zo=!1}const Xo=new Uint8Array(256);for(let e=0;e<256;e++)Xo[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Xo[254]=Xo[254]=1;var Lo=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,s,n,i,o=e.length,a=0;for(n=0;n<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),i=0,n=0;i<a;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},xo=(e,t)=>{const r=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,n;const i=new Array(2*r);for(n=0,s=0;s<r;){let t=e[s++];if(t<128){i[n++]=t;continue}let o=Xo[t];if(o>4)i[n++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<r;)t=t<<6|63&e[s++],o--;o>1?i[n++]=65533:t<65536?i[n++]=t:(t-=65536,i[n++]=55296|t>>10&1023,i[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Zo)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r="";for(let s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r})(i,n)},To=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Xo[e[r]]>t?r:t};var Go=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const ko=Object.prototype.toString,{Z_NO_FLUSH:Ro,Z_SYNC_FLUSH:Wo,Z_FULL_FLUSH:Co,Z_FINISH:Po,Z_OK:Io,Z_STREAM_END:Vo,Z_DEFAULT_COMPRESSION:Mo,Z_DEFAULT_STRATEGY:Yo,Z_DEFLATED:Ko}=Ti;function Eo(e){this.options=vo({level:Mo,method:Ko,chunkSize:16384,windowBits:15,memLevel:8,strategy:Yo},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Go,this.strm.avail_out=0;let r=wo.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Io)throw new Error(xi[r]);if(t.header&&wo.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Lo(t.dictionary):"[object ArrayBuffer]"===ko.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=wo.deflateSetDictionary(this.strm,e),r!==Io)throw new Error(xi[r]);this._dict_set=!0}}function Ho(e,t){const r=new Eo(t);if(r.push(e,!0),r.err)throw r.msg||xi[r.err];return r.result}Eo.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize;let n,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Po:Ro,"string"==typeof e?r.input=Lo(e):"[object ArrayBuffer]"===ko.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(i===Wo||i===Co)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=wo.deflate(r,i),n===Vo)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=wo.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Io;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Eo.prototype.onData=function(e){this.chunks.push(e)},Eo.prototype.onEnd=function(e){e===Io&&(this.result=_o(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Fo={Deflate:Eo,deflate:Ho,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ho(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ho(e,t)},constants:Ti};var zo=function(e,t){let r,s,n,i,o,a,l,c,d,h,u,f,p,m,b,y,g,w,S,v,_,Z,X,L;const x=e.state;r=e.next_in,X=e.input,s=r+(e.avail_in-5),n=e.next_out,L=e.output,i=n-(t-e.avail_out),o=n+(e.avail_out-257),a=x.dmax,l=x.wsize,c=x.whave,d=x.wnext,h=x.window,u=x.hold,f=x.bits,p=x.lencode,m=x.distcode,b=(1<<x.lenbits)-1,y=(1<<x.distbits)-1;e:do{f<15&&(u+=X[r++]<<f,f+=8,u+=X[r++]<<f,f+=8),g=p[u&b];t:for(;;){if(w=g>>>24,u>>>=w,f-=w,w=g>>>16&255,0===w)L[n++]=65535&g;else{if(!(16&w)){if(0==(64&w)){g=p[(65535&g)+(u&(1<<w)-1)];continue t}if(32&w){x.mode=12;break e}e.msg="invalid literal/length code",x.mode=30;break e}S=65535&g,w&=15,w&&(f<w&&(u+=X[r++]<<f,f+=8),S+=u&(1<<w)-1,u>>>=w,f-=w),f<15&&(u+=X[r++]<<f,f+=8,u+=X[r++]<<f,f+=8),g=m[u&y];r:for(;;){if(w=g>>>24,u>>>=w,f-=w,w=g>>>16&255,!(16&w)){if(0==(64&w)){g=m[(65535&g)+(u&(1<<w)-1)];continue r}e.msg="invalid distance code",x.mode=30;break e}if(v=65535&g,w&=15,f<w&&(u+=X[r++]<<f,f+=8,f<w&&(u+=X[r++]<<f,f+=8)),v+=u&(1<<w)-1,v>a){e.msg="invalid distance too far back",x.mode=30;break e}if(u>>>=w,f-=w,w=n-i,v>w){if(w=v-w,w>c&&x.sane){e.msg="invalid distance too far back",x.mode=30;break e}if(_=0,Z=h,0===d){if(_+=l-w,w<S){S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}}else if(d<w){if(_+=l+d-w,w-=d,w<S){S-=w;do{L[n++]=h[_++]}while(--w);if(_=0,d<S){w=d,S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}}}else if(_+=d-w,w<S){S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}for(;S>2;)L[n++]=Z[_++],L[n++]=Z[_++],L[n++]=Z[_++],S-=3;S&&(L[n++]=Z[_++],S>1&&(L[n++]=Z[_++]))}else{_=n-v;do{L[n++]=L[_++],L[n++]=L[_++],L[n++]=L[_++],S-=3}while(S>2);S&&(L[n++]=L[_++],S>1&&(L[n++]=L[_++]))}break}}break}}while(r<s&&n<o);S=f>>3,r-=S,f-=S<<3,u&=(1<<f)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?s-r+5:5-(r-s),e.avail_out=n<o?o-n+257:257-(n-o),x.hold=u,x.bits=f};const No=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Uo=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Oo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qo=(e,t,r,s,n,i,o,a)=>{const l=a.bits;let c,d,h,u,f,p,m=0,b=0,y=0,g=0,w=0,S=0,v=0,_=0,Z=0,X=0,L=null,x=0;const T=new Uint16Array(16),G=new Uint16Array(16);let k,R,W,C=null,P=0;for(m=0;m<=15;m++)T[m]=0;for(b=0;b<s;b++)T[t[r+b]]++;for(w=l,g=15;g>=1&&0===T[g];g--);if(w>g&&(w=g),0===g)return n[i++]=20971520,n[i++]=20971520,a.bits=1,0;for(y=1;y<g&&0===T[y];y++);for(w<y&&(w=y),_=1,m=1;m<=15;m++)if(_<<=1,_-=T[m],_<0)return-1;if(_>0&&(0===e||1!==g))return-1;for(G[1]=0,m=1;m<15;m++)G[m+1]=G[m]+T[m];for(b=0;b<s;b++)0!==t[r+b]&&(o[G[t[r+b]]++]=b);if(0===e?(L=C=o,p=19):1===e?(L=No,x-=257,C=jo,P-=257,p=256):(L=Uo,C=Oo,p=-1),X=0,b=0,m=y,f=i,S=w,v=0,h=-1,Z=1<<w,u=Z-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){k=m-v,o[b]<p?(R=0,W=o[b]):o[b]>p?(R=C[P+o[b]],W=L[x+o[b]]):(R=96,W=0),c=1<<m-v,d=1<<S,y=d;do{d-=c,n[f+(X>>v)+d]=k<<24|R<<16|W|0}while(0!==d);for(c=1<<m-1;X&c;)c>>=1;if(0!==c?(X&=c-1,X+=c):X=0,b++,0==--T[m]){if(m===g)break;m=t[r+o[b]]}if(m>w&&(X&u)!==h){for(0===v&&(v=w),f+=y,S=m-v,_=1<<S;S+v<g&&(_-=T[S+v],!(_<=0));)S++,_<<=1;if(Z+=1<<S,1===e&&Z>852||2===e&&Z>592)return 1;h=X&u,n[h]=w<<24|S<<16|f-i|0}}return 0!==X&&(n[f+X]=m-v<<24|64<<16|0),a.bits=w,0};const{Z_FINISH:Jo,Z_BLOCK:Do,Z_TREES:Bo,Z_OK:Ao,Z_STREAM_END:$o,Z_NEED_DICT:qo,Z_STREAM_ERROR:ea,Z_DATA_ERROR:ta,Z_MEM_ERROR:ra,Z_BUF_ERROR:sa,Z_DEFLATED:na}=Ti,ia=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function oa(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const aa=e=>{if(!e||!e.state)return ea;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ao},la=e=>{if(!e||!e.state)return ea;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,aa(e)},ca=(e,t)=>{let r;if(!e||!e.state)return ea;const s=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ea:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,la(e))},da=(e,t)=>{if(!e)return ea;const r=new oa;e.state=r,r.window=null;const s=ca(e,t);return s!==Ao&&(e.state=null),s};let ha,ua,fa=!0;const pa=e=>{if(fa){ha=new Int32Array(512),ua=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Qo(1,e.lens,0,288,ha,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Qo(2,e.lens,0,32,ua,0,e.work,{bits:5}),fa=!1}e.lencode=ha,e.lenbits=9,e.distcode=ua,e.distbits=5},ma=(e,t,r,s)=>{let n;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),s>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(n=i.wsize-i.wnext,n>s&&(n=s),i.window.set(t.subarray(r-s,r-s+n),i.wnext),(s-=n)?(i.window.set(t.subarray(r-s,r),0),i.wnext=s,i.whave=i.wsize):(i.wnext+=n,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=n))),0};var ba={inflateReset:la,inflateReset2:ca,inflateResetKeep:aa,inflateInit:e=>da(e,15),inflateInit2:da,inflate:(e,t)=>{let r,s,n,i,o,a,l,c,d,h,u,f,p,m,b,y,g,w,S,v,_,Z,X=0;const L=new Uint8Array(4);let x,T;const G=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ea;r=e.state,12===r.mode&&(r.mode=13),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,s=e.input,a=e.avail_in,c=r.hold,d=r.bits,h=a,u=l,Z=Ao;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(2&r.wrap&&35615===c){r.check=0,L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0),c=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=30;break}if((15&c)!==na){e.msg="unknown compression method",r.mode=30;break}if(c>>>=4,d-=4,_=8+(15&c),0===r.wbits)r.wbits=_;else if(_>r.wbits){e.msg="invalid window size",r.mode=30;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&c?10:12,c=0,d=0;break;case 2:for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(r.flags=c,(255&r.flags)!==na){e.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.head&&(r.head.time=c),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,L[2]=c>>>16&255,L[3]=c>>>24&255,r.check=Li(r.check,L,4,0)),c=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0,r.mode=5;case 5:if(1024&r.flags){for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(f=r.length,f>a&&(f=a),f&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(i,i+f),_)),512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,r.length-=f),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===a)break e;f=0;do{_=s[i+f++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_))}while(_&&f<a);if(512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===a)break e;f=0;do{_=s[i+f++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_))}while(_&&f<a);if(512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,_)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=30;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}e.adler=r.check=ia(c),c=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,qo;e.adler=r.check=1,r.mode=12;case 12:if(t===Do||t===Bo)break e;case 13:if(r.last){c>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}switch(r.last=1&c,c>>>=1,d-=1,3&c){case 0:r.mode=14;break;case 1:if(pa(r),r.mode=20,t===Bo){c>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=30}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&c,c=0,d=0,r.mode=15,t===Bo)break e;case 15:r.mode=16;case 16:if(f=r.length,f){if(f>a&&(f=a),f>l&&(f=l),0===f)break e;n.set(s.subarray(i,i+f),o),a-=f,i+=f,l-=f,o+=f,r.length-=f;break}r.mode=12;break;case 17:for(;d<14;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(r.nlen=257+(31&c),c>>>=5,d-=5,r.ndist=1+(31&c),c>>>=5,d-=5,r.ncode=4+(15&c),c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.lens[G[r.have++]]=7&c,c>>>=3,d-=3}for(;r.have<19;)r.lens[G[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,x={bits:r.lenbits},Z=Qo(0,r.lens,0,19,r.lencode,0,r.work,x),r.lenbits=x.bits,Z){e.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;X=r.lencode[c&(1<<r.lenbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(g<16)c>>>=b,d-=b,r.lens[r.have++]=g;else{if(16===g){for(T=b+2;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c>>>=b,d-=b,0===r.have){e.msg="invalid bit length repeat",r.mode=30;break}_=r.lens[r.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===g){for(T=b+3;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=b,d-=b,_=0,f=3+(7&c),c>>>=3,d-=3}else{for(T=b+7;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=b,d-=b,_=0,f=11+(127&c),c>>>=7,d-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=30;break}for(;f--;)r.lens[r.have++]=_}}if(30===r.mode)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,x={bits:r.lenbits},Z=Qo(1,r.lens,0,r.nlen,r.lencode,0,r.work,x),r.lenbits=x.bits,Z){e.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,x={bits:r.distbits},Z=Qo(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,x),r.distbits=x.bits,Z){e.msg="invalid distances set",r.mode=30;break}if(r.mode=20,t===Bo)break e;case 20:r.mode=21;case 21:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,zo(e,u),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,s=e.input,a=e.avail_in,c=r.hold,d=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;X=r.lencode[c&(1<<r.lenbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(y&&0==(240&y)){for(w=b,S=y,v=g;X=r.lencode[v+((c&(1<<w+S)-1)>>w)],b=X>>>24,y=X>>>16&255,g=65535&X,!(w+b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=w,d-=w,r.back+=w}if(c>>>=b,d-=b,r.back+=b,r.length=g,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){e.msg="invalid literal/length code",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;X=r.distcode[c&(1<<r.distbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(0==(240&y)){for(w=b,S=y,v=g;X=r.distcode[v+((c&(1<<w+S)-1)>>w)],b=X>>>24,y=X>>>16&255,g=65535&X,!(w+b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=w,d-=w,r.back+=w}if(c>>>=b,d-=b,r.back+=b,64&y){e.msg="invalid distance code",r.mode=30;break}r.offset=g,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break e;if(f=u-l,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=30;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=n,p=o-r.offset,f=r.length;f>l&&(f=l),l-=f,r.length-=f;do{n[o++]=m[p++]}while(--f);0===r.length&&(r.mode=21);break;case 26:if(0===l)break e;n[o++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===a)break e;a--,c|=s[i++]<<d,d+=8}if(u-=l,e.total_out+=u,r.total+=u,u&&(e.adler=r.check=r.flags?Li(r.check,n,u,o-u):Zi(r.check,n,u,o-u)),u=l,(r.flags?c:ia(c))!==r.check){e.msg="incorrect data check",r.mode=30;break}c=0,d=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=30;break}c=0,d=0}r.mode=29;case 29:Z=$o;break e;case 30:Z=ta;break e;case 31:return ra;default:return ea}return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,(r.wsize||u!==e.avail_out&&r.mode<30&&(r.mode<27||t!==Jo))&&ma(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,r.total+=u,r.wrap&&u&&(e.adler=r.check=r.flags?Li(r.check,n,u,e.next_out-u):Zi(r.check,n,u,e.next_out-u)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===h&&0===u||t===Jo)&&Z===Ao&&(Z=sa),Z},inflateEnd:e=>{if(!e||!e.state)return ea;let t=e.state;return t.window&&(t.window=null),e.state=null,Ao},inflateGetHeader:(e,t)=>{if(!e||!e.state)return ea;const r=e.state;return 0==(2&r.wrap)?ea:(r.head=t,t.done=!1,Ao)},inflateSetDictionary:(e,t)=>{const r=t.length;let s,n,i;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?ea:11===s.mode&&(n=1,n=Zi(n,t,r,0),n!==s.check)?ta:(i=ma(e,t,r,r),i?(s.mode=31,ra):(s.havedict=1,Ao))):ea},inflateInfo:"pako inflate (from Nodeca project)"};var ya=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const ga=Object.prototype.toString,{Z_NO_FLUSH:wa,Z_FINISH:Sa,Z_OK:va,Z_STREAM_END:_a,Z_NEED_DICT:Za,Z_STREAM_ERROR:Xa,Z_DATA_ERROR:La,Z_MEM_ERROR:xa}=Ti;function Ta(e){this.options=vo({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Go,this.strm.avail_out=0;let r=ba.inflateInit2(this.strm,t.windowBits);if(r!==va)throw new Error(xi[r]);if(this.header=new ya,ba.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Lo(t.dictionary):"[object ArrayBuffer]"===ga.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ba.inflateSetDictionary(this.strm,t.dictionary),r!==va)))throw new Error(xi[r])}function Ga(e,t){const r=new Ta(t);if(r.push(e),r.err)throw r.msg||xi[r.err];return r.result}Ta.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,n=this.options.dictionary;let i,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Sa:wa,"[object ArrayBuffer]"===ga.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),i=ba.inflate(r,o),i===Za&&n&&(i=ba.inflateSetDictionary(r,n),i===va?i=ba.inflate(r,o):i===La&&(i=Za));r.avail_in>0&&i===_a&&r.state.wrap>0&&0!==e[r.next_in];)ba.inflateReset(r),i=ba.inflate(r,o);switch(i){case Xa:case La:case Za:case xa:return this.onEnd(i),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||i===_a))if("string"===this.options.to){let e=To(r.output,r.next_out),t=r.next_out-e,n=xo(r.output,e);r.next_out=t,r.avail_out=s-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(n)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==va||0!==a){if(i===_a)return i=ba.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ta.prototype.onData=function(e){this.chunks.push(e)},Ta.prototype.onEnd=function(e){e===va&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_o(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ka={Inflate:Ta,inflate:Ga,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Ga(e,t)},ungzip:Ga,constants:Ti};const{Deflate:Ra,deflate:Wa,deflateRaw:Ca,gzip:Pa}=Fo,{Inflate:Ia,inflate:Va,inflateRaw:Ma,ungzip:Ya}=ka;var Ka={Deflate:Ra,deflate:Wa,deflateRaw:Ca,gzip:Pa,Inflate:Ia,inflate:Va,inflateRaw:Ma,ungzip:Ya,constants:Ti},Ea={exports:{}},Ha={BINARY_TYPES:["nodebuffer","arraybuffer","fragments"],EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}};const{EMPTY_BUFFER:Fa}=Ha;function za(e,t){if(0===e.length)return Fa;if(1===e.length)return e[0];const r=Buffer.allocUnsafe(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];r.set(n,s),s+=n.length}return s<t?r.slice(0,s):r}function Na(e,t,r,s,n){for(let i=0;i<n;i++)r[s+i]=e[i]^t[3&i]}function ja(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}function Ua(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function Oa(e){if(Oa.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=Buffer.from(e):ArrayBuffer.isView(e)?t=Buffer.from(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),Oa.readOnly=!1),t}try{const e=require("bufferutil");Ea.exports={concat:za,mask(t,r,s,n,i){i<48?Na(t,r,s,n,i):e.mask(t,r,s,n,i)},toArrayBuffer:Ua,toBuffer:Oa,unmask(t,r){t.length<32?ja(t,r):e.unmask(t,r)}}}catch(od){Ea.exports={concat:za,mask:Na,toArrayBuffer:Ua,toBuffer:Oa,unmask:ja}}const Qa=Symbol("kDone"),Ja=Symbol("kRun");var Da=class{constructor(e){this[Qa]=()=>{this.pending--,this[Ja]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Ja]()}[Ja](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[Qa])}}};const Ba=L.default,Aa=Ea.exports,$a=Da,{kStatusCode:qa}=Ha,el=Buffer.from([0,0,255,255]),tl=Symbol("permessage-deflate"),rl=Symbol("total-length"),sl=Symbol("callback"),nl=Symbol("buffers"),il=Symbol("error");let ol;var al=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!ol){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;ol=new $a(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[sl];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,r=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!r)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(r=r[0],"client_max_window_bits"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}else if("server_max_window_bits"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${r}`);r=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==r)throw new TypeError(`Invalid value for parameter "${t}": ${r}`)}e[t]=r}))})),e}decompress(e,t,r){ol.add((s=>{this._decompress(e,t,((e,t)=>{s(),r(e,t)}))}))}compress(e,t,r){ol.add((s=>{this._compress(e,t,((e,t)=>{s(),r(e,t)}))}))}_decompress(e,t,r){const s=this._isServer?"client":"server";if(!this._inflate){const e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?Ba.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=Ba.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[tl]=this,this._inflate[rl]=0,this._inflate[nl]=[],this._inflate.on("error",dl),this._inflate.on("data",cl)}this._inflate[sl]=r,this._inflate.write(e),t&&this._inflate.write(el),this._inflate.flush((()=>{const e=this._inflate[il];if(e)return this._inflate.close(),this._inflate=null,void r(e);const n=Aa.concat(this._inflate[nl],this._inflate[rl]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[rl]=0,this._inflate[nl]=[],t&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),r(null,n)}))}_compress(e,t,r){const s=this._isServer?"server":"client";if(!this._deflate){const e=`${s}_max_window_bits`,t="number"!=typeof this.params[e]?Ba.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=Ba.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[rl]=0,this._deflate[nl]=[],this._deflate.on("data",ll)}this._deflate[sl]=r,this._deflate.write(e),this._deflate.flush(Ba.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=Aa.concat(this._deflate[nl],this._deflate[rl]);t&&(e=e.slice(0,e.length-4)),this._deflate[sl]=null,this._deflate[rl]=0,this._deflate[nl]=[],t&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),r(null,e)}))}};function ll(e){this[nl].push(e),this[rl]+=e.length}function cl(e){this[rl]+=e.length,this[tl]._maxPayload<1||this[rl]<=this[tl]._maxPayload?this[nl].push(e):(this[il]=new RangeError("Max payload size exceeded"),this[il].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[il][qa]=1009,this.removeListener("data",cl),this.reset())}function dl(e){this[tl]._inflate=null,e[qa]=1007,this[sl](e)}var hl={exports:{}};const ul=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function fl(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999}function pl(e){const t=e.length;let r=0;for(;r<t;)if(0==(128&e[r]))r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}try{const e=require("utf-8-validate");hl.exports={isValidStatusCode:fl,isValidUTF8:t=>t.length<150?pl(t):e(t),tokenChars:ul}}catch(od){hl.exports={isValidStatusCode:fl,isValidUTF8:pl,tokenChars:ul}}const{Writable:ml}=g.default,bl=al,{BINARY_TYPES:yl,EMPTY_BUFFER:gl,kStatusCode:wl,kWebSocket:Sl}=Ha,{concat:vl,toArrayBuffer:_l,unmask:Zl}=Ea.exports,{isValidStatusCode:Xl,isValidUTF8:Ll}=hl.exports;var xl=class extends ml{constructor(e={}){super(),this._binaryType=e.binaryType||yl[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[Sl]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],s=t.length-e;e>=r.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),s),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,Tl(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3");const t=64==(64&e[0]);if(t&&!this._extensions[bl.extensionName])return this._loop=!1,Tl(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,Tl(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(!this._fragmented)return this._loop=!1,Tl(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,Tl(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,Tl(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE");if(!this._fin)return this._loop=!1,Tl(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN");if(t)return this._loop=!1,Tl(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1");if(this._payloadLength>125)return this._loop=!1,Tl(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,Tl(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK")}else if(this._masked)return this._loop=!1,Tl(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,Tl(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,Tl(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=gl;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!=(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&Zl(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[bl.extensionName].decompress(e,this._fin,((e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(Tl(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));this._fragments.push(r)}const s=this.dataMessage();if(s)return t(s);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?vl(t,e):"arraybuffer"===this._binaryType?_l(vl(t,e)):t,this.emit("message",r,!0)}else{const r=vl(t,e);if(!this._skipUTF8Validation&&!Ll(r))return this._loop=!1,Tl(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("message",r,!1)}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit("conclude",1005,gl),this.end();else{if(1===e.length)return Tl(RangeError,"invalid payload length 1",!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH");{const t=e.readUInt16BE(0);if(!Xl(t))return Tl(RangeError,`invalid status code ${t}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");const r=e.slice(2);if(!this._skipUTF8Validation&&!Ll(r))return Tl(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");this.emit("conclude",t,r),this.end()}}else 9===this._opcode?this.emit("ping",e):this.emit("pong",e);this._state=0}};function Tl(e,t,r,s,n){const i=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,Tl),i.code=n,i[wl]=s,i}const{randomFillSync:Gl}=X.default,kl=al,{EMPTY_BUFFER:Rl}=Ha,{isValidStatusCode:Wl}=hl.exports,{mask:Cl,toBuffer:Pl}=Ea.exports,Il=Buffer.alloc(4);class Vl{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,s=!1,n=2,i=!1;t.mask&&(r=t.maskBuffer||Il,t.generateMask?t.generateMask(r):Gl(r,0,4),i=0==(r[0]|r[1]|r[2]|r[3]),t.readOnly&&!i&&(s=!0),n=6);let o=e.length;e.length>=65536?(n+=8,o=127):e.length>125&&(n+=2,o=126);const a=Buffer.allocUnsafe(s?e.length+n:n);return a[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(a[0]|=64),a[1]=o,126===o?a.writeUInt16BE(e.length,2):127===o&&(a[2]=a[3]=0,a.writeUIntBE(e.length,4,6)),t.mask?(a[1]|=128,a[n-4]=r[0],a[n-3]=r[1],a[n-2]=r[2],a[n-1]=r[3],i?[a,e]:s?(Cl(e,r,a,n,e.length),[a]):(Cl(e,r,e,0,e.length),[a,e])):[a,e]}close(e,t,r,s){let n;if(void 0===e)n=Rl;else{if("number"!=typeof e||!Wl(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const r=Buffer.byteLength(t);if(r>123)throw new RangeError("The message must not be greater than 123 bytes");n=Buffer.allocUnsafe(2+r),n.writeUInt16BE(e,0),"string"==typeof t?n.write(t,2):n.set(t,2)}else n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0)}this._deflating?this.enqueue([this.doClose,n,r,s]):this.doClose(n,r,s)}doClose(e,t,r){this.sendFrame(Vl.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:!1}),r)}ping(e,t,r){const s=Pl(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPing,s,t,Pl.readOnly,r]):this.doPing(s,t,Pl.readOnly,r)}doPing(e,t,r,s){this.sendFrame(Vl.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:r}),s)}pong(e,t,r){const s=Pl(e);if(s.length>125)throw new RangeError("The data size must not be greater than 125 bytes");this._deflating?this.enqueue([this.doPong,s,t,Pl.readOnly,r]):this.doPong(s,t,Pl.readOnly,r)}doPong(e,t,r,s){this.sendFrame(Vl.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:r}),s)}send(e,t,r){const s=Pl(e),n=this._extensions[kl.extensionName];let i=t.binary?2:1,o=t.compress;if(this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(o=s.length>=n._threshold),this._compress=o):(o=!1,i=0),t.fin&&(this._firstFragment=!0),n){const e={fin:t.fin,rsv1:o,opcode:i,mask:t.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:Pl.readOnly};this._deflating?this.enqueue([this.dispatch,s,this._compress,e,r]):this.dispatch(s,this._compress,e,r)}else this.sendFrame(Vl.frame(s,{fin:t.fin,rsv1:!1,opcode:i,mask:t.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:Pl.readOnly}),r)}dispatch(e,t,r,s){if(!t)return void this.sendFrame(Vl.frame(e,r),s);const n=this._extensions[kl.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,n.compress(e,r.fin,((t,n)=>{if(this._socket.destroyed){const e=new Error("The socket was closed while data was being compressed");"function"==typeof s&&s(e);for(let t=0;t<this._queue.length;t++){const r=this._queue[t][4];"function"==typeof r&&r(e)}}else this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(Vl.frame(n,r),s),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Ml=Vl;const{kForOnEventAttribute:Yl,kListener:Kl}=Ha,El=Symbol("kCode"),Hl=Symbol("kData"),Fl=Symbol("kError"),zl=Symbol("kMessage"),Nl=Symbol("kReason"),jl=Symbol("kTarget"),Ul=Symbol("kType"),Ol=Symbol("kWasClean");class Ql{constructor(e){this[jl]=null,this[Ul]=e}get target(){return this[jl]}get type(){return this[Ul]}}Object.defineProperty(Ql.prototype,"target",{enumerable:!0}),Object.defineProperty(Ql.prototype,"type",{enumerable:!0});class Jl extends Ql{constructor(e,t={}){super(e),this[El]=void 0===t.code?0:t.code,this[Nl]=void 0===t.reason?"":t.reason,this[Ol]=void 0!==t.wasClean&&t.wasClean}get code(){return this[El]}get reason(){return this[Nl]}get wasClean(){return this[Ol]}}Object.defineProperty(Jl.prototype,"code",{enumerable:!0}),Object.defineProperty(Jl.prototype,"reason",{enumerable:!0}),Object.defineProperty(Jl.prototype,"wasClean",{enumerable:!0});class Dl extends Ql{constructor(e,t={}){super(e),this[Fl]=void 0===t.error?null:t.error,this[zl]=void 0===t.message?"":t.message}get error(){return this[Fl]}get message(){return this[zl]}}Object.defineProperty(Dl.prototype,"error",{enumerable:!0}),Object.defineProperty(Dl.prototype,"message",{enumerable:!0});class Bl extends Ql{constructor(e,t={}){super(e),this[Hl]=void 0===t.data?null:t.data}get data(){return this[Hl]}}Object.defineProperty(Bl.prototype,"data",{enumerable:!0});const Al={addEventListener(e,t,r={}){let s;if("message"===e)s=function(e,r){const s=new Bl("message",{data:r?e:e.toString()});s[jl]=this,t.call(this,s)};else if("close"===e)s=function(e,r){const s=new Jl("close",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[jl]=this,t.call(this,s)};else if("error"===e)s=function(e){const r=new Dl("error",{error:e,message:e.message});r[jl]=this,t.call(this,r)};else{if("open"!==e)return;s=function(){const e=new Ql("open");e[jl]=this,t.call(this,e)}}s[Yl]=!!r[Yl],s[Kl]=t,r.once?this.once(e,s):this.on(e,s)},removeEventListener(e,t){for(const r of this.listeners(e))if(r[Kl]===t&&!r[Yl]){this.removeListener(e,r);break}}};var $l={CloseEvent:Jl,ErrorEvent:Dl,Event:Ql,EventTarget:Al,MessageEvent:Bl};const{tokenChars:ql}=hl.exports;function ec(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}var tc={format:function(e){return Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>[t].concat(Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>!0===e?t:`${t}=${e}`)).join("; ")}))).join("; "))).join(", ")})).join(", ")},parse:function(e){const t=Object.create(null);let r,s,n=Object.create(null),i=!1,o=!1,a=!1,l=-1,c=-1,d=-1,h=0;for(;h<e.length;h++)if(c=e.charCodeAt(h),void 0===r)if(-1===d&&1===ql[c])-1===l&&(l=h);else if(0===h||32!==c&&9!==c){if(59!==c&&44!==c)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);const s=e.slice(l,d);44===c?(ec(t,s,n),n=Object.create(null)):r=s,l=d=-1}}else-1===d&&-1!==l&&(d=h);else if(void 0===s)if(-1===d&&1===ql[c])-1===l&&(l=h);else if(32===c||9===c)-1===d&&-1!==l&&(d=h);else if(59===c||44===c){if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h),ec(n,e.slice(l,d),!0),44===c&&(ec(t,r,n),n=Object.create(null),r=void 0),l=d=-1}else{if(61!==c||-1===l||-1!==d)throw new SyntaxError(`Unexpected character at index ${h}`);s=e.slice(l,h),l=d=-1}else if(o){if(1!==ql[c])throw new SyntaxError(`Unexpected character at index ${h}`);-1===l?l=h:i||(i=!0),o=!1}else if(a)if(1===ql[c])-1===l&&(l=h);else if(34===c&&-1!==l)a=!1,d=h;else{if(92!==c)throw new SyntaxError(`Unexpected character at index ${h}`);o=!0}else if(34===c&&61===e.charCodeAt(h-1))a=!0;else if(-1===d&&1===ql[c])-1===l&&(l=h);else if(-1===l||32!==c&&9!==c){if(59!==c&&44!==c)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);let o=e.slice(l,d);i&&(o=o.replace(/\\/g,""),i=!1),ec(n,s,o),44===c&&(ec(t,r,n),n=Object.create(null),r=void 0),s=void 0,l=d=-1}}else-1===d&&(d=h);if(-1===l||a||32===c||9===c)throw new SyntaxError("Unexpected end of input");-1===d&&(d=h);const u=e.slice(l,d);return void 0===r?ec(t,u,n):(void 0===s?ec(n,u,!0):ec(n,s,i?u.replace(/\\/g,""):u),ec(t,r,n)),t}};const rc=w.default,sc=v.default,nc=S.default,ic=_.default,oc=Z.default,{randomBytes:ac,createHash:lc}=X.default,{URL:cc}=x.default,dc=al,hc=xl,uc=Ml,{BINARY_TYPES:fc,EMPTY_BUFFER:pc,GUID:mc,kForOnEventAttribute:bc,kListener:yc,kStatusCode:gc,kWebSocket:wc,NOOP:Sc}=Ha,{EventTarget:{addEventListener:vc,removeEventListener:_c}}=$l,{format:Zc,parse:Xc}=tc,{toBuffer:Lc}=Ea.exports,xc=["CONNECTING","OPEN","CLOSING","CLOSED"],Tc=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/,Gc=[8,13];class kc extends rc{constructor(e,t,r){super(),this._binaryType=fc[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=pc,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol="",this._readyState=kc.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(r=t,t=[]):t=[t]),Wc(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){fc.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const s=new hc({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new uc(e,this._extensions,r.generateMask),this._receiver=s,this._socket=e,s[wc]=this,e[wc]=this,s.on("conclude",Yc),s.on("drain",Kc),s.on("error",Ec),s.on("message",Fc),s.on("ping",zc),s.on("pong",Nc),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Uc),e.on("data",Oc),e.on("end",Qc),e.on("error",Jc),this._readyState=kc.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=kc.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[dc.extensionName]&&this._extensions[dc.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=kc.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==kc.CLOSED){if(this.readyState===kc.CONNECTING){const e="WebSocket was closed before the connection was established";return Vc(this,this._req,e)}this.readyState!==kc.CLOSING?(this._readyState=kc.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==kc.CONNECTING&&this.readyState!==kc.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===kc.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===kc.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||pc,t,r)):Mc(this,e,r)}pong(e,t,r){if(this.readyState===kc.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(r=e,e=t=void 0):"function"==typeof t&&(r=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===kc.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||pc,t,r)):Mc(this,e,r)}resume(){this.readyState!==kc.CONNECTING&&this.readyState!==kc.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===kc.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(r=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==kc.OPEN)return void Mc(this,e,r);const s={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[dc.extensionName]||(s.compress=!1),this._sender.send(e||pc,s,r)}terminate(){if(this.readyState!==kc.CLOSED){if(this.readyState===kc.CONNECTING){const e="WebSocket was closed before the connection was established";return Vc(this,this._req,e)}this._socket&&(this._readyState=kc.CLOSING,this._socket.destroy())}}}Object.defineProperty(kc,"CONNECTING",{enumerable:!0,value:xc.indexOf("CONNECTING")}),Object.defineProperty(kc.prototype,"CONNECTING",{enumerable:!0,value:xc.indexOf("CONNECTING")}),Object.defineProperty(kc,"OPEN",{enumerable:!0,value:xc.indexOf("OPEN")}),Object.defineProperty(kc.prototype,"OPEN",{enumerable:!0,value:xc.indexOf("OPEN")}),Object.defineProperty(kc,"CLOSING",{enumerable:!0,value:xc.indexOf("CLOSING")}),Object.defineProperty(kc.prototype,"CLOSING",{enumerable:!0,value:xc.indexOf("CLOSING")}),Object.defineProperty(kc,"CLOSED",{enumerable:!0,value:xc.indexOf("CLOSED")}),Object.defineProperty(kc.prototype,"CLOSED",{enumerable:!0,value:xc.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach((e=>{Object.defineProperty(kc.prototype,e,{enumerable:!0})})),["open","error","close","message"].forEach((e=>{Object.defineProperty(kc.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[bc])return t[yc];return null},set(t){for(const t of this.listeners(e))if(t[bc]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[bc]:!0})}})})),kc.prototype.addEventListener=vc,kc.prototype.removeEventListener=_c;var Rc=kc;function Wc(e,t,r,s){const n={protocolVersion:Gc[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!Gc.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Gc.join(", ")})`);let i;if(t instanceof cc)i=t,e._url=t.href;else{try{i=new cc(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}e._url=t}const o="wss:"===i.protocol,a="ws+unix:"===i.protocol;let l;if("ws:"===i.protocol||o||a?a&&!i.pathname?l="The URL's pathname is empty":i.hash&&(l="The URL contains a fragment identifier"):l='The URL\'s protocol must be one of "ws:", "wss:", or "ws+unix:"',l){const t=new SyntaxError(l);if(0===e._redirects)throw t;return void Cc(e,t)}const c=o?443:80,d=ac(16).toString("base64"),h=o?sc.get:nc.get,u=new Set;let f;if(n.createConnection=o?Ic:Pc,n.defaultPort=n.defaultPort||c,n.port=i.port||c,n.host=i.hostname.startsWith("[")?i.hostname.slice(1,-1):i.hostname,n.headers={"Sec-WebSocket-Version":n.protocolVersion,"Sec-WebSocket-Key":d,Connection:"Upgrade",Upgrade:"websocket",...n.headers},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(f=new dc(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers["Sec-WebSocket-Extensions"]=Zc({[dc.extensionName]:f.offer()})),r.length){for(const e of r){if("string"!=typeof e||!Tc.test(e)||u.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");u.add(e)}n.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(n.origin&&(n.protocolVersion<13?n.headers["Sec-WebSocket-Origin"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){const e=n.path.split(":");n.socketPath=e[0],n.path=e[1]}let p=e._req=h(n);n.timeout&&p.on("timeout",(()=>{Vc(e,p,"Opening handshake has timed out")})),p.on("error",(t=>{null===p||p.aborted||(p=e._req=null,Cc(e,t))})),p.on("response",(i=>{const o=i.headers.location,a=i.statusCode;if(o&&n.followRedirects&&a>=300&&a<400){if(++e._redirects>n.maxRedirects)return void Vc(e,p,"Maximum redirects exceeded");let i;p.abort();try{i=new cc(o,t)}catch(t){const r=new SyntaxError(`Invalid URL: ${o}`);return void Cc(e,r)}Wc(e,i,r,s)}else e.emit("unexpected-response",p,i)||Vc(e,p,`Unexpected server response: ${i.statusCode}`)})),p.on("upgrade",((t,r,s)=>{if(e.emit("upgrade",t),e.readyState!==kc.CONNECTING)return;p=e._req=null;const i=lc("sha1").update(d+mc).digest("base64");if(t.headers["sec-websocket-accept"]!==i)return void Vc(e,r,"Invalid Sec-WebSocket-Accept header");const o=t.headers["sec-websocket-protocol"];let a;if(void 0!==o?u.size?u.has(o)||(a="Server sent an invalid subprotocol"):a="Server sent a subprotocol but none was requested":u.size&&(a="Server sent no subprotocol"),a)return void Vc(e,r,a);o&&(e._protocol=o);const l=t.headers["sec-websocket-extensions"];if(void 0!==l){if(!f){return void Vc(e,r,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=Xc(l)}catch(t){return void Vc(e,r,"Invalid Sec-WebSocket-Extensions header")}const s=Object.keys(t);if(1!==s.length||s[0]!==dc.extensionName){return void Vc(e,r,"Server indicated an extension that was not requested")}try{f.accept(t[dc.extensionName])}catch(t){return void Vc(e,r,"Invalid Sec-WebSocket-Extensions header")}e._extensions[dc.extensionName]=f}e.setSocket(r,s,{generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}))}function Cc(e,t){e._readyState=kc.CLOSING,e.emit("error",t),e.emitClose()}function Pc(e){return e.path=e.socketPath,ic.connect(e)}function Ic(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=ic.isIP(e.host)?"":e.host),oc.connect(e)}function Vc(e,t,r){e._readyState=kc.CLOSING;const s=new Error(r);Error.captureStackTrace(s,Vc),t.setHeader?(t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),t.once("abort",e.emitClose.bind(e)),e.emit("error",s)):(t.destroy(s),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function Mc(e,t,r){if(t){const r=Lc(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){r(new Error(`WebSocket is not open: readyState ${e.readyState} (${xc[e.readyState]})`))}}function Yc(e,t){const r=this[wc];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[wc]&&(r._socket.removeListener("data",Oc),process.nextTick(jc,r._socket),1005===e?r.close():r.close(e,t))}function Kc(){const e=this[wc];e.isPaused||e._socket.resume()}function Ec(e){const t=this[wc];void 0!==t._socket[wc]&&(t._socket.removeListener("data",Oc),process.nextTick(jc,t._socket),t.close(e[gc])),t.emit("error",e)}function Hc(){this[wc].emitClose()}function Fc(e,t){this[wc].emit("message",e,t)}function zc(e){const t=this[wc];t.pong(e,!t._isServer,Sc),t.emit("ping",e)}function Nc(e){this[wc].emit("pong",e)}function jc(e){e.resume()}function Uc(){const e=this[wc];let t;this.removeListener("close",Uc),this.removeListener("data",Oc),this.removeListener("end",Qc),e._readyState=kc.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[wc]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",Hc),e._receiver.on("finish",Hc))}function Oc(e){this[wc]._receiver.write(e)||this.pause()}function Qc(){const e=this[wc];e._readyState=kc.CLOSING,e._receiver.end(),this.end()}function Jc(){const e=this[wc];this.removeListener("error",Jc),this.on("error",Sc),e&&(e._readyState=kc.CLOSING,this.destroy())}var Dc={exports:{}};!function(e){const t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol:e=>`Symbol(${e})`;function r(){}function s(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==W?W:void 0}const n=s();function i(e){return"object"==typeof e&&null!==e||"function"==typeof e}const o=r,a=Promise,l=Promise.prototype.then,c=Promise.resolve.bind(a),d=Promise.reject.bind(a);function h(e){return new a(e)}function u(e){return c(e)}function f(e){return d(e)}function p(e,t,r){return l.call(e,t,r)}function m(e,t,r){p(p(e,t,r),void 0,o)}function b(e,t){m(e,t)}function y(e,t){m(e,void 0,t)}function g(e,t,r){return p(e,t,r)}function w(e){p(e,void 0,o)}const S=(()=>{const e=n&&n.queueMicrotask;if("function"==typeof e)return e;const t=u(void 0);return e=>p(t,e)})();function v(e,t,r){if("function"!=typeof e)throw new TypeError("Argument is not a function");return Function.prototype.apply.call(e,t,r)}function _(e,t,r){try{return u(v(e,t,r))}catch(e){return f(e)}}const Z=16384;class X{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){const t=this._back;let r=t;t._elements.length===Z-1&&(r={_elements:[],_next:void 0}),t._elements.push(e),r!==t&&(this._back=r,t._next=r),++this._size}shift(){const e=this._front;let t=e;const r=this._cursor;let s=r+1;const n=e._elements,i=n[r];return s===Z&&(t=e._next,s=0),--this._size,this._cursor=s,e!==t&&(this._front=t),n[r]=void 0,i}forEach(e){let t=this._cursor,r=this._front,s=r._elements;for(;!(t===s.length&&void 0===r._next||t===s.length&&(r=r._next,s=r._elements,t=0,0===s.length));)e(s[t]),++t}peek(){const e=this._front,t=this._cursor;return e._elements[t]}}function L(e,t){e._ownerReadableStream=t,t._reader=e,"readable"===t._state?k(e):"closed"===t._state?C(e):R(e,t._storedError)}function x(e,t){return Xs(e._ownerReadableStream,t)}function T(e){"readable"===e._ownerReadableStream._state?P(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")):I(e,new TypeError("Reader was released and can no longer be used to monitor the stream's closedness")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function G(e){return new TypeError("Cannot "+e+" a stream using a released reader")}function k(e){e._closedPromise=h(((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r}))}function R(e,t){k(e),P(e,t)}function C(e){k(e),V(e)}function P(e,t){void 0!==e._closedPromise_reject&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function I(e,t){R(e,t)}function V(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}const M=t("[[AbortSteps]]"),Y=t("[[ErrorSteps]]"),K=t("[[CancelSteps]]"),E=t("[[PullSteps]]"),H=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},F=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function z(e){return"object"==typeof e||"function"==typeof e}function N(e,t){if(void 0!==e&&!z(e))throw new TypeError(`${t} is not an object.`)}function j(e,t){if("function"!=typeof e)throw new TypeError(`${t} is not a function.`)}function U(e){return"object"==typeof e&&null!==e||"function"==typeof e}function O(e,t){if(!U(e))throw new TypeError(`${t} is not an object.`)}function Q(e,t,r){if(void 0===e)throw new TypeError(`Parameter ${t} is required in '${r}'.`)}function J(e,t,r){if(void 0===e)throw new TypeError(`${t} is required in '${r}'.`)}function D(e){return Number(e)}function B(e){return 0===e?0:e}function A(e){return B(F(e))}function $(e,t){const r=0,s=Number.MAX_SAFE_INTEGER;let n=Number(e);if(n=B(n),!H(n))throw new TypeError(`${t} is not a finite number`);if(n=A(n),n<r||n>s)throw new TypeError(`${t} is outside the accepted range of ${r} to ${s}, inclusive`);return H(n)&&0!==n?n:0}function q(e,t){if(!_s(e))throw new TypeError(`${t} is not a ReadableStream.`)}function ee(e){return new ie(e)}function te(e,t){e._reader._readRequests.push(t)}function re(e,t,r){const s=e._reader._readRequests.shift();r?s._closeSteps():s._chunkSteps(t)}function se(e){return e._reader._readRequests.length}function ne(e){const t=e._reader;return void 0!==t&&!!oe(t)}class ie{constructor(e){if(Q(e,1,"ReadableStreamDefaultReader"),q(e,"First parameter"),Zs(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");L(this,e),this._readRequests=new X}get closed(){return oe(this)?this._closedPromise:f(le("closed"))}cancel(e){return oe(this)?void 0===this._ownerReadableStream?f(G("cancel")):x(this,e):f(le("cancel"))}read(){if(!oe(this))return f(le("read"));if(void 0===this._ownerReadableStream)return f(G("read from"));let e,t;const r=h(((r,s)=>{e=r,t=s})),s={_chunkSteps:t=>e({value:t,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:e=>t(e)};return ae(this,s),r}releaseLock(){if(!oe(this))throw le("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");T(this)}}}function oe(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readRequests")&&e instanceof ie}function ae(e,t){const r=e._ownerReadableStream;r._disturbed=!0,"closed"===r._state?t._closeSteps():"errored"===r._state?t._errorSteps(r._storedError):r._readableStreamController[E](t)}function le(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(ie.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(ie.prototype,t.toStringTag,{value:"ReadableStreamDefaultReader",configurable:!0});const ce=Object.getPrototypeOf(Object.getPrototypeOf((async function*(){})).prototype);class de{constructor(e,t){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=t}next(){const e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?g(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){const t=()=>this._returnSteps(e);return this._ongoingPromise?g(this._ongoingPromise,t,t):t()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const e=this._reader;if(void 0===e._ownerReadableStream)return f(G("iterate"));let t,r;const s=h(((e,s)=>{t=e,r=s}));return ae(e,{_chunkSteps:e=>{this._ongoingPromise=void 0,S((()=>t({value:e,done:!1})))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),t({value:void 0,done:!0})},_errorSteps:t=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),r(t)}}),s}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;const t=this._reader;if(void 0===t._ownerReadableStream)return f(G("finish iterating"));if(!this._preventCancel){const r=x(t,e);return T(t),g(r,(()=>({value:e,done:!0})))}return T(t),u({value:e,done:!0})}}const he={next(){return fe(this)?this._asyncIteratorImpl.next():f(pe("next"))},return(e){return fe(this)?this._asyncIteratorImpl.return(e):f(pe("return"))}};function ue(e,t){const r=ee(e),s=new de(r,t),n=Object.create(he);return n._asyncIteratorImpl=s,n}function fe(e){if(!i(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,"_asyncIteratorImpl"))return!1;try{return e._asyncIteratorImpl instanceof de}catch(e){return!1}}function pe(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}void 0!==ce&&Object.setPrototypeOf(he,ce);const me=Number.isNaN||function(e){return e!=e};function be(e){return e.slice()}function ye(e,t,r,s,n){new Uint8Array(e).set(new Uint8Array(r,s,n),t)}function ge(e){return e}function we(e){return!1}function Se(e,t,r){if(e.slice)return e.slice(t,r);const s=r-t,n=new ArrayBuffer(s);return ye(n,0,e,t,s),n}function ve(e){return!("number"!=typeof e||me(e)||e<0)}function _e(e){const t=Se(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Ze(e){const t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Xe(e,t,r){if(!ve(r)||r===1/0)throw new RangeError("Size must be a finite, non-NaN, non-negative number.");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function Le(e){return e._queue.peek().value}function xe(e){e._queue=new X,e._queueTotalSize=0}class Te{constructor(){throw new TypeError("Illegal constructor")}get view(){if(!Re(this))throw nt("view");return this._view}respond(e){if(!Re(this))throw nt("respond");if(Q(e,1,"respond"),e=$(e,"First parameter"),void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");we(this._view.buffer),qe(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!Re(this))throw nt("respondWithNewView");if(Q(e,1,"respondWithNewView"),!ArrayBuffer.isView(e))throw new TypeError("You can only respond with array buffer views");if(void 0===this._associatedReadableByteStreamController)throw new TypeError("This BYOB request has been invalidated");we(e.buffer),et(this._associatedReadableByteStreamController,e)}}Object.defineProperties(Te.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Te.prototype,t.toStringTag,{value:"ReadableStreamBYOBRequest",configurable:!0});class Ge{constructor(){throw new TypeError("Illegal constructor")}get byobRequest(){if(!ke(this))throw it("byobRequest");return Ae(this)}get desiredSize(){if(!ke(this))throw it("desiredSize");return $e(this)}close(){if(!ke(this))throw it("close");if(this._closeRequested)throw new TypeError("The stream has already been closed; do not close it again!");const e=this._controlledReadableByteStream._state;if("readable"!==e)throw new TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);Je(this)}enqueue(e){if(!ke(this))throw it("enqueue");if(Q(e,1,"enqueue"),!ArrayBuffer.isView(e))throw new TypeError("chunk must be an array buffer view");if(0===e.byteLength)throw new TypeError("chunk must have non-zero byteLength");if(0===e.buffer.byteLength)throw new TypeError("chunk's buffer must have non-zero byteLength");if(this._closeRequested)throw new TypeError("stream is closed or draining");const t=this._controlledReadableByteStream._state;if("readable"!==t)throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be enqueued to`);De(this,e)}error(e){if(!ke(this))throw it("error");Be(this,e)}[K](e){Ce(this),xe(this);const t=this._cancelAlgorithm(e);return Qe(this),t}[E](e){const t=this._controlledReadableByteStream;if(this._queueTotalSize>0){const t=this._queue.shift();this._queueTotalSize-=t.byteLength,Ke(this);const r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return void e._chunkSteps(r)}const r=this._autoAllocateChunkSize;if(void 0!==r){let t;try{t=new ArrayBuffer(r)}catch(t){return void e._errorSteps(t)}const s={buffer:t,bufferByteLength:r,byteOffset:0,byteLength:r,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:"default"};this._pendingPullIntos.push(s)}te(t,e),We(this)}}function ke(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableByteStream")&&e instanceof Ge}function Re(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_associatedReadableByteStreamController")&&e instanceof Te}function We(e){Oe(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,m(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,We(e))}),(t=>{Be(e,t)}))))}function Ce(e){Ee(e),e._pendingPullIntos=new X}function Pe(e,t){let r=!1;"closed"===e._state&&(r=!0);const s=Ie(t);"default"===t.readerType?re(e,s,r):lt(e,s,r)}function Ie(e){const t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function Ve(e,t,r,s){e._queue.push({buffer:t,byteOffset:r,byteLength:s}),e._queueTotalSize+=s}function Me(e,t){const r=t.elementSize,s=t.bytesFilled-t.bytesFilled%r,n=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+n,o=i-i%r;let a=n,l=!1;o>s&&(a=o-t.bytesFilled,l=!0);const c=e._queue;for(;a>0;){const r=c.peek(),s=Math.min(a,r.byteLength),n=t.byteOffset+t.bytesFilled;ye(t.buffer,n,r.buffer,r.byteOffset,s),r.byteLength===s?c.shift():(r.byteOffset+=s,r.byteLength-=s),e._queueTotalSize-=s,Ye(e,s,t),a-=s}return l}function Ye(e,t,r){r.bytesFilled+=t}function Ke(e){0===e._queueTotalSize&&e._closeRequested?(Qe(e),Ls(e._controlledReadableByteStream)):We(e)}function Ee(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function He(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;const t=e._pendingPullIntos.peek();Me(e,t)&&(Ue(e),Pe(e._controlledReadableByteStream,t))}}function Fe(e,t,r){const s=e._controlledReadableByteStream;let n=1;t.constructor!==DataView&&(n=t.constructor.BYTES_PER_ELEMENT);const i=t.constructor,o=ge(t.buffer),a={buffer:o,bufferByteLength:o.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:n,viewConstructor:i,readerType:"byob"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(a),void at(s,r);if("closed"!==s._state){if(e._queueTotalSize>0){if(Me(e,a)){const t=Ie(a);return Ke(e),void r._chunkSteps(t)}if(e._closeRequested){const t=new TypeError("Insufficient bytes to fill elements in the given buffer");return Be(e,t),void r._errorSteps(t)}}e._pendingPullIntos.push(a),at(s,r),We(e)}else{const e=new i(a.buffer,a.byteOffset,0);r._closeSteps(e)}}function ze(e,t){const r=e._controlledReadableByteStream;if(dt(r))for(;ct(r)>0;)Pe(r,Ue(e))}function Ne(e,t,r){if(Ye(e,t,r),r.bytesFilled<r.elementSize)return;Ue(e);const s=r.bytesFilled%r.elementSize;if(s>0){const t=r.byteOffset+r.bytesFilled,n=Se(r.buffer,t-s,t);Ve(e,n,0,n.byteLength)}r.bytesFilled-=s,Pe(e._controlledReadableByteStream,r),He(e)}function je(e,t){const r=e._pendingPullIntos.peek();Ee(e),"closed"===e._controlledReadableByteStream._state?ze(e):Ne(e,t,r),We(e)}function Ue(e){return e._pendingPullIntos.shift()}function Oe(e){const t=e._controlledReadableByteStream;return"readable"===t._state&&!e._closeRequested&&!!e._started&&(!!(ne(t)&&se(t)>0)||!!(dt(t)&&ct(t)>0)||$e(e)>0)}function Qe(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Je(e){const t=e._controlledReadableByteStream;if(!e._closeRequested&&"readable"===t._state)if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){const t=new TypeError("Insufficient bytes to fill elements in the given buffer");throw Be(e,t),t}Qe(e),Ls(t)}}function De(e,t){const r=e._controlledReadableByteStream;if(e._closeRequested||"readable"!==r._state)return;const s=t.buffer,n=t.byteOffset,i=t.byteLength,o=ge(s);if(e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek();we(t.buffer),t.buffer=ge(t.buffer)}Ee(e),ne(r)?0===se(r)?Ve(e,o,n,i):(e._pendingPullIntos.length>0&&Ue(e),re(r,new Uint8Array(o,n,i),!1)):dt(r)?(Ve(e,o,n,i),He(e)):Ve(e,o,n,i),We(e)}function Be(e,t){const r=e._controlledReadableByteStream;"readable"===r._state&&(Ce(e),xe(e),Qe(e),xs(r,t))}function Ae(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),s=Object.create(Te.prototype);st(s,e,r),e._byobRequest=s}return e._byobRequest}function $e(e){const t=e._controlledReadableByteStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function qe(e,t){const r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError("bytesWritten must be 0 when calling respond() on a closed stream")}else{if(0===t)throw new TypeError("bytesWritten must be greater than 0 when calling respond() on a readable stream");if(r.bytesFilled+t>r.byteLength)throw new RangeError("bytesWritten out of range")}r.buffer=ge(r.buffer),je(e,t)}function et(e,t){const r=e._pendingPullIntos.peek();if("closed"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw new TypeError("The view's length must be 0 when calling respondWithNewView() on a closed stream")}else if(0===t.byteLength)throw new TypeError("The view's length must be greater than 0 when calling respondWithNewView() on a readable stream");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError("The region specified by view does not match byobRequest");if(r.bufferByteLength!==t.buffer.byteLength)throw new RangeError("The buffer of view has different capacity than byobRequest");if(r.bytesFilled+t.byteLength>r.byteLength)throw new RangeError("The region specified by view is larger than byobRequest");const s=t.byteLength;r.buffer=ge(t.buffer),je(e,s)}function tt(e,t,r,s,n,i,o){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,xe(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=i,t._pullAlgorithm=s,t._cancelAlgorithm=n,t._autoAllocateChunkSize=o,t._pendingPullIntos=new X,e._readableStreamController=t,m(u(r()),(()=>{t._started=!0,We(t)}),(e=>{Be(t,e)}))}function rt(e,t,r){const s=Object.create(Ge.prototype);let n=()=>{},i=()=>u(void 0),o=()=>u(void 0);void 0!==t.start&&(n=()=>t.start(s)),void 0!==t.pull&&(i=()=>t.pull(s)),void 0!==t.cancel&&(o=e=>t.cancel(e));const a=t.autoAllocateChunkSize;if(0===a)throw new TypeError("autoAllocateChunkSize must be greater than 0");tt(e,s,n,i,o,r,a)}function st(e,t,r){e._associatedReadableByteStreamController=t,e._view=r}function nt(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function it(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function ot(e){return new ht(e)}function at(e,t){e._reader._readIntoRequests.push(t)}function lt(e,t,r){const s=e._reader._readIntoRequests.shift();r?s._closeSteps(t):s._chunkSteps(t)}function ct(e){return e._reader._readIntoRequests.length}function dt(e){const t=e._reader;return void 0!==t&&!!ut(t)}Object.defineProperties(Ge.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Ge.prototype,t.toStringTag,{value:"ReadableByteStreamController",configurable:!0});class ht{constructor(e){if(Q(e,1,"ReadableStreamBYOBReader"),q(e,"First parameter"),Zs(e))throw new TypeError("This stream has already been locked for exclusive reading by another reader");if(!ke(e._readableStreamController))throw new TypeError("Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source");L(this,e),this._readIntoRequests=new X}get closed(){return ut(this)?this._closedPromise:f(pt("closed"))}cancel(e){return ut(this)?void 0===this._ownerReadableStream?f(G("cancel")):x(this,e):f(pt("cancel"))}read(e){if(!ut(this))return f(pt("read"));if(!ArrayBuffer.isView(e))return f(new TypeError("view must be an array buffer view"));if(0===e.byteLength)return f(new TypeError("view must have non-zero byteLength"));if(0===e.buffer.byteLength)return f(new TypeError("view's buffer must have non-zero byteLength"));if(we(e.buffer),void 0===this._ownerReadableStream)return f(G("read from"));let t,r;const s=h(((e,s)=>{t=e,r=s})),n={_chunkSteps:e=>t({value:e,done:!1}),_closeSteps:e=>t({value:e,done:!0}),_errorSteps:e=>r(e)};return ft(this,e,n),s}releaseLock(){if(!ut(this))throw pt("releaseLock");if(void 0!==this._ownerReadableStream){if(this._readIntoRequests.length>0)throw new TypeError("Tried to release a reader lock when that reader has pending read() calls un-settled");T(this)}}}function ut(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readIntoRequests")&&e instanceof ht}function ft(e,t,r){const s=e._ownerReadableStream;s._disturbed=!0,"errored"===s._state?r._errorSteps(s._storedError):Fe(s._readableStreamController,t,r)}function pt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function mt(e,t){const{highWaterMark:r}=e;if(void 0===r)return t;if(me(r)||r<0)throw new RangeError("Invalid highWaterMark");return r}function bt(e){const{size:t}=e;return t||(()=>1)}function yt(e,t){N(e,t);const r=null==e?void 0:e.highWaterMark,s=null==e?void 0:e.size;return{highWaterMark:void 0===r?void 0:D(r),size:void 0===s?void 0:gt(s,`${t} has member 'size' that`)}}function gt(e,t){return j(e,t),t=>D(e(t))}function wt(e,t){N(e,t);const r=null==e?void 0:e.abort,s=null==e?void 0:e.close,n=null==e?void 0:e.start,i=null==e?void 0:e.type,o=null==e?void 0:e.write;return{abort:void 0===r?void 0:St(r,e,`${t} has member 'abort' that`),close:void 0===s?void 0:vt(s,e,`${t} has member 'close' that`),start:void 0===n?void 0:_t(n,e,`${t} has member 'start' that`),write:void 0===o?void 0:Zt(o,e,`${t} has member 'write' that`),type:i}}function St(e,t,r){return j(e,r),r=>_(e,t,[r])}function vt(e,t,r){return j(e,r),()=>_(e,t,[])}function _t(e,t,r){return j(e,r),r=>v(e,t,[r])}function Zt(e,t,r){return j(e,r),(r,s)=>_(e,t,[r,s])}function Xt(e,t){if(!Ct(e))throw new TypeError(`${t} is not a WritableStream.`)}function Lt(e){if("object"!=typeof e||null===e)return!1;try{return"boolean"==typeof e.aborted}catch(e){return!1}}Object.defineProperties(ht.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(ht.prototype,t.toStringTag,{value:"ReadableStreamBYOBReader",configurable:!0});const xt="function"==typeof AbortController;function Tt(){if(xt)return new AbortController}class Gt{constructor(e={},t={}){void 0===e?e=null:O(e,"First parameter");const r=yt(t,"Second parameter"),s=wt(e,"First parameter");if(Wt(this),void 0!==s.type)throw new RangeError("Invalid type is specified");const n=bt(r);dr(this,s,mt(r,1),n)}get locked(){if(!Ct(this))throw _r("locked");return Pt(this)}abort(e){return Ct(this)?Pt(this)?f(new TypeError("Cannot abort a stream that already has a writer")):It(this,e):f(_r("abort"))}close(){return Ct(this)?Pt(this)?f(new TypeError("Cannot close a stream that already has a writer")):jt(this)?f(new TypeError("Cannot close an already-closing stream")):Vt(this):f(_r("close"))}getWriter(){if(!Ct(this))throw _r("getWriter");return kt(this)}}function kt(e){return new Bt(e)}function Rt(e,t,r,s,n=1,i=(()=>1)){const o=Object.create(Gt.prototype);return Wt(o),cr(o,Object.create(ar.prototype),e,t,r,s,n,i),o}function Wt(e){e._state="writable",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new X,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function Ct(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_writableStreamController")&&e instanceof Gt}function Pt(e){return void 0!==e._writer}function It(e,t){var r;if("closed"===e._state||"errored"===e._state)return u(void 0);e._writableStreamController._abortReason=t,null===(r=e._writableStreamController._abortController)||void 0===r||r.abort();const s=e._state;if("closed"===s||"errored"===s)return u(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;let n=!1;"erroring"===s&&(n=!0,t=void 0);const i=h(((r,s)=>{e._pendingAbortRequest={_promise:void 0,_resolve:r,_reject:s,_reason:t,_wasAlreadyErroring:n}}));return e._pendingAbortRequest._promise=i,n||Kt(e,t),i}function Vt(e){const t=e._state;if("closed"===t||"errored"===t)return f(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));const r=h(((t,r)=>{const s={_resolve:t,_reject:r};e._closeRequest=s})),s=e._writer;return void 0!==s&&e._backpressure&&"writable"===t&&Kr(s),ur(e._writableStreamController),r}function Mt(e){return h(((t,r)=>{const s={_resolve:t,_reject:r};e._writeRequests.push(s)}))}function Yt(e,t){"writable"!==e._state?Et(e):Kt(e,t)}function Kt(e,t){const r=e._writableStreamController;e._state="erroring",e._storedError=t;const s=e._writer;void 0!==s&&rr(s,t),!Ut(e)&&r._started&&Et(e)}function Et(e){e._state="errored",e._writableStreamController[Y]();const t=e._storedError;if(e._writeRequests.forEach((e=>{e._reject(t)})),e._writeRequests=new X,void 0===e._pendingAbortRequest)return void Jt(e);const r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(t),void Jt(e);m(e._writableStreamController[M](r._reason),(()=>{r._resolve(),Jt(e)}),(t=>{r._reject(t),Jt(e)}))}function Ht(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Ft(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Yt(e,t)}function zt(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,"erroring"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state="closed";const t=e._writer;void 0!==t&&Wr(t)}function Nt(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Yt(e,t)}function jt(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function Ut(e){return void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest}function Ot(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Qt(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Jt(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);const t=e._writer;void 0!==t&&kr(t,e._storedError)}function Dt(e,t){const r=e._writer;void 0!==r&&t!==e._backpressure&&(t?Mr(r):Kr(r)),e._backpressure=t}Object.defineProperties(Gt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Gt.prototype,t.toStringTag,{value:"WritableStream",configurable:!0});class Bt{constructor(e){if(Q(e,1,"WritableStreamDefaultWriter"),Xt(e,"First parameter"),Pt(e))throw new TypeError("This stream has already been locked for exclusive writing by another writer");this._ownerWritableStream=e,e._writer=this;const t=e._state;if("writable"===t)!jt(e)&&e._backpressure?Cr(this):Ir(this),xr(this);else if("erroring"===t)Pr(this,e._storedError),xr(this);else if("closed"===t)Ir(this),Gr(this);else{const t=e._storedError;Pr(this,t),Tr(this,t)}}get closed(){return At(this)?this._closedPromise:f(Xr("closed"))}get desiredSize(){if(!At(this))throw Xr("desiredSize");if(void 0===this._ownerWritableStream)throw Lr("desiredSize");return sr(this)}get ready(){return At(this)?this._readyPromise:f(Xr("ready"))}abort(e){return At(this)?void 0===this._ownerWritableStream?f(Lr("abort")):$t(this,e):f(Xr("abort"))}close(){if(!At(this))return f(Xr("close"));const e=this._ownerWritableStream;return void 0===e?f(Lr("close")):jt(e)?f(new TypeError("Cannot close an already-closing stream")):qt(this)}releaseLock(){if(!At(this))throw Xr("releaseLock");void 0!==this._ownerWritableStream&&nr(this)}write(e){return At(this)?void 0===this._ownerWritableStream?f(Lr("write to")):ir(this,e):f(Xr("write"))}}function At(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_ownerWritableStream")&&e instanceof Bt}function $t(e,t){return It(e._ownerWritableStream,t)}function qt(e){return Vt(e._ownerWritableStream)}function er(e){const t=e._ownerWritableStream,r=t._state;return jt(t)||"closed"===r?u(void 0):"errored"===r?f(t._storedError):qt(e)}function tr(e,t){"pending"===e._closedPromiseState?kr(e,t):Rr(e,t)}function rr(e,t){"pending"===e._readyPromiseState?Vr(e,t):Yr(e,t)}function sr(e){const t=e._ownerWritableStream,r=t._state;return"errored"===r||"erroring"===r?null:"closed"===r?0:pr(t._writableStreamController)}function nr(e){const t=e._ownerWritableStream,r=new TypeError("Writer was released and can no longer be used to monitor the stream's closedness");rr(e,r),tr(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function ir(e,t){const r=e._ownerWritableStream,s=r._writableStreamController,n=fr(s,t);if(r!==e._ownerWritableStream)return f(Lr("write to"));const i=r._state;if("errored"===i)return f(r._storedError);if(jt(r)||"closed"===i)return f(new TypeError("The stream is closing or closed and cannot be written to"));if("erroring"===i)return f(r._storedError);const o=Mt(r);return mr(s,t,n),o}Object.defineProperties(Bt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Bt.prototype,t.toStringTag,{value:"WritableStreamDefaultWriter",configurable:!0});const or={};class ar{constructor(){throw new TypeError("Illegal constructor")}get abortReason(){if(!lr(this))throw Zr("abortReason");return this._abortReason}get signal(){if(!lr(this))throw Zr("signal");if(void 0===this._abortController)throw new TypeError("WritableStreamDefaultController.prototype.signal is not supported");return this._abortController.signal}error(e){if(!lr(this))throw Zr("error");"writable"===this._controlledWritableStream._state&&vr(this,e)}[M](e){const t=this._abortAlgorithm(e);return hr(this),t}[Y](){xe(this)}}function lr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledWritableStream")&&e instanceof ar}function cr(e,t,r,s,n,i,o,a){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,xe(t),t._abortReason=void 0,t._abortController=Tt(),t._started=!1,t._strategySizeAlgorithm=a,t._strategyHWM=o,t._writeAlgorithm=s,t._closeAlgorithm=n,t._abortAlgorithm=i;const l=Sr(t);Dt(e,l),m(u(r()),(()=>{t._started=!0,br(t)}),(r=>{t._started=!0,Yt(e,r)}))}function dr(e,t,r,s){const n=Object.create(ar.prototype);let i=()=>{},o=()=>u(void 0),a=()=>u(void 0),l=()=>u(void 0);void 0!==t.start&&(i=()=>t.start(n)),void 0!==t.write&&(o=e=>t.write(e,n)),void 0!==t.close&&(a=()=>t.close()),void 0!==t.abort&&(l=e=>t.abort(e)),cr(e,n,i,o,a,l,r,s)}function hr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ur(e){Xe(e,or,0),br(e)}function fr(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return yr(e,t),1}}function pr(e){return e._strategyHWM-e._queueTotalSize}function mr(e,t,r){try{Xe(e,t,r)}catch(t){return void yr(e,t)}const s=e._controlledWritableStream;jt(s)||"writable"!==s._state||Dt(s,Sr(e)),br(e)}function br(e){const t=e._controlledWritableStream;if(!e._started)return;if(void 0!==t._inFlightWriteRequest)return;if("erroring"===t._state)return void Et(t);if(0===e._queue.length)return;const r=Le(e);r===or?gr(e):wr(e,r)}function yr(e,t){"writable"===e._controlledWritableStream._state&&vr(e,t)}function gr(e){const t=e._controlledWritableStream;Ot(t),Ze(e);const r=e._closeAlgorithm();hr(e),m(r,(()=>{zt(t)}),(e=>{Nt(t,e)}))}function wr(e,t){const r=e._controlledWritableStream;Qt(r),m(e._writeAlgorithm(t),(()=>{Ht(r);const t=r._state;if(Ze(e),!jt(r)&&"writable"===t){const t=Sr(e);Dt(r,t)}br(e)}),(t=>{"writable"===r._state&&hr(e),Ft(r,t)}))}function Sr(e){return pr(e)<=0}function vr(e,t){const r=e._controlledWritableStream;hr(e),Kt(r,t)}function _r(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Zr(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Xr(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function Lr(e){return new TypeError("Cannot "+e+" a stream using a released writer")}function xr(e){e._closedPromise=h(((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState="pending"}))}function Tr(e,t){xr(e),kr(e,t)}function Gr(e){xr(e),Wr(e)}function kr(e,t){void 0!==e._closedPromise_reject&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="rejected")}function Rr(e,t){Tr(e,t)}function Wr(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState="resolved")}function Cr(e){e._readyPromise=h(((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r})),e._readyPromiseState="pending"}function Pr(e,t){Cr(e),Vr(e,t)}function Ir(e){Cr(e),Kr(e)}function Vr(e,t){void 0!==e._readyPromise_reject&&(w(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="rejected")}function Mr(e){Cr(e)}function Yr(e,t){Pr(e,t)}function Kr(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState="fulfilled")}Object.defineProperties(ar.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(ar.prototype,t.toStringTag,{value:"WritableStreamDefaultController",configurable:!0});const Er="undefined"!=typeof DOMException?DOMException:void 0;function Hr(e){if("function"!=typeof e&&"object"!=typeof e)return!1;try{return new e,!0}catch(e){return!1}}function Fr(){const e=function(e,t){this.message=e||"",this.name=t||"Error",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,"constructor",{value:e,writable:!0,configurable:!0}),e}const zr=Hr(Er)?Er:Fr();function Nr(e,t,s,n,i,o){const a=ee(e),l=kt(t);e._disturbed=!0;let c=!1,d=u(void 0);return h(((f,g)=>{let S;if(void 0!==o){if(S=()=>{const r=new zr("Aborted","AbortError"),s=[];n||s.push((()=>"writable"===t._state?It(t,r):u(void 0))),i||s.push((()=>"readable"===e._state?Xs(e,r):u(void 0))),x((()=>Promise.all(s.map((e=>e())))),!0,r)},o.aborted)return void S();o.addEventListener("abort",S)}function v(){return h(((e,t)=>{function r(s){s?e():p(_(),r,t)}r(!1)}))}function _(){return c?u(!0):p(l._readyPromise,(()=>h(((e,t)=>{ae(a,{_chunkSteps:t=>{d=p(ir(l,t),void 0,r),e(!1)},_closeSteps:()=>e(!0),_errorSteps:t})}))))}if(X(e,a._closedPromise,(e=>{n?G(!0,e):x((()=>It(t,e)),!0,e)})),X(t,l._closedPromise,(t=>{i?G(!0,t):x((()=>Xs(e,t)),!0,t)})),L(e,a._closedPromise,(()=>{s?G():x((()=>er(l)))})),jt(t)||"closed"===t._state){const t=new TypeError("the destination writable stream closed before all data could be piped to it");i?G(!0,t):x((()=>Xs(e,t)),!0,t)}function Z(){const e=d;return p(d,(()=>e!==d?Z():void 0))}function X(e,t,r){"errored"===e._state?r(e._storedError):y(t,r)}function L(e,t,r){"closed"===e._state?r():b(t,r)}function x(e,r,s){function n(){m(e(),(()=>k(r,s)),(e=>k(!0,e)))}c||(c=!0,"writable"!==t._state||jt(t)?n():b(Z(),n))}function G(e,r){c||(c=!0,"writable"!==t._state||jt(t)?k(e,r):b(Z(),(()=>k(e,r))))}function k(e,t){nr(l),T(a),void 0!==o&&o.removeEventListener("abort",S),e?g(t):f(void 0)}w(v())}))}class jr{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Ur(this))throw ss("desiredSize");return $r(this)}close(){if(!Ur(this))throw ss("close");if(!es(this))throw new TypeError("The stream is not in a state that permits close");Dr(this)}enqueue(e){if(!Ur(this))throw ss("enqueue");if(!es(this))throw new TypeError("The stream is not in a state that permits enqueue");return Br(this,e)}error(e){if(!Ur(this))throw ss("error");Ar(this,e)}[K](e){xe(this);const t=this._cancelAlgorithm(e);return Jr(this),t}[E](e){const t=this._controlledReadableStream;if(this._queue.length>0){const r=Ze(this);this._closeRequested&&0===this._queue.length?(Jr(this),Ls(t)):Or(this),e._chunkSteps(r)}else te(t,e),Or(this)}}function Ur(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledReadableStream")&&e instanceof jr}function Or(e){Qr(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,m(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Or(e))}),(t=>{Ar(e,t)}))))}function Qr(e){const t=e._controlledReadableStream;return!!es(e)&&!!e._started&&(!!(Zs(t)&&se(t)>0)||$r(e)>0)}function Jr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Dr(e){if(!es(e))return;const t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Jr(e),Ls(t))}function Br(e,t){if(!es(e))return;const r=e._controlledReadableStream;if(Zs(r)&&se(r)>0)re(r,t,!1);else{let r;try{r=e._strategySizeAlgorithm(t)}catch(t){throw Ar(e,t),t}try{Xe(e,t,r)}catch(t){throw Ar(e,t),t}}Or(e)}function Ar(e,t){const r=e._controlledReadableStream;"readable"===r._state&&(xe(e),Jr(e),xs(r,t))}function $r(e){const t=e._controlledReadableStream._state;return"errored"===t?null:"closed"===t?0:e._strategyHWM-e._queueTotalSize}function qr(e){return!Qr(e)}function es(e){const t=e._controlledReadableStream._state;return!e._closeRequested&&"readable"===t}function ts(e,t,r,s,n,i,o){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,xe(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=o,t._strategyHWM=i,t._pullAlgorithm=s,t._cancelAlgorithm=n,e._readableStreamController=t,m(u(r()),(()=>{t._started=!0,Or(t)}),(e=>{Ar(t,e)}))}function rs(e,t,r,s){const n=Object.create(jr.prototype);let i=()=>{},o=()=>u(void 0),a=()=>u(void 0);void 0!==t.start&&(i=()=>t.start(n)),void 0!==t.pull&&(o=()=>t.pull(n)),void 0!==t.cancel&&(a=e=>t.cancel(e)),ts(e,n,i,o,a,r,s)}function ss(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function ns(e,t){return ke(e._readableStreamController)?os(e):is(e)}function is(e,t){const r=ee(e);let s,n,i,o,a,l=!1,c=!1,d=!1,f=!1;const p=h((e=>{a=e}));function m(){return l?(c=!0,u(void 0)):(l=!0,ae(r,{_chunkSteps:e=>{S((()=>{c=!1;const t=e,r=e;d||Br(i._readableStreamController,t),f||Br(o._readableStreamController,r),l=!1,c&&m()}))},_closeSteps:()=>{l=!1,d||Dr(i._readableStreamController),f||Dr(o._readableStreamController),d&&f||a(void 0)},_errorSteps:()=>{l=!1}}),u(void 0))}function b(t){if(d=!0,s=t,f){const t=be([s,n]),r=Xs(e,t);a(r)}return p}function g(t){if(f=!0,n=t,d){const t=be([s,n]),r=Xs(e,t);a(r)}return p}function w(){}return i=ws(w,m,b),o=ws(w,m,g),y(r._closedPromise,(e=>{Ar(i._readableStreamController,e),Ar(o._readableStreamController,e),d&&f||a(void 0)})),[i,o]}function os(e){let t,r,s,n,i,o=ee(e),a=!1,l=!1,c=!1,d=!1,f=!1;const p=h((e=>{i=e}));function m(e){y(e._closedPromise,(t=>{e===o&&(Be(s._readableStreamController,t),Be(n._readableStreamController,t),d&&f||i(void 0))}))}function b(){ut(o)&&(T(o),o=ee(e),m(o)),ae(o,{_chunkSteps:t=>{S((()=>{l=!1,c=!1;const r=t;let o=t;if(!d&&!f)try{o=_e(t)}catch(t){return Be(s._readableStreamController,t),Be(n._readableStreamController,t),void i(Xs(e,t))}d||De(s._readableStreamController,r),f||De(n._readableStreamController,o),a=!1,l?w():c&&v()}))},_closeSteps:()=>{a=!1,d||Je(s._readableStreamController),f||Je(n._readableStreamController),s._readableStreamController._pendingPullIntos.length>0&&qe(s._readableStreamController,0),n._readableStreamController._pendingPullIntos.length>0&&qe(n._readableStreamController,0),d&&f||i(void 0)},_errorSteps:()=>{a=!1}})}function g(t,r){oe(o)&&(T(o),o=ot(e),m(o));const h=r?n:s,u=r?s:n;ft(o,t,{_chunkSteps:t=>{S((()=>{l=!1,c=!1;const s=r?f:d;if(r?d:f)s||et(h._readableStreamController,t);else{let r;try{r=_e(t)}catch(t){return Be(h._readableStreamController,t),Be(u._readableStreamController,t),void i(Xs(e,t))}s||et(h._readableStreamController,t),De(u._readableStreamController,r)}a=!1,l?w():c&&v()}))},_closeSteps:e=>{a=!1;const t=r?f:d,s=r?d:f;t||Je(h._readableStreamController),s||Je(u._readableStreamController),void 0!==e&&(t||et(h._readableStreamController,e),!s&&u._readableStreamController._pendingPullIntos.length>0&&qe(u._readableStreamController,0)),t&&s||i(void 0)},_errorSteps:()=>{a=!1}})}function w(){if(a)return l=!0,u(void 0);a=!0;const e=Ae(s._readableStreamController);return null===e?b():g(e._view,!1),u(void 0)}function v(){if(a)return c=!0,u(void 0);a=!0;const e=Ae(n._readableStreamController);return null===e?b():g(e._view,!0),u(void 0)}function _(s){if(d=!0,t=s,f){const s=be([t,r]),n=Xs(e,s);i(n)}return p}function Z(s){if(f=!0,r=s,d){const s=be([t,r]),n=Xs(e,s);i(n)}return p}function X(){}return s=Ss(X,w,_),n=Ss(X,v,Z),m(o),[s,n]}function as(e,t){N(e,t);const r=e,s=null==r?void 0:r.autoAllocateChunkSize,n=null==r?void 0:r.cancel,i=null==r?void 0:r.pull,o=null==r?void 0:r.start,a=null==r?void 0:r.type;return{autoAllocateChunkSize:void 0===s?void 0:$(s,`${t} has member 'autoAllocateChunkSize' that`),cancel:void 0===n?void 0:ls(n,r,`${t} has member 'cancel' that`),pull:void 0===i?void 0:cs(i,r,`${t} has member 'pull' that`),start:void 0===o?void 0:ds(o,r,`${t} has member 'start' that`),type:void 0===a?void 0:hs(a,`${t} has member 'type' that`)}}function ls(e,t,r){return j(e,r),r=>_(e,t,[r])}function cs(e,t,r){return j(e,r),r=>_(e,t,[r])}function ds(e,t,r){return j(e,r),r=>v(e,t,[r])}function hs(e,t){if("bytes"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function us(e,t){N(e,t);const r=null==e?void 0:e.mode;return{mode:void 0===r?void 0:fs(r,`${t} has member 'mode' that`)}}function fs(e,t){if("byob"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function ps(e,t){N(e,t);const r=null==e?void 0:e.preventCancel;return{preventCancel:Boolean(r)}}function ms(e,t){N(e,t);const r=null==e?void 0:e.preventAbort,s=null==e?void 0:e.preventCancel,n=null==e?void 0:e.preventClose,i=null==e?void 0:e.signal;return void 0!==i&&bs(i,`${t} has member 'signal' that`),{preventAbort:Boolean(r),preventCancel:Boolean(s),preventClose:Boolean(n),signal:i}}function bs(e,t){if(!Lt(e))throw new TypeError(`${t} is not an AbortSignal.`)}function ys(e,t){N(e,t);const r=null==e?void 0:e.readable;J(r,"readable","ReadableWritablePair"),q(r,`${t} has member 'readable' that`);const s=null==e?void 0:e.writable;return J(s,"writable","ReadableWritablePair"),Xt(s,`${t} has member 'writable' that`),{readable:r,writable:s}}Object.defineProperties(jr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(jr.prototype,t.toStringTag,{value:"ReadableStreamDefaultController",configurable:!0});class gs{constructor(e={},t={}){void 0===e?e=null:O(e,"First parameter");const r=yt(t,"Second parameter"),s=as(e,"First parameter");if(vs(this),"bytes"===s.type){if(void 0!==r.size)throw new RangeError("The strategy for a byte stream cannot have a size function");rt(this,s,mt(r,0))}else{const e=bt(r);rs(this,s,mt(r,1),e)}}get locked(){if(!_s(this))throw Ts("locked");return Zs(this)}cancel(e){return _s(this)?Zs(this)?f(new TypeError("Cannot cancel a stream that already has a reader")):Xs(this,e):f(Ts("cancel"))}getReader(e){if(!_s(this))throw Ts("getReader");return void 0===us(e,"First parameter").mode?ee(this):ot(this)}pipeThrough(e,t={}){if(!_s(this))throw Ts("pipeThrough");Q(e,1,"pipeThrough");const r=ys(e,"First parameter"),s=ms(t,"Second parameter");if(Zs(this))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream");if(Pt(r.writable))throw new TypeError("ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream");return w(Nr(this,r.writable,s.preventClose,s.preventAbort,s.preventCancel,s.signal)),r.readable}pipeTo(e,t={}){if(!_s(this))return f(Ts("pipeTo"));if(void 0===e)return f("Parameter 1 is required in 'pipeTo'.");if(!Ct(e))return f(new TypeError("ReadableStream.prototype.pipeTo's first argument must be a WritableStream"));let r;try{r=ms(t,"Second parameter")}catch(e){return f(e)}return Zs(this)?f(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream")):Pt(e)?f(new TypeError("ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream")):Nr(this,e,r.preventClose,r.preventAbort,r.preventCancel,r.signal)}tee(){if(!_s(this))throw Ts("tee");return be(ns(this))}values(e){if(!_s(this))throw Ts("values");return ue(this,ps(e,"First parameter").preventCancel)}}function ws(e,t,r,s=1,n=(()=>1)){const i=Object.create(gs.prototype);return vs(i),ts(i,Object.create(jr.prototype),e,t,r,s,n),i}function Ss(e,t,r){const s=Object.create(gs.prototype);return vs(s),tt(s,Object.create(Ge.prototype),e,t,r,0,void 0),s}function vs(e){e._state="readable",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function _s(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_readableStreamController")&&e instanceof gs}function Zs(e){return void 0!==e._reader}function Xs(e,t){if(e._disturbed=!0,"closed"===e._state)return u(void 0);if("errored"===e._state)return f(e._storedError);Ls(e);const s=e._reader;return void 0!==s&&ut(s)&&(s._readIntoRequests.forEach((e=>{e._closeSteps(void 0)})),s._readIntoRequests=new X),g(e._readableStreamController[K](t),r)}function Ls(e){e._state="closed";const t=e._reader;void 0!==t&&(V(t),oe(t)&&(t._readRequests.forEach((e=>{e._closeSteps()})),t._readRequests=new X))}function xs(e,t){e._state="errored",e._storedError=t;const r=e._reader;void 0!==r&&(P(r,t),oe(r)?(r._readRequests.forEach((e=>{e._errorSteps(t)})),r._readRequests=new X):(r._readIntoRequests.forEach((e=>{e._errorSteps(t)})),r._readIntoRequests=new X))}function Ts(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function Gs(e,t){N(e,t);const r=null==e?void 0:e.highWaterMark;return J(r,"highWaterMark","QueuingStrategyInit"),{highWaterMark:D(r)}}Object.defineProperties(gs.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(gs.prototype,t.toStringTag,{value:"ReadableStream",configurable:!0}),"symbol"==typeof t.asyncIterator&&Object.defineProperty(gs.prototype,t.asyncIterator,{value:gs.prototype.values,writable:!0,configurable:!0});const ks=e=>e.byteLength;Object.defineProperty(ks,"name",{value:"size",configurable:!0});class Rs{constructor(e){Q(e,1,"ByteLengthQueuingStrategy"),e=Gs(e,"First parameter"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Cs(this))throw Ws("highWaterMark");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Cs(this))throw Ws("size");return ks}}function Ws(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Cs(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_byteLengthQueuingStrategyHighWaterMark")&&e instanceof Rs}Object.defineProperties(Rs.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Rs.prototype,t.toStringTag,{value:"ByteLengthQueuingStrategy",configurable:!0});const Ps=()=>1;Object.defineProperty(Ps,"name",{value:"size",configurable:!0});class Is{constructor(e){Q(e,1,"CountQueuingStrategy"),e=Gs(e,"First parameter"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Ms(this))throw Vs("highWaterMark");return this._countQueuingStrategyHighWaterMark}get size(){if(!Ms(this))throw Vs("size");return Ps}}function Vs(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function Ms(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_countQueuingStrategyHighWaterMark")&&e instanceof Is}function Ys(e,t){N(e,t);const r=null==e?void 0:e.flush,s=null==e?void 0:e.readableType,n=null==e?void 0:e.start,i=null==e?void 0:e.transform,o=null==e?void 0:e.writableType;return{flush:void 0===r?void 0:Ks(r,e,`${t} has member 'flush' that`),readableType:s,start:void 0===n?void 0:Es(n,e,`${t} has member 'start' that`),transform:void 0===i?void 0:Hs(i,e,`${t} has member 'transform' that`),writableType:o}}function Ks(e,t,r){return j(e,r),r=>_(e,t,[r])}function Es(e,t,r){return j(e,r),r=>v(e,t,[r])}function Hs(e,t,r){return j(e,r),(r,s)=>_(e,t,[r,s])}Object.defineProperties(Is.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Is.prototype,t.toStringTag,{value:"CountQueuingStrategy",configurable:!0});class Fs{constructor(e={},t={},r={}){void 0===e&&(e=null);const s=yt(t,"Second parameter"),n=yt(r,"Third parameter"),i=Ys(e,"First parameter");if(void 0!==i.readableType)throw new RangeError("Invalid readableType specified");if(void 0!==i.writableType)throw new RangeError("Invalid writableType specified");const o=mt(n,0),a=bt(n),l=mt(s,1),c=bt(s);let d;zs(this,h((e=>{d=e})),l,c,o,a),Bs(this,i),void 0!==i.start?d(i.start(this._transformStreamController)):d(void 0)}get readable(){if(!Ns(this))throw ln("readable");return this._readable}get writable(){if(!Ns(this))throw ln("writable");return this._writable}}function zs(e,t,r,s,n,i){function o(){return t}function a(t){return rn(e,t)}function l(t){return sn(e,t)}function c(){return nn(e)}function d(){return on(e)}function h(t){return Us(e,t),u(void 0)}e._writable=Rt(o,a,c,l,r,s),e._readable=ws(o,d,h,n,i),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Os(e,!0),e._transformStreamController=void 0}function Ns(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_transformStreamController")&&e instanceof Fs}function js(e,t){Ar(e._readable._readableStreamController,t),Us(e,t)}function Us(e,t){As(e._transformStreamController),yr(e._writable._writableStreamController,t),e._backpressure&&Os(e,!1)}function Os(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=h((t=>{e._backpressureChangePromise_resolve=t})),e._backpressure=t}Object.defineProperties(Fs.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Fs.prototype,t.toStringTag,{value:"TransformStream",configurable:!0});class Qs{constructor(){throw new TypeError("Illegal constructor")}get desiredSize(){if(!Js(this))throw an("desiredSize");return $r(this._controlledTransformStream._readable._readableStreamController)}enqueue(e){if(!Js(this))throw an("enqueue");$s(this,e)}error(e){if(!Js(this))throw an("error");qs(this,e)}terminate(){if(!Js(this))throw an("terminate");tn(this)}}function Js(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,"_controlledTransformStream")&&e instanceof Qs}function Ds(e,t,r,s){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=r,t._flushAlgorithm=s}function Bs(e,t){const r=Object.create(Qs.prototype);let s=e=>{try{return $s(r,e),u(void 0)}catch(e){return f(e)}},n=()=>u(void 0);void 0!==t.transform&&(s=e=>t.transform(e,r)),void 0!==t.flush&&(n=()=>t.flush(r)),Ds(e,r,s,n)}function As(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function $s(e,t){const r=e._controlledTransformStream,s=r._readable._readableStreamController;if(!es(s))throw new TypeError("Readable side is not in a state that permits enqueue");try{Br(s,t)}catch(e){throw Us(r,e),r._readable._storedError}qr(s)!==r._backpressure&&Os(r,!0)}function qs(e,t){js(e._controlledTransformStream,t)}function en(e,t){return g(e._transformAlgorithm(t),void 0,(t=>{throw js(e._controlledTransformStream,t),t}))}function tn(e){const t=e._controlledTransformStream;Dr(t._readable._readableStreamController),Us(t,new TypeError("TransformStream terminated"))}function rn(e,t){const r=e._transformStreamController;return e._backpressure?g(e._backpressureChangePromise,(()=>{const s=e._writable;if("erroring"===s._state)throw s._storedError;return en(r,t)})):en(r,t)}function sn(e,t){return js(e,t),u(void 0)}function nn(e){const t=e._readable,r=e._transformStreamController,s=r._flushAlgorithm();return As(r),g(s,(()=>{if("errored"===t._state)throw t._storedError;Dr(t._readableStreamController)}),(r=>{throw js(e,r),t._storedError}))}function on(e){return Os(e,!1),e._backpressureChangePromise}function an(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function ln(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}Object.defineProperties(Qs.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),"symbol"==typeof t.toStringTag&&Object.defineProperty(Qs.prototype,t.toStringTag,{value:"TransformStreamDefaultController",configurable:!0}),e.ByteLengthQueuingStrategy=Rs,e.CountQueuingStrategy=Is,e.ReadableByteStreamController=Ge,e.ReadableStream=gs,e.ReadableStreamBYOBReader=ht,e.ReadableStreamBYOBRequest=Te,e.ReadableStreamDefaultController=jr,e.ReadableStreamDefaultReader=ie,e.TransformStream=Fs,e.TransformStreamDefaultController=Qs,e.WritableStream=Gt,e.WritableStreamDefaultController=ar,e.WritableStreamDefaultWriter=Bt,Object.defineProperty(e,"__esModule",{value:!0})}(Dc.exports);if(!globalThis.ReadableStream)try{const e=require("node:process"),{emitWarning:t}=e;try{e.emitWarning=()=>{},Object.assign(globalThis,require("node:stream/web")),e.emitWarning=t}catch(Tl){throw e.emitWarning=t,Tl}}catch(Tl){Object.assign(globalThis,Dc.exports)}try{const{Blob:e}=require("buffer");e&&!e.prototype.stream&&(e.prototype.stream=function(e){let t=0;const r=this;return new ReadableStream({type:"bytes",async pull(e){const s=r.slice(t,Math.min(r.size,t+65536)),n=await s.arrayBuffer();t+=n.byteLength,e.enqueue(new Uint8Array(n)),t===r.size&&e.close()}})})}catch(Tl){}async function*Bc(e,t=!0){for(const r of e)if("stream"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(t){let e=r.byteOffset;const t=r.byteOffset+r.byteLength;for(;e!==t;){const s=Math.min(t-e,65536),n=r.buffer.slice(e,e+s);e+=n.byteLength,yield new Uint8Array(n)}}else yield r;else{let e=0,t=r;for(;e!==t.size;){const r=t.slice(e,Math.min(t.size,e+65536)),s=await r.arrayBuffer();e+=s.byteLength,yield new Uint8Array(s)}}}const Ac=class e{#e=[];#t="";#r=0;#s="transparent";constructor(t=[],r={}){if("object"!=typeof t||null===t)throw new TypeError("Failed to construct 'Blob': The provided value cannot be converted to a sequence.");if("function"!=typeof t[Symbol.iterator])throw new TypeError("Failed to construct 'Blob': The object must have a callable @@iterator property.");if("object"!=typeof r&&"function"!=typeof r)throw new TypeError("Failed to construct 'Blob': parameter 2 cannot convert to dictionary.");null===r&&(r={});const s=new TextEncoder;for(const r of t){let t;t=ArrayBuffer.isView(r)?new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):r instanceof ArrayBuffer?new Uint8Array(r.slice(0)):r instanceof e?r:s.encode(`${r}`),this.#r+=ArrayBuffer.isView(t)?t.byteLength:t.size,this.#e.push(t)}this.#s=`${void 0===r.endings?"transparent":r.endings}`;const n=void 0===r.type?"":String(r.type);this.#t=/^[\x20-\x7E]*$/.test(n)?n:""}get size(){return this.#r}get type(){return this.#t}async text(){const e=new TextDecoder;let t="";for await(const r of Bc(this.#e,!1))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){const e=new Uint8Array(this.size);let t=0;for await(const r of Bc(this.#e,!1))e.set(r,t),t+=r.length;return e.buffer}stream(){const e=Bc(this.#e,!0);return new globalThis.ReadableStream({type:"bytes",async pull(t){const r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(t=0,r=this.size,s=""){const{size:n}=this;let i=t<0?Math.max(n+t,0):Math.min(t,n),o=r<0?Math.max(n+r,0):Math.min(r,n);const a=Math.max(o-i,0),l=this.#e,c=[];let d=0;for(const e of l){if(d>=a)break;const t=ArrayBuffer.isView(e)?e.byteLength:e.size;if(i&&t<=i)i-=t,o-=t;else{let r;ArrayBuffer.isView(e)?(r=e.subarray(i,Math.min(t,o)),d+=r.byteLength):(r=e.slice(i,Math.min(t,o)),d+=r.size),o-=t,c.push(r),i=0}}const h=new e([],{type:String(s).toLowerCase()});return h.#r=a,h.#e=c,h}get[Symbol.toStringTag](){return"Blob"}static[Symbol.hasInstance](e){return e&&"object"==typeof e&&"function"==typeof e.constructor&&("function"==typeof e.stream||"function"==typeof e.arrayBuffer)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties(Ac.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});var $c=Ac;const qc=class extends $c{#n=0;#i="";constructor(e,t,r={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),null===r&&(r={});const s=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(s)||(this.#n=s),this.#i=String(t)}get name(){return this.#i}get lastModified(){return this.#n}get[Symbol.toStringTag](){return"File"}static[Symbol.hasInstance](e){return!!e&&e instanceof $c&&/^(File)$/.test(e[Symbol.toStringTag])}};var{toStringTag:ed,iterator:td,hasInstance:rd}=Symbol,sd=Math.random,nd="append,set,get,getAll,delete,keys,values,entries,forEach,constructor".split(","),id=(e,t,r)=>(e+="",/^(Blob|File)$/.test(t&&t[ed])?[(r=void 0!==r?r+"":"File"==t[ed]?t.name:"blob",e),t.name!==r||"blob"==t[ed]?new qc([t],r,t):t]:[e,t+""]),od=(e,t)=>(t?e:e.replace(/\r?\n|\r/g,"\r\n")).replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22"),ad=(e,t,r)=>{if(t.length<r)throw new TypeError(`Failed to execute '${e}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)};const ld=class{#o=[];constructor(...e){if(e.length)throw new TypeError("Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.")}get[ed](){return"FormData"}[td](){return this.entries()}static[rd](e){return e&&"object"==typeof e&&"FormData"===e[ed]&&!nd.some((t=>"function"!=typeof e[t]))}append(...e){ad("append",arguments,2),this.#o.push(id(...e))}delete(e){ad("delete",arguments,1),e+="",this.#o=this.#o.filter((([t])=>t!==e))}get(e){ad("get",arguments,1),e+="";for(var t=this.#o,r=t.length,s=0;s<r;s++)if(t[s][0]===e)return t[s][1];return null}getAll(e,t){return ad("getAll",arguments,1),t=[],e+="",this.#o.forEach((r=>r[0]===e&&t.push(r[1]))),t}has(e){return ad("has",arguments,1),e+="",this.#o.some((t=>t[0]===e))}forEach(e,t){for(var[r,s]of(ad("forEach",arguments,1),this))e.call(t,s,r,this)}set(...e){ad("set",arguments,2);var t=[],r=!0;e=id(...e),this.#o.forEach((s=>{s[0]===e[0]?r&&(r=!t.push(e)):t.push(s)})),r&&t.push(e),this.#o=t}*entries(){yield*this.#o}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}};class cd extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class dd extends cd{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}const hd=Symbol.toStringTag,ud=e=>"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&"function"==typeof e.sort&&"URLSearchParams"===e[hd],fd=e=>e&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&/^(Blob|File)$/.test(e[hd]),pd=p.promisify(R.default.pipeline),md=Symbol("Body internals");class bd{constructor(e,{size:t=0}={}){let r=null;null===e?e=null:ud(e)?e=f.Buffer.from(e.toString()):fd(e)||f.Buffer.isBuffer(e)||(p.types.isAnyArrayBuffer(e)?e=f.Buffer.from(e):ArrayBuffer.isView(e)?e=f.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof R.default||(e instanceof ld?(e=function(e,t=$c){var r=`${sd()}${sd()}`.replace(/\./g,"").slice(-28).padStart(32,"-"),s=[],n=`--${r}\r\nContent-Disposition: form-data; name="`;return e.forEach(((e,t)=>"string"==typeof e?s.push(n+od(t)+`"\r\n\r\n${e.replace(/\r(?!\n)|(?<!\r)\n/g,"\r\n")}\r\n`):s.push(n+od(t)+`"; filename="${od(e.name,1)}"\r\nContent-Type: ${e.type||"application/octet-stream"}\r\n\r\n`,e,"\r\n"))),s.push(`--${r}--`),new t(s,{type:"multipart/form-data; boundary="+r})}(e),r=e.type.split("=")[1]):e=f.Buffer.from(String(e))));let s=e;f.Buffer.isBuffer(e)?s=R.default.Readable.from(e):fd(e)&&(s=R.default.Readable.from(e.stream())),this[md]={body:e,stream:s,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof R.default&&e.on("error",(e=>{const t=e instanceof cd?e:new dd(`Invalid response body while trying to fetch ${this.url}: ${e.message}`,"system",e);this[md].error=t}))}get body(){return this[md].stream}get bodyUsed(){return this[md].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:t,byteLength:r}=await yd(this);return e.slice(t,t+r)}async formData(){const e=this.headers.get("content-type");if(e.startsWith("application/x-www-form-urlencoded")){const e=new ld,t=new URLSearchParams(await this.text());for(const[r,s]of t)e.append(r,s);return e}const{toFormData:t}=await Promise.resolve().then((function(){return uu}));return t(this.body,e)}async blob(){const e=this.headers&&this.headers.get("content-type")||this[md].body&&this[md].body.type||"",t=await this.arrayBuffer();return new $c([t],{type:e})}async json(){const e=await this.text();return JSON.parse(e)}async text(){const e=await yd(this);return(new TextDecoder).decode(e)}buffer(){return yd(this)}}async function yd(e){if(e[md].disturbed)throw new TypeError(`body used already for: ${e.url}`);if(e[md].disturbed=!0,e[md].error)throw e[md].error;const{body:t}=e;if(null===t)return f.Buffer.alloc(0);if(!(t instanceof R.default))return f.Buffer.alloc(0);const r=[];let s=0;try{for await(const n of t){if(e.size>0&&s+n.length>e.size){const r=new dd(`content size at ${e.url} over limit: ${e.size}`,"max-size");throw t.destroy(r),r}s+=n.length,r.push(n)}}catch(t){throw t instanceof cd?t:new dd(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t)}if(!0!==t.readableEnded&&!0!==t._readableState.ended)throw new dd(`Premature close of server response while trying to fetch ${e.url}`);try{return r.every((e=>"string"==typeof e))?f.Buffer.from(r.join("")):f.Buffer.concat(r,s)}catch(t){throw new dd(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t)}}bd.prototype.buffer=p.deprecate(bd.prototype.buffer,"Please use 'response.arrayBuffer()' instead of 'response.buffer()'","node-fetch#buffer"),Object.defineProperties(bd.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:p.deprecate((()=>{}),"data doesn't exist, use json(), text(), arrayBuffer(), or body instead","https://github.com/node-fetch/node-fetch/issues/1000 (response)")}});const gd=(e,t)=>{let r,s,{body:n}=e[md];if(e.bodyUsed)throw new Error("cannot clone body after it is used");return n instanceof R.default&&"function"!=typeof n.getBoundary&&(r=new u.PassThrough({highWaterMark:t}),s=new u.PassThrough({highWaterMark:t}),n.pipe(r),n.pipe(s),e[md].stream=r,n=s),n},wd=p.deprecate((e=>e.getBoundary()),"form-data doesn't follow the spec and requires special treatment. Use alternative package","https://github.com/node-fetch/node-fetch/issues/1167"),Sd=(e,t)=>null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":ud(e)?"application/x-www-form-urlencoded;charset=UTF-8":fd(e)?e.type||null:f.Buffer.isBuffer(e)||p.types.isAnyArrayBuffer(e)||ArrayBuffer.isView(e)?null:e instanceof ld?`multipart/form-data; boundary=${t[md].boundary}`:e&&"function"==typeof e.getBoundary?`multipart/form-data;boundary=${wd(e)}`:e instanceof R.default?null:"text/plain;charset=UTF-8",vd="function"==typeof T.default.validateHeaderName?T.default.validateHeaderName:e=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(e)){const t=new TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),t}},_d="function"==typeof T.default.validateHeaderValue?T.default.validateHeaderValue:(e,t)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(t)){const t=new TypeError(`Invalid character in header content ["${e}"]`);throw Object.defineProperty(t,"code",{value:"ERR_INVALID_CHAR"}),t}};class Zd extends URLSearchParams{constructor(e){let t=[];if(e instanceof Zd){const r=e.raw();for(const[e,s]of Object.entries(r))t.push(...s.map((t=>[e,t])))}else if(null==e);else{if("object"!=typeof e||p.types.isBoxedPrimitive(e))throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");{const r=e[Symbol.iterator];if(null==r)t.push(...Object.entries(e));else{if("function"!=typeof r)throw new TypeError("Header pairs must be iterable");t=[...e].map((e=>{if("object"!=typeof e||p.types.isBoxedPrimitive(e))throw new TypeError("Each header pair must be an iterable object");return[...e]})).map((e=>{if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");return[...e]}))}}}return t=t.length>0?t.map((([e,t])=>(vd(e),_d(e,String(t)),[String(e).toLowerCase(),String(t)]))):void 0,super(t),new Proxy(this,{get(e,t,r){switch(t){case"append":case"set":return(r,s)=>(vd(r),_d(r,String(s)),URLSearchParams.prototype[t].call(e,String(r).toLowerCase(),String(s)));case"delete":case"has":case"getAll":return r=>(vd(r),URLSearchParams.prototype[t].call(e,String(r).toLowerCase()));case"keys":return()=>(e.sort(),new Set(URLSearchParams.prototype.keys.call(e)).keys());default:return Reflect.get(e,t,r)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const t=this.getAll(e);if(0===t.length)return null;let r=t.join(", ");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t){for(const r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce(((e,t)=>(e[t]=this.getAll(t),e)),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce(((e,t)=>{const r=this.getAll(t);return e[t]="host"===t?r[0]:r.length>1?r:r[0],e}),{})}}Object.defineProperties(Zd.prototype,["get","entries","forEach","values"].reduce(((e,t)=>(e[t]={enumerable:!0},e)),{}));const Xd=new Set([301,302,303,307,308]),Ld=e=>Xd.has(e),xd=Symbol("Response internals");class Td extends bd{constructor(e=null,t={}){super(e,t);const r=null!=t.status?t.status:200,s=new Zd(t.headers);if(null!==e&&!s.has("Content-Type")){const t=Sd(e,this);t&&s.append("Content-Type",t)}this[xd]={type:"default",url:t.url,status:r,statusText:t.statusText||"",headers:s,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[xd].type}get url(){return this[xd].url||""}get status(){return this[xd].status}get ok(){return this[xd].status>=200&&this[xd].status<300}get redirected(){return this[xd].counter>0}get statusText(){return this[xd].statusText}get headers(){return this[xd].headers}get highWaterMark(){return this[xd].highWaterMark}clone(){return new Td(gd(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!Ld(t))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new Td(null,{headers:{location:new URL(e).toString()},status:t})}static error(){const e=new Td(null,{status:0,statusText:""});return e[xd].type="error",e}static json(e,t={}){const r=JSON.stringify(e);if(void 0===r)throw new TypeError("data is not JSON serializable");const s=new Zd(t&&t.headers);return s.has("content-type")||s.set("content-type","application/json"),new Td(r,{...t,headers:s})}get[Symbol.toStringTag](){return"Response"}}Object.defineProperties(Td.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});function Gd(e,t=!1){return null==e?"no-referrer":(e=new URL(e),/^(about|blob|data):$/.test(e.protocol)?"no-referrer":(e.username="",e.password="",e.hash="",t&&(e.pathname="",e.search=""),e))}const kd=new Set(["","no-referrer","no-referrer-when-downgrade","same-origin","origin","strict-origin","origin-when-cross-origin","strict-origin-when-cross-origin","unsafe-url"]);function Rd(e){return!!/^about:(blank|srcdoc)$/.test(e)||("data:"===e.protocol||(!!/^(blob|filesystem):$/.test(e.protocol)||function(e){if(/^(http|ws)s:$/.test(e.protocol))return!0;const t=e.host.replace(/(^\[)|(]$)/g,""),r=b.isIP(t);return!(4!==r||!/^127\./.test(t))||!(6!==r||!/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t))||"localhost"!==e.host&&!e.host.endsWith(".localhost")&&"file:"===e.protocol}(e)))}const Wd=Symbol("Request internals"),Cd=e=>"object"==typeof e&&"object"==typeof e[Wd],Pd=p.deprecate((()=>{}),".data is not a valid RequestInit property, use .body instead","https://github.com/node-fetch/node-fetch/issues/1000 (request)");class Id extends bd{constructor(e,t={}){let r;if(Cd(e)?r=new URL(e.url):(r=new URL(e),e={}),""!==r.username||""!==r.password)throw new TypeError(`${r} is an url with embedded credentials.`);let s=t.method||e.method||"GET";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Cd(t)&&"data"in t&&Pd(),(null!=t.body||Cd(e)&&null!==e.body)&&("GET"===s||"HEAD"===s))throw new TypeError("Request with GET/HEAD method cannot have body");const n=t.body?t.body:Cd(e)&&null!==e.body?gd(e):null;super(n,{size:t.size||e.size||0});const i=new Zd(t.headers||e.headers||{});if(null!==n&&!i.has("Content-Type")){const e=Sd(n,this);e&&i.set("Content-Type",e)}let o=Cd(e)?e.signal:null;if("signal"in t&&(o=t.signal),null!=o&&("object"!=typeof(a=o)||"AbortSignal"!==a[hd]&&"EventTarget"!==a[hd]))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");var a;let l=null==t.referrer?e.referrer:t.referrer;if(""===l)l="no-referrer";else if(l){const e=new URL(l);l=/^about:(\/\/)?client$/.test(e)?"client":e}else l=void 0;this[Wd]={method:s,redirect:t.redirect||e.redirect||"follow",headers:i,parsedURL:r,signal:o,referrer:l},this.follow=void 0===t.follow?void 0===e.follow?20:e.follow:t.follow,this.compress=void 0===t.compress?void 0===e.compress||e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||""}get method(){return this[Wd].method}get url(){return m.format(this[Wd].parsedURL)}get headers(){return this[Wd].headers}get redirect(){return this[Wd].redirect}get signal(){return this[Wd].signal}get referrer(){return"no-referrer"===this[Wd].referrer?"":"client"===this[Wd].referrer?"about:client":this[Wd].referrer?this[Wd].referrer.toString():void 0}get referrerPolicy(){return this[Wd].referrerPolicy}set referrerPolicy(e){this[Wd].referrerPolicy=function(e){if(!kd.has(e))throw new TypeError(`Invalid referrerPolicy: ${e}`);return e}(e)}clone(){return new Id(this)}get[Symbol.toStringTag](){return"Request"}}Object.defineProperties(Id.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});const Vd=e=>{const{parsedURL:t}=e[Wd],r=new Zd(e[Wd].headers);r.has("Accept")||r.set("Accept","*/*");let s=null;if(null===e.body&&/^(post|put)$/i.test(e.method)&&(s="0"),null!==e.body){const t=(e=>{const{body:t}=e[md];return null===t?0:fd(t)?t.size:f.Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null})(e);"number"!=typeof t||Number.isNaN(t)||(s=String(t))}s&&r.set("Content-Length",s),""===e.referrerPolicy&&(e.referrerPolicy="strict-origin-when-cross-origin"),e.referrer&&"no-referrer"!==e.referrer?e[Wd].referrer=function(e,{referrerURLCallback:t,referrerOriginCallback:r}={}){if("no-referrer"===e.referrer||""===e.referrerPolicy)return null;const s=e.referrerPolicy;if("about:client"===e.referrer)return"no-referrer";const n=e.referrer;let i=Gd(n),o=Gd(n,!0);i.toString().length>4096&&(i=o),t&&(i=t(i)),r&&(o=r(o));const a=new URL(e.url);switch(s){case"no-referrer":return"no-referrer";case"origin":return o;case"unsafe-url":return i;case"strict-origin":return Rd(i)&&!Rd(a)?"no-referrer":o.toString();case"strict-origin-when-cross-origin":return i.origin===a.origin?i:Rd(i)&&!Rd(a)?"no-referrer":o;case"same-origin":return i.origin===a.origin?i:"no-referrer";case"origin-when-cross-origin":return i.origin===a.origin?i:o;case"no-referrer-when-downgrade":return Rd(i)&&!Rd(a)?"no-referrer":i;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}(e):e[Wd].referrer="no-referrer",e[Wd].referrer instanceof URL&&r.set("Referer",e.referrer),r.has("User-Agent")||r.set("User-Agent","node-fetch"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip, deflate, br");let{agent:n}=e;"function"==typeof n&&(n=n(t)),r.has("Connection")||n||r.set("Connection","close");const i=(e=>{if(e.search)return e.search;const t=e.href.length-1,r=e.hash||("#"===e.href[t]?"#":"");return"?"===e.href[t-r.length]?"?":""})(t);return{parsedURL:t,options:{path:t.pathname+i,method:e.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:e.insecureHTTPParser,agent:n}}};class Md extends cd{constructor(e,t="aborted"){super(e,t)}}if(!globalThis.DOMException)try{const{MessageChannel:e}=require("worker_threads"),t=(new e).port1,r=new ArrayBuffer;t.postMessage(r,[r,r])}catch(Ai){"DOMException"===Ai.constructor.name&&(globalThis.DOMException=Ai.constructor)}const Yd=new Set(["data:","http:","https:"]);async function Kd(e,t){return new Promise(((r,s)=>{const n=new Id(e,t),{parsedURL:i,options:o}=Vd(n);if(!Yd.has(i.protocol))throw new TypeError(`node-fetch cannot load ${e}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if("data:"===i.protocol){const e=function(e){if(!/^data:/i.test(e))throw new TypeError('`uri` does not appear to be a Data URI (must begin with "data:")');const t=(e=e.replace(/\r?\n/g,"")).indexOf(",");if(-1===t||t<=4)throw new TypeError("malformed data: URI");const r=e.substring(5,t).split(";");let s="",n=!1;const i=r[0]||"text/plain";let o=i;for(let e=1;e<r.length;e++)"base64"===r[e]?n=!0:(o+=`;${r[e]}`,0===r[e].indexOf("charset=")&&(s=r[e].substring(8)));r[0]||s.length||(o+=";charset=US-ASCII",s="US-ASCII");const a=n?"base64":"ascii",l=unescape(e.substring(t+1)),c=Buffer.from(l,a);return c.type=i,c.typeFull=o,c.charset=s,c}(n.url),t=new Td(e,{headers:{"Content-Type":e.typeFull}});return void r(t)}const a=("https:"===i.protocol?G.default:T.default).request,{signal:l}=n;let c=null;const d=()=>{const e=new Md("The operation was aborted.");s(e),n.body&&n.body instanceof R.default.Readable&&n.body.destroy(e),c&&c.body&&c.body.emit("error",e)};if(l&&l.aborted)return void d();const h=()=>{d(),m()},p=a(i.toString(),o);l&&l.addEventListener("abort",h);const m=()=>{p.abort(),l&&l.removeEventListener("abort",h)};p.on("error",(e=>{s(new dd(`request to ${n.url} failed, reason: ${e.message}`,"system",e)),m()})),function(e,t){const r=f.Buffer.from("0\r\n\r\n");let s,n=!1,i=!1;e.on("response",(e=>{const{headers:t}=e;n="chunked"===t["transfer-encoding"]&&!t["content-length"]})),e.on("socket",(o=>{const a=()=>{if(n&&!i){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",t(e)}},l=e=>{i=0===f.Buffer.compare(e.slice(-5),r),!i&&s&&(i=0===f.Buffer.compare(s.slice(-3),r.slice(0,3))&&0===f.Buffer.compare(e.slice(-2),r.slice(3))),s=e};o.prependListener("close",a),o.on("data",l),e.on("close",(()=>{o.removeListener("close",a),o.removeListener("data",l)}))}))}(p,(e=>{c&&c.body&&c.body.destroy(e)})),process.version<"v14"&&p.on("socket",(e=>{let t;e.prependListener("end",(()=>{t=e._eventsCount})),e.prependListener("close",(r=>{if(c&&t<e._eventsCount&&!r){const e=new Error("Premature close");e.code="ERR_STREAM_PREMATURE_CLOSE",c.body.emit("error",e)}}))})),p.on("response",(e=>{p.setTimeout(0);const i=function(e=[]){return new Zd(e.reduce(((e,t,r,s)=>(r%2==0&&e.push(s.slice(r,r+2)),e)),[]).filter((([e,t])=>{try{return vd(e),_d(e,String(t)),!0}catch{return!1}})))}(e.rawHeaders);if(Ld(e.statusCode)){const a=i.get("Location");let l=null;try{l=null===a?null:new URL(a,n.url)}catch{if("manual"!==n.redirect)return s(new dd(`uri requested responds with an invalid redirect URL: ${a}`,"invalid-redirect")),void m()}switch(n.redirect){case"error":return s(new dd(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,"no-redirect")),void m();case"manual":break;case"follow":{if(null===l)break;if(n.counter>=n.follow)return s(new dd(`maximum redirect reached at: ${n.url}`,"max-redirect")),void m();const a={headers:new Zd(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:gd(n),signal:n.signal,size:n.size,referrer:n.referrer,referrerPolicy:n.referrerPolicy};if(!((e,t)=>{const r=new URL(t).hostname,s=new URL(e).hostname;return r===s||r.endsWith(`.${s}`)})(n.url,l)||(o=n.url,new URL(l).protocol!==new URL(o).protocol))for(const e of["authorization","www-authenticate","cookie","cookie2"])a.headers.delete(e);if(303!==e.statusCode&&n.body&&t.body instanceof R.default.Readable)return s(new dd("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void m();303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==n.method)||(a.method="GET",a.body=void 0,a.headers.delete("content-length"));const c=function(e){const t=(e.get("referrer-policy")||"").split(/[,\s]+/);let r="";for(const e of t)e&&kd.has(e)&&(r=e);return r}(i);return c&&(a.referrerPolicy=c),r(Kd(new Id(l,a))),void m()}default:return s(new TypeError(`Redirect option '${n.redirect}' is not a valid value of RequestRedirect`))}}var o;l&&e.once("end",(()=>{l.removeEventListener("abort",h)}));let a=u.pipeline(e,new u.PassThrough,(e=>{e&&s(e)}));process.version<"v12.10"&&e.on("aborted",h);const d={url:n.url,status:e.statusCode,statusText:e.statusMessage,headers:i,size:n.size,counter:n.counter,highWaterMark:n.highWaterMark},f=i.get("Content-Encoding");if(!n.compress||"HEAD"===n.method||null===f||204===e.statusCode||304===e.statusCode)return c=new Td(a,d),void r(c);const b={flush:k.default.Z_SYNC_FLUSH,finishFlush:k.default.Z_SYNC_FLUSH};if("gzip"===f||"x-gzip"===f)return a=u.pipeline(a,k.default.createGunzip(b),(e=>{e&&s(e)})),c=new Td(a,d),void r(c);if("deflate"===f||"x-deflate"===f){const t=u.pipeline(e,new u.PassThrough,(e=>{e&&s(e)}));return t.once("data",(e=>{a=8==(15&e[0])?u.pipeline(a,k.default.createInflate(),(e=>{e&&s(e)})):u.pipeline(a,k.default.createInflateRaw(),(e=>{e&&s(e)})),c=new Td(a,d),r(c)})),void t.once("end",(()=>{c||(c=new Td(a,d),r(c))}))}if("br"===f)return a=u.pipeline(a,k.default.createBrotliDecompress(),(e=>{e&&s(e)})),c=new Td(a,d),void r(c);c=new Td(a,d),r(c)})),(async(e,{body:t})=>{null===t?e.end():await pd(t,e)})(p,n).catch(s)}))}var Ed=null;try{var Hd="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");Ed=Hd.Worker}catch(od){}var Fd,zd,Nd,jd,Ud,Od,Qd=(Nd=void 0===(Fd=null)?null:Fd,jd=function(e,t){return Buffer.from(e,"base64").toString(t?"utf16":"utf8")}("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgQ29ycG9yYXRpb24gMjAyMgogKiBCdW5kbGUgb2YgQGNyb3F1ZXQvY3JvcXVldAogKiBEYXRlOiAyMDIyLTEyLTE5CiAqIFZlcnNpb246IDEuMS4wLTE1CiAqLwoKIWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciB0PSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307IWZ1bmN0aW9uKHQpe3ZhciBlPWZ1bmN0aW9uKHQpe3ZhciBlLHI9T2JqZWN0LnByb3RvdHlwZSxuPXIuaGFzT3duUHJvcGVydHksaT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxhPWkuaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixzPWkuYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIsbz1pLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gaCh0LGUscil7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KSx0W2VdfXRyeXtoKHt9LCIiKX1jYXRjaCh0KXtoPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdFtlXT1yfX1mdW5jdGlvbiBsKHQsZSxyLG4pe3ZhciBpPWUmJmUucHJvdG90eXBlIGluc3RhbmNlb2YgZz9lOmcsYT1PYmplY3QuY3JlYXRlKGkucHJvdG90eXBlKSxzPW5ldyBCKG58fFtdKTtyZXR1cm4gYS5faW52b2tlPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj11O3JldHVybiBmdW5jdGlvbihpLGEpe2lmKG49PT1fKXRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmKG49PT1mKXtpZigidGhyb3ciPT09aSl0aHJvdyBhO3JldHVybiBEKCl9Zm9yKHIubWV0aG9kPWksci5hcmc9YTs7KXt2YXIgcz1yLmRlbGVnYXRlO2lmKHMpe3ZhciBvPUEocyxyKTtpZihvKXtpZihvPT09cCljb250aW51ZTtyZXR1cm4gb319aWYoIm5leHQiPT09ci5tZXRob2Qpci5zZW50PXIuX3NlbnQ9ci5hcmc7ZWxzZSBpZigidGhyb3ciPT09ci5tZXRob2Qpe2lmKG49PT11KXRocm93IG49ZixyLmFyZztyLmRpc3BhdGNoRXhjZXB0aW9uKHIuYXJnKX1lbHNlInJldHVybiI9PT1yLm1ldGhvZCYmci5hYnJ1cHQoInJldHVybiIsci5hcmcpO249Xzt2YXIgaD1jKHQsZSxyKTtpZigibm9ybWFsIj09PWgudHlwZSl7aWYobj1yLmRvbmU/ZjpkLGguYXJnPT09cCljb250aW51ZTtyZXR1cm57dmFsdWU6aC5hcmcsZG9uZTpyLmRvbmV9fSJ0aHJvdyI9PT1oLnR5cGUmJihuPWYsci5tZXRob2Q9InRocm93IixyLmFyZz1oLmFyZyl9fX0odCxyLHMpLGF9ZnVuY3Rpb24gYyh0LGUscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzp0LmNhbGwoZSxyKX19Y2F0Y2godCl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6dH19fXQud3JhcD1sO3ZhciB1PSJzdXNwZW5kZWRTdGFydCIsZD0ic3VzcGVuZGVkWWllbGQiLF89ImV4ZWN1dGluZyIsZj0iY29tcGxldGVkIixwPXt9O2Z1bmN0aW9uIGcoKXt9ZnVuY3Rpb24geSgpe31mdW5jdGlvbiB2KCl7fXZhciB3PXt9O2godyxhLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBtPU9iamVjdC5nZXRQcm90b3R5cGVPZixiPW0mJm0obShSKFtdKSkpO2ImJmIhPT1yJiZuLmNhbGwoYixhKSYmKHc9Yik7dmFyIHg9di5wcm90b3R5cGU9Zy5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh3KTtmdW5jdGlvbiBrKHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aCh0LGUsKGZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9pbnZva2UoZSx0KX0pKX0pKX1mdW5jdGlvbiB6KHQsZSl7ZnVuY3Rpb24gcihpLGEscyxvKXt2YXIgaD1jKHRbaV0sdCxhKTtpZigidGhyb3ciIT09aC50eXBlKXt2YXIgbD1oLmFyZyx1PWwudmFsdWU7cmV0dXJuIHUmJiJvYmplY3QiPT10eXBlb2YgdSYmbi5jYWxsKHUsIl9fYXdhaXQiKT9lLnJlc29sdmUodS5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtyKCJuZXh0Iix0LHMsbyl9KSwoZnVuY3Rpb24odCl7cigidGhyb3ciLHQscyxvKX0pKTplLnJlc29sdmUodSkudGhlbigoZnVuY3Rpb24odCl7bC52YWx1ZT10LHMobCl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIHIoInRocm93Iix0LHMsbyl9KSl9byhoLmFyZyl9dmFyIGk7dGhpcy5faW52b2tlPWZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gYSgpe3JldHVybiBuZXcgZSgoZnVuY3Rpb24oZSxpKXtyKHQsbixlLGkpfSkpfXJldHVybiBpPWk/aS50aGVuKGEsYSk6YSgpfX1mdW5jdGlvbiBBKHQscil7dmFyIG49dC5pdGVyYXRvcltyLm1ldGhvZF07aWYobj09PWUpe2lmKHIuZGVsZWdhdGU9bnVsbCwidGhyb3ciPT09ci5tZXRob2Qpe2lmKHQuaXRlcmF0b3IucmV0dXJuJiYoci5tZXRob2Q9InJldHVybiIsci5hcmc9ZSxBKHQsciksInRocm93Ij09PXIubWV0aG9kKSlyZXR1cm4gcDtyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2QiKX1yZXR1cm4gcH12YXIgaT1jKG4sdC5pdGVyYXRvcixyLmFyZyk7aWYoInRocm93Ij09PWkudHlwZSlyZXR1cm4gci5tZXRob2Q9InRocm93IixyLmFyZz1pLmFyZyxyLmRlbGVnYXRlPW51bGwscDt2YXIgYT1pLmFyZztyZXR1cm4gYT9hLmRvbmU/KHJbdC5yZXN1bHROYW1lXT1hLnZhbHVlLHIubmV4dD10Lm5leHRMb2MsInJldHVybiIhPT1yLm1ldGhvZCYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSxyLmRlbGVnYXRlPW51bGwscCk6YTooci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLHIuZGVsZWdhdGU9bnVsbCxwKX1mdW5jdGlvbiBFKHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIFModCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIEIodCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaChFLHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIFIodCl7aWYodCl7dmFyIHI9dFthXTtpZihyKXJldHVybiByLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgaT0tMSxzPWZ1bmN0aW9uIHIoKXtmb3IoOysraTx0Lmxlbmd0aDspaWYobi5jYWxsKHQsaSkpcmV0dXJuIHIudmFsdWU9dFtpXSxyLmRvbmU9ITEscjtyZXR1cm4gci52YWx1ZT1lLHIuZG9uZT0hMCxyfTtyZXR1cm4gcy5uZXh0PXN9fXJldHVybntuZXh0OkR9fWZ1bmN0aW9uIEQoKXtyZXR1cm57dmFsdWU6ZSxkb25lOiEwfX1yZXR1cm4geS5wcm90b3R5cGU9dixoKHgsImNvbnN0cnVjdG9yIix2KSxoKHYsImNvbnN0cnVjdG9yIix5KSx5LmRpc3BsYXlOYW1lPWgodixvLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgdCYmdC5jb25zdHJ1Y3RvcjtyZXR1cm4hIWUmJihlPT09eXx8IkdlbmVyYXRvckZ1bmN0aW9uIj09PShlLmRpc3BsYXlOYW1lfHxlLm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsdik6KHQuX19wcm90b19fPXYsaCh0LG8sIkdlbmVyYXRvckZ1bmN0aW9uIikpLHQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoeCksdH0sdC5hd3JhcD1mdW5jdGlvbih0KXtyZXR1cm57X19hd2FpdDp0fX0sayh6LnByb3RvdHlwZSksaCh6LnByb3RvdHlwZSxzLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj16LHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4saSxhKXt2b2lkIDA9PT1hJiYoYT1Qcm9taXNlKTt2YXIgcz1uZXcgeihsKGUscixuLGkpLGEpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/czpzLm5leHQoKS50aGVuKChmdW5jdGlvbih0KXtyZXR1cm4gdC5kb25lP3QudmFsdWU6cy5uZXh0KCl9KSl9LGsoeCksaCh4LG8sIkdlbmVyYXRvciIpLGgoeCxhLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGgoeCwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbih0KXt2YXIgZT1bXTtmb3IodmFyIHIgaW4gdCllLnB1c2gocik7cmV0dXJuIGUucmV2ZXJzZSgpLGZ1bmN0aW9uIHIoKXtmb3IoO2UubGVuZ3RoOyl7dmFyIG49ZS5wb3AoKTtpZihuIGluIHQpcmV0dXJuIHIudmFsdWU9bixyLmRvbmU9ITEscn1yZXR1cm4gci5kb25lPSEwLHJ9fSx0LnZhbHVlcz1SLEIucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpCLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChTKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmbi5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciB0PXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBpKG4saSl7cmV0dXJuIG8udHlwZT0idGhyb3ciLG8uYXJnPXQsci5uZXh0PW4saSYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIWl9Zm9yKHZhciBhPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTthPj0wOy0tYSl7dmFyIHM9dGhpcy50cnlFbnRyaWVzW2FdLG89cy5jb21wbGV0aW9uO2lmKCJyb290Ij09PXMudHJ5TG9jKXJldHVybiBpKCJlbmQiKTtpZihzLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgaD1uLmNhbGwocywiY2F0Y2hMb2MiKSxsPW4uY2FsbChzLCJmaW5hbGx5TG9jIik7aWYoaCYmbCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfWVsc2UgaWYoaCl7aWYodGhpcy5wcmV2PHMuY2F0Y2hMb2MpcmV0dXJuIGkocy5jYXRjaExvYywhMCl9ZWxzZXtpZighbCl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PHMuZmluYWxseUxvYylyZXR1cm4gaShzLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgaT10aGlzLnRyeUVudHJpZXNbcl07aWYoaS50cnlMb2M8PXRoaXMucHJldiYmbi5jYWxsKGksImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PGkuZmluYWxseUxvYyl7dmFyIGE9aTticmVha319YSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmEudHJ5TG9jPD1lJiZlPD1hLmZpbmFsbHlMb2MmJihhPW51bGwpO3ZhciBzPWE/YS5jb21wbGV0aW9uOnt9O3JldHVybiBzLnR5cGU9dCxzLmFyZz1lLGE/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9YS5maW5hbGx5TG9jLHApOnRoaXMuY29tcGxldGUocyl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSkscH0sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxTKHIpLHB9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIGk9bi5hcmc7UyhyKX1yZXR1cm4gaX19dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOlIodCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxwfX0sdH0odC5leHBvcnRzKTt0cnl7Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZTpGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShlKX19KHtleHBvcnRzOnt9fSk7dmFyIGU9e2V4cG9ydHM6e319OyhmdW5jdGlvbih0KXtjb25zdCBlPTQscj0wLG49MSxpPTI7ZnVuY3Rpb24gYSh0KXtsZXQgZT10Lmxlbmd0aDtmb3IoOy0tZT49MDspdFtlXT0wfWNvbnN0IHM9MCxvPTEsaD0yLGw9MyxjPTI1OCx1PTI5LGQ9MjU2LF89ZCsxK3UsZj0zMCxwPTE5LGc9MipfKzEseT0xNSx2PTE2LHc9NyxtPTI1NixiPTE2LHg9MTcsaz0xOCx6PW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKSxBPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzXSksRT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pLFM9bmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxCPTUxMixSPW5ldyBBcnJheSgyKihfKzIpKTthKFIpO2NvbnN0IEQ9bmV3IEFycmF5KDIqZik7YShEKTtjb25zdCBMPW5ldyBBcnJheShCKTthKEwpO2NvbnN0IFU9bmV3IEFycmF5KGMtbCsxKTthKFUpO2NvbnN0IEM9bmV3IEFycmF5KHUpO2EoQyk7Y29uc3QgTz1uZXcgQXJyYXkoZik7ZnVuY3Rpb24gVCh0LGUscixuLGkpe3RoaXMuc3RhdGljX3RyZWU9dCx0aGlzLmV4dHJhX2JpdHM9ZSx0aGlzLmV4dHJhX2Jhc2U9cix0aGlzLmVsZW1zPW4sdGhpcy5tYXhfbGVuZ3RoPWksdGhpcy5oYXNfc3RyZWU9dCYmdC5sZW5ndGh9bGV0IEYsSCxaO2Z1bmN0aW9uIE0odCxlKXt0aGlzLmR5bl90cmVlPXQsdGhpcy5tYXhfY29kZT0wLHRoaXMuc3RhdF9kZXNjPWV9YShPKTtjb25zdCBOPXQ9PnQ8MjU2P0xbdF06TFsyNTYrKHQ+Pj43KV0sST0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPTI1NSZlLHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NX0sUD0odCxlLHIpPT57dC5iaV92YWxpZD52LXI/KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LEkodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+di10LmJpX3ZhbGlkLHQuYmlfdmFsaWQrPXItdik6KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LHQuYmlfdmFsaWQrPXIpfSwkPSh0LGUscik9PntQKHQsclsyKmVdLHJbMiplKzFdKX0saj0odCxlKT0+e2xldCByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfSxLPXQ9PnsxNj09PXQuYmlfdmFsaWQ/KEkodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSxYPSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5tYXhfY29kZSxpPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGE9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLHM9ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxvPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsaD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoO2xldCBsLGMsdSxkLF8sZixwPTA7Zm9yKGQ9MDtkPD15O2QrKyl0LmJsX2NvdW50W2RdPTA7Zm9yKHJbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxsPXQuaGVhcF9tYXgrMTtsPGc7bCsrKWM9dC5oZWFwW2xdLGQ9clsyKnJbMipjKzFdKzFdKzEsZD5oJiYoZD1oLHArKyksclsyKmMrMV09ZCxjPm58fCh0LmJsX2NvdW50W2RdKyssXz0wLGM+PW8mJihfPXNbYy1vXSksZj1yWzIqY10sdC5vcHRfbGVuKz1mKihkK18pLGEmJih0LnN0YXRpY19sZW4rPWYqKGlbMipjKzFdK18pKSk7aWYoMCE9PXApe2Rve2ZvcihkPWgtMTswPT09dC5ibF9jb3VudFtkXTspZC0tO3QuYmxfY291bnRbZF0tLSx0LmJsX2NvdW50W2QrMV0rPTIsdC5ibF9jb3VudFtoXS0tLHAtPTJ9d2hpbGUocD4wKTtmb3IoZD1oOzAhPT1kO2QtLSlmb3IoYz10LmJsX2NvdW50W2RdOzAhPT1jOyl1PXQuaGVhcFstLWxdLHU+bnx8KHJbMip1KzFdIT09ZCYmKHQub3B0X2xlbis9KGQtclsyKnUrMV0pKnJbMip1XSxyWzIqdSsxXT1kKSxjLS0pfX0scT0odCxlLHIpPT57Y29uc3Qgbj1uZXcgQXJyYXkoeSsxKTtsZXQgaSxhLHM9MDtmb3IoaT0xO2k8PXk7aSsrKW5baV09cz1zK3JbaS0xXTw8MTtmb3IoYT0wO2E8PWU7YSsrKXtsZXQgZT10WzIqYSsxXTswIT09ZSYmKHRbMiphXT1qKG5bZV0rKyxlKSl9fSxHPSgpPT57bGV0IHQsZSxyLG4saTtjb25zdCBhPW5ldyBBcnJheSh5KzEpO2ZvcihyPTAsbj0wO248dS0xO24rKylmb3IoQ1tuXT1yLHQ9MDt0PDE8PHpbbl07dCsrKVVbcisrXT1uO2ZvcihVW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihPW25dPWksdD0wO3Q8MTw8QVtuXTt0KyspTFtpKytdPW47Zm9yKGk+Pj03O248ZjtuKyspZm9yKE9bbl09aTw8Nyx0PTA7dDwxPDxBW25dLTc7dCsrKUxbMjU2K2krK109bjtmb3IoZT0wO2U8PXk7ZSsrKWFbZV09MDtmb3IodD0wO3Q8PTE0MzspUlsyKnQrMV09OCx0KyssYVs4XSsrO2Zvcig7dDw9MjU1OylSWzIqdCsxXT05LHQrKyxhWzldKys7Zm9yKDt0PD0yNzk7KVJbMip0KzFdPTcsdCsrLGFbN10rKztmb3IoO3Q8PTI4NzspUlsyKnQrMV09OCx0KyssYVs4XSsrO2ZvcihxKFIsXysxLGEpLHQ9MDt0PGY7dCsrKURbMip0KzFdPTUsRFsyKnRdPWoodCw1KTtGPW5ldyBUKFIseixkKzEsXyx5KSxIPW5ldyBUKEQsQSwwLGYseSksWj1uZXcgVChuZXcgQXJyYXkoMCksRSwwLHAsdyl9LFc9dD0+e2xldCBlO2ZvcihlPTA7ZTxfO2UrKyl0LmR5bl9sdHJlZVsyKmVdPTA7Zm9yKGU9MDtlPGY7ZSsrKXQuZHluX2R0cmVlWzIqZV09MDtmb3IoZT0wO2U8cDtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVsyKm1dPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQubGFzdF9saXQ9dC5tYXRjaGVzPTB9LFk9dD0+e3QuYmlfdmFsaWQ+OD9JKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH0sVj0odCxlLHIsbik9PntZKHQpLG4mJihJKHQsciksSSh0LH5yKSksdC5wZW5kaW5nX2J1Zi5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK3IpLHQucGVuZGluZyksdC5wZW5kaW5nKz1yfSxKPSh0LGUscixuKT0+e2NvbnN0IGk9MiplLGE9MipyO3JldHVybiB0W2ldPHRbYV18fHRbaV09PT10W2FdJiZuW2VdPD1uW3JdfSxRPSh0LGUscik9Pntjb25zdCBuPXQuaGVhcFtyXTtsZXQgaT1yPDwxO2Zvcig7aTw9dC5oZWFwX2xlbiYmKGk8dC5oZWFwX2xlbiYmSihlLHQuaGVhcFtpKzFdLHQuaGVhcFtpXSx0LmRlcHRoKSYmaSsrLCFKKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn0sdHQ9KHQsZSxyKT0+e2xldCBuLGksYSxzLG89MDtpZigwIT09dC5sYXN0X2xpdClkb3tuPXQucGVuZGluZ19idWZbdC5kX2J1ZisyKm9dPDw4fHQucGVuZGluZ19idWZbdC5kX2J1ZisyKm8rMV0saT10LnBlbmRpbmdfYnVmW3QubF9idWYrb10sbysrLDA9PT1uPyQodCxpLGUpOihhPVVbaV0sJCh0LGErZCsxLGUpLHM9elthXSwwIT09cyYmKGktPUNbYV0sUCh0LGkscykpLG4tLSxhPU4obiksJCh0LGEscikscz1BW2FdLDAhPT1zJiYobi09T1thXSxQKHQsbixzKSkpfXdoaWxlKG88dC5sYXN0X2xpdCk7JCh0LG0sZSl9LGV0PSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsaT1lLnN0YXRfZGVzYy5oYXNfc3RyZWUsYT1lLnN0YXRfZGVzYy5lbGVtcztsZXQgcyxvLGgsbD0tMTtmb3IodC5oZWFwX2xlbj0wLHQuaGVhcF9tYXg9ZyxzPTA7czxhO3MrKykwIT09clsyKnNdPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT1sPXMsdC5kZXB0aFtzXT0wKTpyWzIqcysxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOyloPXQuaGVhcFsrK3QuaGVhcF9sZW5dPWw8Mj8rK2w6MCxyWzIqaF09MSx0LmRlcHRoW2hdPTAsdC5vcHRfbGVuLS0saSYmKHQuc3RhdGljX2xlbi09blsyKmgrMV0pO2ZvcihlLm1heF9jb2RlPWwscz10LmhlYXBfbGVuPj4xO3M+PTE7cy0tKVEodCxyLHMpO2g9YTtkb3tzPXQuaGVhcFsxXSx0LmhlYXBbMV09dC5oZWFwW3QuaGVhcF9sZW4tLV0sUSh0LHIsMSksbz10LmhlYXBbMV0sdC5oZWFwWy0tdC5oZWFwX21heF09cyx0LmhlYXBbLS10LmhlYXBfbWF4XT1vLHJbMipoXT1yWzIqc10rclsyKm9dLHQuZGVwdGhbaF09KHQuZGVwdGhbc10+PXQuZGVwdGhbb10/dC5kZXB0aFtzXTp0LmRlcHRoW29dKSsxLHJbMipzKzFdPXJbMipvKzFdPWgsdC5oZWFwWzFdPWgrKyxRKHQsciwxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sWCh0LGUpLHEocixsLHQuYmxfY291bnQpfSxydD0odCxlLHIpPT57bGV0IG4saSxhPS0xLHM9ZVsxXSxvPTAsaD03LGw9NDtmb3IoMD09PXMmJihoPTEzOCxsPTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1zLHM9ZVsyKihuKzEpKzFdLCsrbzxoJiZpPT09c3x8KG88bD90LmJsX3RyZWVbMippXSs9bzowIT09aT8oaSE9PWEmJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzIqYl0rKyk6bzw9MTA/dC5ibF90cmVlWzIqeF0rKzp0LmJsX3RyZWVbMiprXSsrLG89MCxhPWksMD09PXM/KGg9MTM4LGw9Myk6aT09PXM/KGg9NixsPTMpOihoPTcsbD00KSl9LG50PSh0LGUscik9PntsZXQgbixpLGE9LTEscz1lWzFdLG89MCxoPTcsbD00O2ZvcigwPT09cyYmKGg9MTM4LGw9Myksbj0wO248PXI7bisrKWlmKGk9cyxzPWVbMioobisxKSsxXSwhKCsrbzxoJiZpPT09cykpe2lmKG88bClkb3skKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tbyk7ZWxzZSAwIT09aT8oaSE9PWEmJigkKHQsaSx0LmJsX3RyZWUpLG8tLSksJCh0LGIsdC5ibF90cmVlKSxQKHQsby0zLDIpKTpvPD0xMD8oJCh0LHgsdC5ibF90cmVlKSxQKHQsby0zLDMpKTooJCh0LGssdC5ibF90cmVlKSxQKHQsby0xMSw3KSk7bz0wLGE9aSwwPT09cz8oaD0xMzgsbD0zKTppPT09cz8oaD02LGw9Myk6KGg9NyxsPTQpfX0saXQ9dD0+e2xldCBlO2ZvcihydCh0LHQuZHluX2x0cmVlLHQubF9kZXNjLm1heF9jb2RlKSxydCh0LHQuZHluX2R0cmVlLHQuZF9kZXNjLm1heF9jb2RlKSxldCh0LHQuYmxfZGVzYyksZT1wLTE7ZT49MyYmMD09PXQuYmxfdHJlZVsyKlNbZV0rMV07ZS0tKTtyZXR1cm4gdC5vcHRfbGVuKz0zKihlKzEpKzUrNSs0LGV9LGF0PSh0LGUscixuKT0+e2xldCBpO2ZvcihQKHQsZS0yNTcsNSksUCh0LHItMSw1KSxQKHQsbi00LDQpLGk9MDtpPG47aSsrKVAodCx0LmJsX3RyZWVbMipTW2ldKzFdLDMpO250KHQsdC5keW5fbHRyZWUsZS0xKSxudCh0LHQuZHluX2R0cmVlLHItMSl9LHN0PXQ9PntsZXQgZSxpPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKyssaT4+Pj0xKWlmKDEmaSYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIHI7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gbjtmb3IoZT0zMjtlPGQ7ZSsrKWlmKDAhPT10LmR5bl9sdHJlZVsyKmVdKXJldHVybiBuO3JldHVybiByfTtsZXQgb3Q9ITE7Y29uc3QgaHQ9KHQsZSxyLG4pPT57UCh0LChzPDwxKSsobj8xOjApLDMpLFYodCxlLHIsITApfSxsdD0odCxyLG4sYSk9PntsZXQgcyxsLGM9MDt0LmxldmVsPjA/KHQuc3RybS5kYXRhX3R5cGU9PT1pJiYodC5zdHJtLmRhdGFfdHlwZT1zdCh0KSksZXQodCx0LmxfZGVzYyksZXQodCx0LmRfZGVzYyksYz1pdCh0KSxzPXQub3B0X2xlbiszKzc+Pj4zLGw9dC5zdGF0aWNfbGVuKzMrNz4+PjMsbDw9cyYmKHM9bCkpOnM9bD1uKzUsbis0PD1zJiYtMSE9PXI/aHQodCxyLG4sYSk6dC5zdHJhdGVneT09PWV8fGw9PT1zPyhQKHQsKG88PDEpKyhhPzE6MCksMyksdHQodCxSLEQpKTooUCh0LChoPDwxKSsoYT8xOjApLDMpLGF0KHQsdC5sX2Rlc2MubWF4X2NvZGUrMSx0LmRfZGVzYy5tYXhfY29kZSsxLGMrMSksdHQodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLFcodCksYSYmWSh0KX07dmFyIGN0PXtfdHJfaW5pdDp0PT57b3R8fChHKCksb3Q9ITApLHQubF9kZXNjPW5ldyBNKHQuZHluX2x0cmVlLEYpLHQuZF9kZXNjPW5ldyBNKHQuZHluX2R0cmVlLEgpLHQuYmxfZGVzYz1uZXcgTSh0LmJsX3RyZWUsWiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTAsVyh0KX0sX3RyX3N0b3JlZF9ibG9jazpodCxfdHJfZmx1c2hfYmxvY2s6bHQsX3RyX3RhbGx5Oih0LGUscik9Pih0LnBlbmRpbmdfYnVmW3QuZF9idWYrMip0Lmxhc3RfbGl0XT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqdC5sYXN0X2xpdCsxXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QubF9idWYrdC5sYXN0X2xpdF09MjU1JnIsdC5sYXN0X2xpdCsrLDA9PT1lP3QuZHluX2x0cmVlWzIqcl0rKzoodC5tYXRjaGVzKyssZS0tLHQuZHluX2x0cmVlWzIqKFVbcl0rZCsxKV0rKyx0LmR5bl9kdHJlZVsyKk4oZSldKyspLHQubGFzdF9saXQ9PT10LmxpdF9idWZzaXplLTEpLF90cl9hbGlnbjp0PT57UCh0LG88PDEsMyksJCh0LG0sUiksSyh0KX19LHV0PSh0LGUscixuKT0+e2xldCBpPTY1NTM1JnR8MCxhPXQ+Pj4xNiY2NTUzNXwwLHM9MDtmb3IoOzAhPT1yOyl7cz1yPjJlMz8yZTM6cixyLT1zO2Rve2k9aStlW24rK118MCxhPWEraXwwfXdoaWxlKC0tcyk7aSU9NjU1MjEsYSU9NjU1MjF9cmV0dXJuIGl8YTw8MTZ8MH07Y29uc3QgZHQ9bmV3IFVpbnQzMkFycmF5KCgoKT0+e2xldCB0LGU9W107Zm9yKHZhciByPTA7cjwyNTY7cisrKXt0PXI7Zm9yKHZhciBuPTA7bjw4O24rKyl0PTEmdD8zOTg4MjkyMzg0XnQ+Pj4xOnQ+Pj4xO2Vbcl09dH1yZXR1cm4gZX0pKCkpO3ZhciBfdD0odCxlLHIsbik9Pntjb25zdCBpPWR0LGE9bityO3RePS0xO2ZvcihsZXQgcj1uO3I8YTtyKyspdD10Pj4+OF5pWzI1NSYodF5lW3JdKV07cmV0dXJuLTFedH0sZnQ9ezI6Im5lZWQgZGljdGlvbmFyeSIsMToic3RyZWFtIGVuZCIsMDoiIiwiLTEiOiJmaWxlIGVycm9yIiwiLTIiOiJzdHJlYW0gZXJyb3IiLCItMyI6ImRhdGEgZXJyb3IiLCItNCI6Imluc3VmZmljaWVudCBtZW1vcnkiLCItNSI6ImJ1ZmZlciBlcnJvciIsIi02IjoiaW5jb21wYXRpYmxlIHZlcnNpb24ifSxwdD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX01FTV9FUlJPUjotNCxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTtjb25zdHtfdHJfaW5pdDpndCxfdHJfc3RvcmVkX2Jsb2NrOnl0LF90cl9mbHVzaF9ibG9jazp2dCxfdHJfdGFsbHk6d3QsX3RyX2FsaWduOm10fT1jdCx7Wl9OT19GTFVTSDpidCxaX1BBUlRJQUxfRkxVU0g6eHQsWl9GVUxMX0ZMVVNIOmt0LFpfRklOSVNIOnp0LFpfQkxPQ0s6QXQsWl9PSzpFdCxaX1NUUkVBTV9FTkQ6U3QsWl9TVFJFQU1fRVJST1I6QnQsWl9EQVRBX0VSUk9SOlJ0LFpfQlVGX0VSUk9SOkR0LFpfREVGQVVMVF9DT01QUkVTU0lPTjpMdCxaX0ZJTFRFUkVEOlV0LFpfSFVGRk1BTl9PTkxZOkN0LFpfUkxFOk90LFpfRklYRUQ6VHQsWl9ERUZBVUxUX1NUUkFURUdZOkZ0LFpfVU5LTk9XTjpIdCxaX0RFRkxBVEVEOlp0fT1wdCxNdD05LE50PTE1LEl0PTgsUHQ9Mjg2LCR0PTMwLGp0PTE5LEt0PTIqUHQrMSxYdD0xNSxxdD0zLEd0PTI1OCxXdD1HdCtxdCsxLFl0PTMyLFZ0PTQyLEp0PTY5LFF0PTczLHRlPTkxLGVlPTEwMyxyZT0xMTMsbmU9NjY2LGllPTEsYWU9MixzZT0zLG9lPTQsaGU9MyxsZT0odCxlKT0+KHQubXNnPWZ0W2VdLGUpLGNlPXQ9Pih0PDwxKS0odD40Pzk6MCksdWU9dD0+e2xldCBlPXQubGVuZ3RoO2Zvcig7LS1lPj0wOyl0W2VdPTB9O2xldCBkZT0odCxlLHIpPT4oZTw8dC5oYXNoX3NoaWZ0XnIpJnQuaGFzaF9tYXNrO2NvbnN0IF9lPXQ9Pntjb25zdCBlPXQuc3RhdGU7bGV0IHI9ZS5wZW5kaW5nO3I+dC5hdmFpbF9vdXQmJihyPXQuYXZhaWxfb3V0KSwwIT09ciYmKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsZS5wZW5kaW5nX291dCtyKSx0Lm5leHRfb3V0KSx0Lm5leHRfb3V0Kz1yLGUucGVuZGluZ19vdXQrPXIsdC50b3RhbF9vdXQrPXIsdC5hdmFpbF9vdXQtPXIsZS5wZW5kaW5nLT1yLDA9PT1lLnBlbmRpbmcmJihlLnBlbmRpbmdfb3V0PTApKX0sZmU9KHQsZSk9Pnt2dCh0LHQuYmxvY2tfc3RhcnQ+PTA/dC5ibG9ja19zdGFydDotMSx0LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsZSksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0LF9lKHQuc3RybSl9LHBlPSh0LGUpPT57dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX0sZ2U9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JmV9LHllPSh0LGUscixuKT0+e2xldCBpPXQuYXZhaWxfaW47cmV0dXJuIGk+biYmKGk9biksMD09PWk/MDoodC5hdmFpbF9pbi09aSxlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbix0Lm5leHRfaW4raSksciksMT09PXQuc3RhdGUud3JhcD90LmFkbGVyPXV0KHQuYWRsZXIsZSxpLHIpOjI9PT10LnN0YXRlLndyYXAmJih0LmFkbGVyPV90KHQuYWRsZXIsZSxpLHIpKSx0Lm5leHRfaW4rPWksdC50b3RhbF9pbis9aSxpKX0sdmU9KHQsZSk9PntsZXQgcixuLGk9dC5tYXhfY2hhaW5fbGVuZ3RoLGE9dC5zdHJzdGFydCxzPXQucHJldl9sZW5ndGgsbz10Lm5pY2VfbWF0Y2g7Y29uc3QgaD10LnN0cnN0YXJ0PnQud19zaXplLVd0P3Quc3Ryc3RhcnQtKHQud19zaXplLVd0KTowLGw9dC53aW5kb3csYz10LndfbWFzayx1PXQucHJldixkPXQuc3Ryc3RhcnQrR3Q7bGV0IF89bFthK3MtMV0sZj1sW2Erc107dC5wcmV2X2xlbmd0aD49dC5nb29kX21hdGNoJiYoaT4+PTIpLG8+dC5sb29rYWhlYWQmJihvPXQubG9va2FoZWFkKTtkb3tpZihyPWUsbFtyK3NdPT09ZiYmbFtyK3MtMV09PT1fJiZsW3JdPT09bFthXSYmbFsrK3JdPT09bFthKzFdKXthKz0yLHIrKztkb3t9d2hpbGUobFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmxbKythXT09PWxbKytyXSYmbFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmxbKythXT09PWxbKytyXSYmbFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmE8ZCk7aWYobj1HdC0oZC1hKSxhPWQtR3Qsbj5zKXtpZih0Lm1hdGNoX3N0YXJ0PWUscz1uLG4+PW8pYnJlYWs7Xz1sW2Ercy0xXSxmPWxbYStzXX19fXdoaWxlKChlPXVbZSZjXSk+aCYmMCE9LS1pKTtyZXR1cm4gczw9dC5sb29rYWhlYWQ/czp0Lmxvb2thaGVhZH0sd2U9dD0+e2NvbnN0IGU9dC53X3NpemU7bGV0IHIsbixpLGEscztkb3tpZihhPXQud2luZG93X3NpemUtdC5sb29rYWhlYWQtdC5zdHJzdGFydCx0LnN0cnN0YXJ0Pj1lKyhlLVd0KSl7dC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KGUsZStlKSwwKSx0Lm1hdGNoX3N0YXJ0LT1lLHQuc3Ryc3RhcnQtPWUsdC5ibG9ja19zdGFydC09ZSxuPXQuaGFzaF9zaXplLHI9bjtkb3tpPXQuaGVhZFstLXJdLHQuaGVhZFtyXT1pPj1lP2ktZTowfXdoaWxlKC0tbik7bj1lLHI9bjtkb3tpPXQucHJldlstLXJdLHQucHJldltyXT1pPj1lP2ktZTowfXdoaWxlKC0tbik7YSs9ZX1pZigwPT09dC5zdHJtLmF2YWlsX2luKWJyZWFrO2lmKG49eWUodC5zdHJtLHQud2luZG93LHQuc3Ryc3RhcnQrdC5sb29rYWhlYWQsYSksdC5sb29rYWhlYWQrPW4sdC5sb29rYWhlYWQrdC5pbnNlcnQ+PXF0KWZvcihzPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tzXSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1tzKzFdKTt0Lmluc2VydCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3MrcXQtMV0pLHQucHJldltzJnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPXMscysrLHQuaW5zZXJ0LS0sISh0Lmxvb2thaGVhZCt0Lmluc2VydDxxdCkpOyk7fXdoaWxlKHQubG9va2FoZWFkPFd0JiYwIT09dC5zdHJtLmF2YWlsX2luKX0sbWU9KHQsZSk9PntsZXQgcixuO2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8V3Qpe2lmKHdlKHQpLHQubG9va2FoZWFkPFd0JiZlPT09YnQpcmV0dXJuIGllO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZihyPTAsdC5sb29rYWhlYWQ+PXF0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtxdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSwwIT09ciYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1XdCYmKHQubWF0Y2hfbGVuZ3RoPXZlKHQscikpLHQubWF0Y2hfbGVuZ3RoPj1xdClpZihuPXd0KHQsdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoLXF0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj1xdCl7dC5tYXRjaF9sZW5ndGgtLTtkb3t0LnN0cnN0YXJ0KyssdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtxdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0fXdoaWxlKDAhPS0tdC5tYXRjaF9sZW5ndGgpO3Quc3Ryc3RhcnQrK31lbHNlIHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTAsdC5pbnNfaD10LndpbmRvd1t0LnN0cnN0YXJ0XSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0KzFdKTtlbHNlIG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKztpZihuJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDxxdC0xP3Quc3Ryc3RhcnQ6cXQtMSxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxiZT0odCxlKT0+e2xldCByLG4saTtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZih3ZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1xdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrcXQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksdC5wcmV2X2xlbmd0aD10Lm1hdGNoX2xlbmd0aCx0LnByZXZfbWF0Y2g9dC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aD1xdC0xLDAhPT1yJiZ0LnByZXZfbGVuZ3RoPHQubWF4X2xhenlfbWF0Y2gmJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpLHQubWF0Y2hfbGVuZ3RoPD01JiYodC5zdHJhdGVneT09PVV0fHx0Lm1hdGNoX2xlbmd0aD09PXF0JiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD1xdC0xKSksdC5wcmV2X2xlbmd0aD49cXQmJnQubWF0Y2hfbGVuZ3RoPD10LnByZXZfbGVuZ3RoKXtpPXQuc3Ryc3RhcnQrdC5sb29rYWhlYWQtcXQsbj13dCh0LHQuc3Ryc3RhcnQtMS10LnByZXZfbWF0Y2gsdC5wcmV2X2xlbmd0aC1xdCksdC5sb29rYWhlYWQtPXQucHJldl9sZW5ndGgtMSx0LnByZXZfbGVuZ3RoLT0yO2RveysrdC5zdHJzdGFydDw9aSYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrcXQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCl9d2hpbGUoMCE9LS10LnByZXZfbGVuZ3RoKTtpZih0Lm1hdGNoX2F2YWlsYWJsZT0wLHQubWF0Y2hfbGVuZ3RoPXF0LTEsdC5zdHJzdGFydCsrLG4mJihmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLG4mJmZlKHQsITEpLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tLDA9PT10LnN0cm0uYXZhaWxfb3V0KXJldHVybiBpZX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSksdC5tYXRjaF9hdmFpbGFibGU9MCksdC5pbnNlcnQ9dC5zdHJzdGFydDxxdC0xP3Quc3Ryc3RhcnQ6cXQtMSxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSx4ZT0odCxlKT0+e2xldCByLG4saSxhO2NvbnN0IHM9dC53aW5kb3c7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDw9R3Qpe2lmKHdlKHQpLHQubG9va2FoZWFkPD1HdCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCx0Lmxvb2thaGVhZD49cXQmJnQuc3Ryc3RhcnQ+MCYmKGk9dC5zdHJzdGFydC0xLG49c1tpXSxuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldKSl7YT10LnN0cnN0YXJ0K0d0O2Rve313aGlsZShuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZuPT09c1srK2ldJiZpPGEpO3QubWF0Y2hfbGVuZ3RoPUd0LShhLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj1xdD8ocj13dCh0LDEsdC5tYXRjaF9sZW5ndGgtcXQpLHQubG9va2FoZWFkLT10Lm1hdGNoX2xlbmd0aCx0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wKToocj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxrZT0odCxlKT0+e2xldCByO2Zvcig7Oyl7aWYoMD09PXQubG9va2FoZWFkJiYod2UodCksMD09PXQubG9va2FoZWFkKSl7aWYoZT09PWJ0KXJldHVybiBpZTticmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P3NlOm9lKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfTtmdW5jdGlvbiB6ZSh0LGUscixuLGkpe3RoaXMuZ29vZF9sZW5ndGg9dCx0aGlzLm1heF9sYXp5PWUsdGhpcy5uaWNlX2xlbmd0aD1yLHRoaXMubWF4X2NoYWluPW4sdGhpcy5mdW5jPWl9Y29uc3QgQWU9W25ldyB6ZSgwLDAsMCwwLCgodCxlKT0+e2xldCByPTY1NTM1O2ZvcihyPnQucGVuZGluZ19idWZfc2l6ZS01JiYocj10LnBlbmRpbmdfYnVmX3NpemUtNSk7Oyl7aWYodC5sb29rYWhlYWQ8PTEpe2lmKHdlKHQpLDA9PT10Lmxvb2thaGVhZCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9dC5zdHJzdGFydCs9dC5sb29rYWhlYWQsdC5sb29rYWhlYWQ9MDtjb25zdCBuPXQuYmxvY2tfc3RhcnQrcjtpZigoMD09PXQuc3Ryc3RhcnR8fHQuc3Ryc3RhcnQ+PW4pJiYodC5sb29rYWhlYWQ9dC5zdHJzdGFydC1uLHQuc3Ryc3RhcnQ9bixmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllO2lmKHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydD49dC53X3NpemUtV3QmJihmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfXJldHVybiB0Lmluc2VydD0wLGU9PT16dD8oZmUodCwhMCksMD09PXQuc3RybS5hdmFpbF9vdXQ/c2U6b2UpOih0LnN0cnN0YXJ0PnQuYmxvY2tfc3RhcnQmJihmZSh0LCExKSx0LnN0cm0uYXZhaWxfb3V0KSxpZSl9KSksbmV3IHplKDQsNCw4LDQsbWUpLG5ldyB6ZSg0LDUsMTYsOCxtZSksbmV3IHplKDQsNiwzMiwzMixtZSksbmV3IHplKDQsNCwxNiwxNixiZSksbmV3IHplKDgsMTYsMzIsMzIsYmUpLG5ldyB6ZSg4LDE2LDEyOCwxMjgsYmUpLG5ldyB6ZSg4LDMyLDEyOCwyNTYsYmUpLG5ldyB6ZSgzMiwxMjgsMjU4LDEwMjQsYmUpLG5ldyB6ZSgzMiwyNTgsMjU4LDQwOTYsYmUpXSxFZT10PT57dC53aW5kb3dfc2l6ZT0yKnQud19zaXplLHVlKHQuaGVhZCksdC5tYXhfbGF6eV9tYXRjaD1BZVt0LmxldmVsXS5tYXhfbGF6eSx0Lmdvb2RfbWF0Y2g9QWVbdC5sZXZlbF0uZ29vZF9sZW5ndGgsdC5uaWNlX21hdGNoPUFlW3QubGV2ZWxdLm5pY2VfbGVuZ3RoLHQubWF4X2NoYWluX2xlbmd0aD1BZVt0LmxldmVsXS5tYXhfY2hhaW4sdC5zdHJzdGFydD0wLHQuYmxvY2tfc3RhcnQ9MCx0Lmxvb2thaGVhZD0wLHQuaW5zZXJ0PTAsdC5tYXRjaF9sZW5ndGg9dC5wcmV2X2xlbmd0aD1xdC0xLHQubWF0Y2hfYXZhaWxhYmxlPTAsdC5pbnNfaD0wfTtmdW5jdGlvbiBTZSgpe3RoaXMuc3RybT1udWxsLHRoaXMuc3RhdHVzPTAsdGhpcy5wZW5kaW5nX2J1Zj1udWxsLHRoaXMucGVuZGluZ19idWZfc2l6ZT0wLHRoaXMucGVuZGluZ19vdXQ9MCx0aGlzLnBlbmRpbmc9MCx0aGlzLndyYXA9MCx0aGlzLmd6aGVhZD1udWxsLHRoaXMuZ3ppbmRleD0wLHRoaXMubWV0aG9kPVp0LHRoaXMubGFzdF9mbHVzaD0tMSx0aGlzLndfc2l6ZT0wLHRoaXMud19iaXRzPTAsdGhpcy53X21hc2s9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMud2luZG93X3NpemU9MCx0aGlzLnByZXY9bnVsbCx0aGlzLmhlYWQ9bnVsbCx0aGlzLmluc19oPTAsdGhpcy5oYXNoX3NpemU9MCx0aGlzLmhhc2hfYml0cz0wLHRoaXMuaGFzaF9tYXNrPTAsdGhpcy5oYXNoX3NoaWZ0PTAsdGhpcy5ibG9ja19zdGFydD0wLHRoaXMubWF0Y2hfbGVuZ3RoPTAsdGhpcy5wcmV2X21hdGNoPTAsdGhpcy5tYXRjaF9hdmFpbGFibGU9MCx0aGlzLnN0cnN0YXJ0PTAsdGhpcy5tYXRjaF9zdGFydD0wLHRoaXMubG9va2FoZWFkPTAsdGhpcy5wcmV2X2xlbmd0aD0wLHRoaXMubWF4X2NoYWluX2xlbmd0aD0wLHRoaXMubWF4X2xhenlfbWF0Y2g9MCx0aGlzLmxldmVsPTAsdGhpcy5zdHJhdGVneT0wLHRoaXMuZ29vZF9tYXRjaD0wLHRoaXMubmljZV9tYXRjaD0wLHRoaXMuZHluX2x0cmVlPW5ldyBVaW50MTZBcnJheSgyKkt0KSx0aGlzLmR5bl9kdHJlZT1uZXcgVWludDE2QXJyYXkoMiooMiokdCsxKSksdGhpcy5ibF90cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKmp0KzEpKSx1ZSh0aGlzLmR5bl9sdHJlZSksdWUodGhpcy5keW5fZHRyZWUpLHVlKHRoaXMuYmxfdHJlZSksdGhpcy5sX2Rlc2M9bnVsbCx0aGlzLmRfZGVzYz1udWxsLHRoaXMuYmxfZGVzYz1udWxsLHRoaXMuYmxfY291bnQ9bmV3IFVpbnQxNkFycmF5KFh0KzEpLHRoaXMuaGVhcD1uZXcgVWludDE2QXJyYXkoMipQdCsxKSx1ZSh0aGlzLmhlYXApLHRoaXMuaGVhcF9sZW49MCx0aGlzLmhlYXBfbWF4PTAsdGhpcy5kZXB0aD1uZXcgVWludDE2QXJyYXkoMipQdCsxKSx1ZSh0aGlzLmRlcHRoKSx0aGlzLmxfYnVmPTAsdGhpcy5saXRfYnVmc2l6ZT0wLHRoaXMubGFzdF9saXQ9MCx0aGlzLmRfYnVmPTAsdGhpcy5vcHRfbGVuPTAsdGhpcy5zdGF0aWNfbGVuPTAsdGhpcy5tYXRjaGVzPTAsdGhpcy5pbnNlcnQ9MCx0aGlzLmJpX2J1Zj0wLHRoaXMuYmlfdmFsaWQ9MH1jb25zdCBCZT10PT57aWYoIXR8fCF0LnN0YXRlKXJldHVybiBsZSh0LEJ0KTt0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9SHQ7Y29uc3QgZT10LnN0YXRlO3JldHVybiBlLnBlbmRpbmc9MCxlLnBlbmRpbmdfb3V0PTAsZS53cmFwPDAmJihlLndyYXA9LWUud3JhcCksZS5zdGF0dXM9ZS53cmFwP1Z0OnJlLHQuYWRsZXI9Mj09PWUud3JhcD8wOjEsZS5sYXN0X2ZsdXNoPWJ0LGd0KGUpLEV0fSxSZT10PT57Y29uc3QgZT1CZSh0KTtyZXR1cm4gZT09PUV0JiZFZSh0LnN0YXRlKSxlfSxEZT0odCxlLHIsbixpLGEpPT57aWYoIXQpcmV0dXJuIEJ0O2xldCBzPTE7aWYoZT09PUx0JiYoZT02KSxuPDA/KHM9MCxuPS1uKTpuPjE1JiYocz0yLG4tPTE2KSxpPDF8fGk+TXR8fHIhPT1adHx8bjw4fHxuPjE1fHxlPDB8fGU+OXx8YTwwfHxhPlR0KXJldHVybiBsZSh0LEJ0KTs4PT09biYmKG49OSk7Y29uc3Qgbz1uZXcgU2U7cmV0dXJuIHQuc3RhdGU9byxvLnN0cm09dCxvLndyYXA9cyxvLmd6aGVhZD1udWxsLG8ud19iaXRzPW4sby53X3NpemU9MTw8by53X2JpdHMsby53X21hc2s9by53X3NpemUtMSxvLmhhc2hfYml0cz1pKzcsby5oYXNoX3NpemU9MTw8by5oYXNoX2JpdHMsby5oYXNoX21hc2s9by5oYXNoX3NpemUtMSxvLmhhc2hfc2hpZnQ9fn4oKG8uaGFzaF9iaXRzK3F0LTEpL3F0KSxvLndpbmRvdz1uZXcgVWludDhBcnJheSgyKm8ud19zaXplKSxvLmhlYWQ9bmV3IFVpbnQxNkFycmF5KG8uaGFzaF9zaXplKSxvLnByZXY9bmV3IFVpbnQxNkFycmF5KG8ud19zaXplKSxvLmxpdF9idWZzaXplPTE8PGkrNixvLnBlbmRpbmdfYnVmX3NpemU9NCpvLmxpdF9idWZzaXplLG8ucGVuZGluZ19idWY9bmV3IFVpbnQ4QXJyYXkoby5wZW5kaW5nX2J1Zl9zaXplKSxvLmRfYnVmPTEqby5saXRfYnVmc2l6ZSxvLmxfYnVmPTMqby5saXRfYnVmc2l6ZSxvLmxldmVsPWUsby5zdHJhdGVneT1hLG8ubWV0aG9kPXIsUmUodCl9O3ZhciBMZT17ZGVmbGF0ZUluaXQ6KHQsZSk9PkRlKHQsZSxadCxOdCxJdCxGdCksZGVmbGF0ZUluaXQyOkRlLGRlZmxhdGVSZXNldDpSZSxkZWZsYXRlUmVzZXRLZWVwOkJlLGRlZmxhdGVTZXRIZWFkZXI6KHQsZSk9PnQmJnQuc3RhdGU/MiE9PXQuc3RhdGUud3JhcD9CdDoodC5zdGF0ZS5nemhlYWQ9ZSxFdCk6QnQsZGVmbGF0ZToodCxlKT0+e2xldCByLG47aWYoIXR8fCF0LnN0YXRlfHxlPkF0fHxlPDApcmV0dXJuIHQ/bGUodCxCdCk6QnQ7Y29uc3QgaT10LnN0YXRlO2lmKCF0Lm91dHB1dHx8IXQuaW5wdXQmJjAhPT10LmF2YWlsX2lufHxpLnN0YXR1cz09PW5lJiZlIT09enQpcmV0dXJuIGxlKHQsMD09PXQuYXZhaWxfb3V0P0R0OkJ0KTtpLnN0cm09dDtjb25zdCBhPWkubGFzdF9mbHVzaDtpZihpLmxhc3RfZmx1c2g9ZSxpLnN0YXR1cz09PVZ0KWlmKDI9PT1pLndyYXApdC5hZGxlcj0wLHBlKGksMzEpLHBlKGksMTM5KSxwZShpLDgpLGkuZ3poZWFkPyhwZShpLChpLmd6aGVhZC50ZXh0PzE6MCkrKGkuZ3poZWFkLmhjcmM/MjowKSsoaS5nemhlYWQuZXh0cmE/NDowKSsoaS5nemhlYWQubmFtZT84OjApKyhpLmd6aGVhZC5jb21tZW50PzE2OjApKSxwZShpLDI1NSZpLmd6aGVhZC50aW1lKSxwZShpLGkuZ3poZWFkLnRpbWU+PjgmMjU1KSxwZShpLGkuZ3poZWFkLnRpbWU+PjE2JjI1NSkscGUoaSxpLmd6aGVhZC50aW1lPj4yNCYyNTUpLHBlKGksOT09PWkubGV2ZWw/MjppLnN0cmF0ZWd5Pj1DdHx8aS5sZXZlbDwyPzQ6MCkscGUoaSwyNTUmaS5nemhlYWQub3MpLGkuZ3poZWFkLmV4dHJhJiZpLmd6aGVhZC5leHRyYS5sZW5ndGgmJihwZShpLDI1NSZpLmd6aGVhZC5leHRyYS5sZW5ndGgpLHBlKGksaS5nemhlYWQuZXh0cmEubGVuZ3RoPj44JjI1NSkpLGkuZ3poZWFkLmhjcmMmJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmcsMCkpLGkuZ3ppbmRleD0wLGkuc3RhdHVzPUp0KToocGUoaSwwKSxwZShpLDApLHBlKGksMCkscGUoaSwwKSxwZShpLDApLHBlKGksOT09PWkubGV2ZWw/MjppLnN0cmF0ZWd5Pj1DdHx8aS5sZXZlbDwyPzQ6MCkscGUoaSxoZSksaS5zdGF0dXM9cmUpO2Vsc2V7bGV0IGU9WnQrKGkud19iaXRzLTg8PDQpPDw4LHI9LTE7cj1pLnN0cmF0ZWd5Pj1DdHx8aS5sZXZlbDwyPzA6aS5sZXZlbDw2PzE6Nj09PWkubGV2ZWw/MjozLGV8PXI8PDYsMCE9PWkuc3Ryc3RhcnQmJihlfD1ZdCksZSs9MzEtZSUzMSxpLnN0YXR1cz1yZSxnZShpLGUpLDAhPT1pLnN0cnN0YXJ0JiYoZ2UoaSx0LmFkbGVyPj4+MTYpLGdlKGksNjU1MzUmdC5hZGxlcikpLHQuYWRsZXI9MX1pZihpLnN0YXR1cz09PUp0KWlmKGkuZ3poZWFkLmV4dHJhKXtmb3Iocj1pLnBlbmRpbmc7aS5nemluZGV4PCg2NTUzNSZpLmd6aGVhZC5leHRyYS5sZW5ndGgpJiYoaS5wZW5kaW5nIT09aS5wZW5kaW5nX2J1Zl9zaXplfHwoaS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksX2UodCkscj1pLnBlbmRpbmcsaS5wZW5kaW5nIT09aS5wZW5kaW5nX2J1Zl9zaXplKSk7KXBlKGksMjU1JmkuZ3poZWFkLmV4dHJhW2kuZ3ppbmRleF0pLGkuZ3ppbmRleCsrO2kuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLGkuZ3ppbmRleD09PWkuZ3poZWFkLmV4dHJhLmxlbmd0aCYmKGkuZ3ppbmRleD0wLGkuc3RhdHVzPVF0KX1lbHNlIGkuc3RhdHVzPVF0O2lmKGkuc3RhdHVzPT09UXQpaWYoaS5nemhlYWQubmFtZSl7cj1pLnBlbmRpbmc7ZG97aWYoaS5wZW5kaW5nPT09aS5wZW5kaW5nX2J1Zl9zaXplJiYoaS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksX2UodCkscj1pLnBlbmRpbmcsaS5wZW5kaW5nPT09aS5wZW5kaW5nX2J1Zl9zaXplKSl7bj0xO2JyZWFrfW49aS5nemluZGV4PGkuZ3poZWFkLm5hbWUubGVuZ3RoPzI1NSZpLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQoaS5nemluZGV4KyspOjAscGUoaSxuKX13aGlsZSgwIT09bik7aS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksMD09PW4mJihpLmd6aW5kZXg9MCxpLnN0YXR1cz10ZSl9ZWxzZSBpLnN0YXR1cz10ZTtpZihpLnN0YXR1cz09PXRlKWlmKGkuZ3poZWFkLmNvbW1lbnQpe3I9aS5wZW5kaW5nO2Rve2lmKGkucGVuZGluZz09PWkucGVuZGluZ19idWZfc2l6ZSYmKGkuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLF9lKHQpLHI9aS5wZW5kaW5nLGkucGVuZGluZz09PWkucGVuZGluZ19idWZfc2l6ZSkpe249MTticmVha31uPWkuZ3ppbmRleDxpLmd6aGVhZC5jb21tZW50Lmxlbmd0aD8yNTUmaS5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KGkuZ3ppbmRleCsrKTowLHBlKGksbil9d2hpbGUoMCE9PW4pO2kuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLDA9PT1uJiYoaS5zdGF0dXM9ZWUpfWVsc2UgaS5zdGF0dXM9ZWU7aWYoaS5zdGF0dXM9PT1lZSYmKGkuZ3poZWFkLmhjcmM/KGkucGVuZGluZysyPmkucGVuZGluZ19idWZfc2l6ZSYmX2UodCksaS5wZW5kaW5nKzI8PWkucGVuZGluZ19idWZfc2l6ZSYmKHBlKGksMjU1JnQuYWRsZXIpLHBlKGksdC5hZGxlcj4+OCYyNTUpLHQuYWRsZXI9MCxpLnN0YXR1cz1yZSkpOmkuc3RhdHVzPXJlKSwwIT09aS5wZW5kaW5nKXtpZihfZSh0KSwwPT09dC5hdmFpbF9vdXQpcmV0dXJuIGkubGFzdF9mbHVzaD0tMSxFdH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZjZShlKTw9Y2UoYSkmJmUhPT16dClyZXR1cm4gbGUodCxEdCk7aWYoaS5zdGF0dXM9PT1uZSYmMCE9PXQuYXZhaWxfaW4pcmV0dXJuIGxlKHQsRHQpO2lmKDAhPT10LmF2YWlsX2lufHwwIT09aS5sb29rYWhlYWR8fGUhPT1idCYmaS5zdGF0dXMhPT1uZSl7bGV0IHI9aS5zdHJhdGVneT09PUN0P2tlKGksZSk6aS5zdHJhdGVneT09PU90P3hlKGksZSk6QWVbaS5sZXZlbF0uZnVuYyhpLGUpO2lmKHIhPT1zZSYmciE9PW9lfHwoaS5zdGF0dXM9bmUpLHI9PT1pZXx8cj09PXNlKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihpLmxhc3RfZmx1c2g9LTEpLEV0O2lmKHI9PT1hZSYmKGU9PT14dD9tdChpKTplIT09QXQmJih5dChpLDAsMCwhMSksZT09PWt0JiYodWUoaS5oZWFkKSwwPT09aS5sb29rYWhlYWQmJihpLnN0cnN0YXJ0PTAsaS5ibG9ja19zdGFydD0wLGkuaW5zZXJ0PTApKSksX2UodCksMD09PXQuYXZhaWxfb3V0KSlyZXR1cm4gaS5sYXN0X2ZsdXNoPS0xLEV0fXJldHVybiBlIT09enQ/RXQ6aS53cmFwPD0wP1N0OigyPT09aS53cmFwPyhwZShpLDI1NSZ0LmFkbGVyKSxwZShpLHQuYWRsZXI+PjgmMjU1KSxwZShpLHQuYWRsZXI+PjE2JjI1NSkscGUoaSx0LmFkbGVyPj4yNCYyNTUpLHBlKGksMjU1JnQudG90YWxfaW4pLHBlKGksdC50b3RhbF9pbj4+OCYyNTUpLHBlKGksdC50b3RhbF9pbj4+MTYmMjU1KSxwZShpLHQudG90YWxfaW4+PjI0JjI1NSkpOihnZShpLHQuYWRsZXI+Pj4xNiksZ2UoaSw2NTUzNSZ0LmFkbGVyKSksX2UodCksaS53cmFwPjAmJihpLndyYXA9LWkud3JhcCksMCE9PWkucGVuZGluZz9FdDpTdCl9LGRlZmxhdGVFbmQ6dD0+e2lmKCF0fHwhdC5zdGF0ZSlyZXR1cm4gQnQ7Y29uc3QgZT10LnN0YXRlLnN0YXR1cztyZXR1cm4gZSE9PVZ0JiZlIT09SnQmJmUhPT1RdCYmZSE9PXRlJiZlIT09ZWUmJmUhPT1yZSYmZSE9PW5lP2xlKHQsQnQpOih0LnN0YXRlPW51bGwsZT09PXJlP2xlKHQsUnQpOkV0KX0sZGVmbGF0ZVNldERpY3Rpb25hcnk6KHQsZSk9PntsZXQgcj1lLmxlbmd0aDtpZighdHx8IXQuc3RhdGUpcmV0dXJuIEJ0O2NvbnN0IG49dC5zdGF0ZSxpPW4ud3JhcDtpZigyPT09aXx8MT09PWkmJm4uc3RhdHVzIT09VnR8fG4ubG9va2FoZWFkKXJldHVybiBCdDtpZigxPT09aSYmKHQuYWRsZXI9dXQodC5hZGxlcixlLHIsMCkpLG4ud3JhcD0wLHI+PW4ud19zaXplKXswPT09aSYmKHVlKG4uaGVhZCksbi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKTtsZXQgdD1uZXcgVWludDhBcnJheShuLndfc2l6ZSk7dC5zZXQoZS5zdWJhcnJheShyLW4ud19zaXplLHIpLDApLGU9dCxyPW4ud19zaXplfWNvbnN0IGE9dC5hdmFpbF9pbixzPXQubmV4dF9pbixvPXQuaW5wdXQ7Zm9yKHQuYXZhaWxfaW49cix0Lm5leHRfaW49MCx0LmlucHV0PWUsd2Uobik7bi5sb29rYWhlYWQ+PXF0Oyl7bGV0IHQ9bi5zdHJzdGFydCxlPW4ubG9va2FoZWFkLShxdC0xKTtkb3tuLmluc19oPWRlKG4sbi5pbnNfaCxuLndpbmRvd1t0K3F0LTFdKSxuLnByZXZbdCZuLndfbWFza109bi5oZWFkW24uaW5zX2hdLG4uaGVhZFtuLmluc19oXT10LHQrK313aGlsZSgtLWUpO24uc3Ryc3RhcnQ9dCxuLmxvb2thaGVhZD1xdC0xLHdlKG4pfXJldHVybiBuLnN0cnN0YXJ0Kz1uLmxvb2thaGVhZCxuLmJsb2NrX3N0YXJ0PW4uc3Ryc3RhcnQsbi5pbnNlcnQ9bi5sb29rYWhlYWQsbi5sb29rYWhlYWQ9MCxuLm1hdGNoX2xlbmd0aD1uLnByZXZfbGVuZ3RoPXF0LTEsbi5tYXRjaF9hdmFpbGFibGU9MCx0Lm5leHRfaW49cyx0LmlucHV0PW8sdC5hdmFpbF9pbj1hLG4ud3JhcD1pLEV0fSxkZWZsYXRlSW5mbzoicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSJ9O2NvbnN0IFVlPSh0LGUpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKTt2YXIgQ2U9ZnVuY3Rpb24odCl7Y29uc3QgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKDtlLmxlbmd0aDspe2NvbnN0IHI9ZS5zaGlmdCgpO2lmKHIpe2lmKCJvYmplY3QiIT10eXBlb2Ygcil0aHJvdyBuZXcgVHlwZUVycm9yKHIrIm11c3QgYmUgbm9uLW9iamVjdCIpO2Zvcihjb25zdCBlIGluIHIpVWUocixlKSYmKHRbZV09cltlXSl9fXJldHVybiB0fSxPZT17YXNzaWduOkNlLGZsYXR0ZW5DaHVua3M6dD0+e2xldCBlPTA7Zm9yKGxldCByPTAsbj10Lmxlbmd0aDtyPG47cisrKWUrPXRbcl0ubGVuZ3RoO2NvbnN0IHI9bmV3IFVpbnQ4QXJyYXkoZSk7Zm9yKGxldCBlPTAsbj0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl7bGV0IGk9dFtlXTtyLnNldChpLG4pLG4rPWkubGVuZ3RofXJldHVybiByfX07bGV0IFRlPSEwO3RyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHQpe1RlPSExfWNvbnN0IEZlPW5ldyBVaW50OEFycmF5KDI1Nik7Zm9yKGxldCB0PTA7dDwyNTY7dCsrKUZlW3RdPXQ+PTI1Mj82OnQ+PTI0OD81OnQ+PTI0MD80OnQ+PTIyND8zOnQ+PTE5Mj8yOjE7RmVbMjU0XT1GZVsyNTRdPTE7Y29uc3QgSGU9KHQsZSk9PntpZihlPDY1NTM0JiZ0LnN1YmFycmF5JiZUZSlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXkoMCxlKSk7bGV0IHI9IiI7Zm9yKGxldCBuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfTt2YXIgWmU9e3N0cmluZzJidWY6dD0+e2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RW5jb2RlciYmVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSlyZXR1cm4obmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCk7bGV0IGUscixuLGksYSxzPXQubGVuZ3RoLG89MDtmb3IoaT0wO2k8cztpKyspcj10LmNoYXJDb2RlQXQoaSksNTUyOTY9PSg2NDUxMiZyKSYmaSsxPHMmJihuPXQuY2hhckNvZGVBdChpKzEpLDU2MzIwPT0oNjQ1MTImbikmJihyPTY1NTM2KyhyLTU1Mjk2PDwxMCkrKG4tNTYzMjApLGkrKykpLG8rPXI8MTI4PzE6cjwyMDQ4PzI6cjw2NTUzNj8zOjQ7Zm9yKGU9bmV3IFVpbnQ4QXJyYXkobyksYT0wLGk9MDthPG87aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxzJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxyPDEyOD9lW2ErK109cjpyPDIwNDg/KGVbYSsrXT0xOTJ8cj4+PjYsZVthKytdPTEyOHw2MyZyKTpyPDY1NTM2PyhlW2ErK109MjI0fHI+Pj4xMixlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik6KGVbYSsrXT0yNDB8cj4+PjE4LGVbYSsrXT0xMjh8cj4+PjEyJjYzLGVbYSsrXT0xMjh8cj4+PjYmNjMsZVthKytdPTEyOHw2MyZyKTtyZXR1cm4gZX0sYnVmMnN0cmluZzoodCxlKT0+e2NvbnN0IHI9ZXx8dC5sZW5ndGg7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFRleHREZWNvZGVyJiZUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKXJldHVybihuZXcgVGV4dERlY29kZXIpLmRlY29kZSh0LnN1YmFycmF5KDAsZSkpO2xldCBuLGk7Y29uc3QgYT1uZXcgQXJyYXkoMipyKTtmb3IoaT0wLG49MDtuPHI7KXtsZXQgZT10W24rK107aWYoZTwxMjgpe2FbaSsrXT1lO2NvbnRpbnVlfWxldCBzPUZlW2VdO2lmKHM+NClhW2krK109NjU1MzMsbis9cy0xO2Vsc2V7Zm9yKGUmPTI9PT1zPzMxOjM9PT1zPzE1Ojc7cz4xJiZuPHI7KWU9ZTw8Nnw2MyZ0W24rK10scy0tO3M+MT9hW2krK109NjU1MzM6ZTw2NTUzNj9hW2krK109ZTooZS09NjU1MzYsYVtpKytdPTU1Mjk2fGU+PjEwJjEwMjMsYVtpKytdPTU2MzIwfDEwMjMmZSl9fXJldHVybiBIZShhLGkpfSx1dGY4Ym9yZGVyOih0LGUpPT57KGU9ZXx8dC5sZW5ndGgpPnQubGVuZ3RoJiYoZT10Lmxlbmd0aCk7bGV0IHI9ZS0xO2Zvcig7cj49MCYmMTI4PT0oMTkyJnRbcl0pOylyLS07cmV0dXJuIHI8MHx8MD09PXI/ZTpyK0ZlW3Rbcl1dPmU/cjplfX07ZnVuY3Rpb24gTWUoKXt0aGlzLmlucHV0PW51bGwsdGhpcy5uZXh0X2luPTAsdGhpcy5hdmFpbF9pbj0wLHRoaXMudG90YWxfaW49MCx0aGlzLm91dHB1dD1udWxsLHRoaXMubmV4dF9vdXQ9MCx0aGlzLmF2YWlsX291dD0wLHRoaXMudG90YWxfb3V0PTAsdGhpcy5tc2c9IiIsdGhpcy5zdGF0ZT1udWxsLHRoaXMuZGF0YV90eXBlPTIsdGhpcy5hZGxlcj0wfXZhciBOZT1NZTtjb25zdCBJZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHtaX05PX0ZMVVNIOlBlLFpfU1lOQ19GTFVTSDokZSxaX0ZVTExfRkxVU0g6amUsWl9GSU5JU0g6S2UsWl9PSzpYZSxaX1NUUkVBTV9FTkQ6cWUsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOkdlLFpfREVGQVVMVF9TVFJBVEVHWTpXZSxaX0RFRkxBVEVEOlllfT1wdDtmdW5jdGlvbiBWZSh0KXt0aGlzLm9wdGlvbnM9T2UuYXNzaWduKHtsZXZlbDpHZSxtZXRob2Q6WWUsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTpXZX0sdHx8e30pO2xldCBlPXRoaXMub3B0aW9ucztlLnJhdyYmZS53aW5kb3dCaXRzPjA/ZS53aW5kb3dCaXRzPS1lLndpbmRvd0JpdHM6ZS5nemlwJiZlLndpbmRvd0JpdHM+MCYmZS53aW5kb3dCaXRzPDE2JiYoZS53aW5kb3dCaXRzKz0xNiksdGhpcy5lcnI9MCx0aGlzLm1zZz0iIix0aGlzLmVuZGVkPSExLHRoaXMuY2h1bmtzPVtdLHRoaXMuc3RybT1uZXcgTmUsdGhpcy5zdHJtLmF2YWlsX291dD0wO2xldCByPUxlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sZS5sZXZlbCxlLm1ldGhvZCxlLndpbmRvd0JpdHMsZS5tZW1MZXZlbCxlLnN0cmF0ZWd5KTtpZihyIT09WGUpdGhyb3cgbmV3IEVycm9yKGZ0W3JdKTtpZihlLmhlYWRlciYmTGUuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sZS5oZWFkZXIpLGUuZGljdGlvbmFyeSl7bGV0IHQ7aWYodD0ic3RyaW5nIj09dHlwZW9mIGUuZGljdGlvbmFyeT9aZS5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUllLmNhbGwoZS5kaWN0aW9uYXJ5KT9uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpOmUuZGljdGlvbmFyeSxyPUxlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSx0KSxyIT09WGUpdGhyb3cgbmV3IEVycm9yKGZ0W3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gSmUodCxlKXtjb25zdCByPW5ldyBWZShlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fGZ0W3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9ZnVuY3Rpb24gUWUodCxlKXtyZXR1cm4oZT1lfHx7fSkucmF3PSEwLEplKHQsZSl9ZnVuY3Rpb24gdHIodCxlKXtyZXR1cm4oZT1lfHx7fSkuZ3ppcD0hMCxKZSh0LGUpfVZlLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7Y29uc3Qgcj10aGlzLnN0cm0sbj10aGlzLm9wdGlvbnMuY2h1bmtTaXplO2xldCBpLGE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtmb3IoYT1lPT09fn5lP2U6ITA9PT1lP0tlOlBlLCJzdHJpbmciPT10eXBlb2YgdD9yLmlucHV0PVplLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUllLmNhbGwodCk/ci5pbnB1dD1uZXcgVWludDhBcnJheSh0KTpyLmlucHV0PXQsci5uZXh0X2luPTAsci5hdmFpbF9pbj1yLmlucHV0Lmxlbmd0aDs7KWlmKDA9PT1yLmF2YWlsX291dCYmKHIub3V0cHV0PW5ldyBVaW50OEFycmF5KG4pLHIubmV4dF9vdXQ9MCxyLmF2YWlsX291dD1uKSwoYT09PSRlfHxhPT09amUpJiZyLmF2YWlsX291dDw9Nil0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2V7aWYoaT1MZS5kZWZsYXRlKHIsYSksaT09PXFlKXJldHVybiByLm5leHRfb3V0PjAmJnRoaXMub25EYXRhKHIub3V0cHV0LnN1YmFycmF5KDAsci5uZXh0X291dCkpLGk9TGUuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQoaSksdGhpcy5lbmRlZD0hMCxpPT09WGU7aWYoMCE9PXIuYXZhaWxfb3V0KXtpZihhPjAmJnIubmV4dF9vdXQ+MCl0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2UgaWYoMD09PXIuYXZhaWxfaW4pYnJlYWt9ZWxzZSB0aGlzLm9uRGF0YShyLm91dHB1dCl9cmV0dXJuITB9LFZlLnByb3RvdHlwZS5vbkRhdGE9ZnVuY3Rpb24odCl7dGhpcy5jaHVua3MucHVzaCh0KX0sVmUucHJvdG90eXBlLm9uRW5kPWZ1bmN0aW9uKHQpe3Q9PT1YZSYmKHRoaXMucmVzdWx0PU9lLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9O3ZhciBlcj1WZSxycj1KZSxucj1RZSxpcj10cixhcj1wdCxzcj17RGVmbGF0ZTplcixkZWZsYXRlOnJyLGRlZmxhdGVSYXc6bnIsZ3ppcDppcixjb25zdGFudHM6YXJ9O3QuRGVmbGF0ZT1lcix0LmNvbnN0YW50cz1hcix0LmRlZmF1bHQ9c3IsdC5kZWZsYXRlPXJyLHQuZGVmbGF0ZVJhdz1ucix0Lmd6aXA9aXIsT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pfSkoZS5leHBvcnRzKTt2YXIgcixuPXtleHBvcnRzOnt9fSxpPXtleHBvcnRzOnt9fTtpLmV4cG9ydHM9KHI9cnx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5jcnlwdG8mJihuPWdsb2JhbFRoaXMuY3J5cHRvKSwhbiYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5tc0NyeXB0byYmKG49d2luZG93Lm1zQ3J5cHRvKSwhbiYmdm9pZCAwIT09dCYmdC5jcnlwdG8mJihuPXQuY3J5cHRvKSwhbil0cnl7bj1yZXF1aXJlKCJjcnlwdG8iKX1jYXRjaCh0KXt9dmFyIGk9ZnVuY3Rpb24oKXtpZihuKXtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5nZXRSYW5kb21WYWx1ZXMpdHJ5e3JldHVybiBuLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdfWNhdGNoKHQpe31pZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5yYW5kb21CeXRlcyl0cnl7cmV0dXJuIG4ucmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKX1jYXRjaCh0KXt9fXRocm93IG5ldyBFcnJvcigiTmF0aXZlIGNyeXB0byBtb2R1bGUgY291bGQgbm90IGJlIHVzZWQgdG8gZ2V0IHNlY3VyZSByYW5kb20gbnVtYmVyLiIpfSxhPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPWUscj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLHM9e30sbz1zLmxpYj17fSxoPW8uQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBlPWEodGhpcyk7cmV0dXJuIHQmJmUubWl4SW4odCksZS5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1lLmluaXR8fChlLmluaXQ9ZnVuY3Rpb24oKXtlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGUuaW5pdC5wcm90b3R5cGU9ZSxlLiRzdXBlcj10aGlzLGV9LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShlKSYmKHRoaXNbZV09dFtlXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0sbD1vLldvcmRBcnJheT1oLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPWUhPXI/ZTo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dSkuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKyspe3ZhciBzPXJbYT4+PjJdPj4+MjQtYSU0KjgmMjU1O2VbbithPj4+Ml18PXM8PDI0LShuK2EpJTQqOH1lbHNlIGZvcih2YXIgbz0wO288aTtvKz00KWVbbitvPj4+Ml09cltvPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPWksdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlczt0W3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0KjgsdC5sZW5ndGg9ZS5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxyPTA7cjx0O3IrPTQpZS5wdXNoKGkoKSk7cmV0dXJuIG5ldyBsLmluaXQoZSx0KX19KSxjPXMuZW5jPXt9LHU9Yy5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgbC5pbml0KHIsZS8yKX19LGQ9Yy5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKylyW24+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGwuaW5pdChyLGUpfX0sXz1jLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoZC5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gZC5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LGY9by5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWguZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IGwuaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1fLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbih0KXt2YXIgcixuPXRoaXMuX2RhdGEsaT1uLndvcmRzLGE9bi5zaWdCeXRlcyxzPXRoaXMuYmxvY2tTaXplLG89YS8oNCpzKSxoPShvPXQ/ZS5jZWlsKG8pOmUubWF4KCgwfG8pLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKnMsYz1lLm1pbig0KmgsYSk7aWYoaCl7Zm9yKHZhciB1PTA7dTxoO3UrPXMpdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSx1KTtyPWkuc3BsaWNlKDAsaCksbi5zaWdCeXRlcy09Y31yZXR1cm4gbmV3IGwuaW5pdChyLGMpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWguY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH0sX21pbkJ1ZmZlclNpemU6MH0pO28uSGFzaGVyPWYuZXh0ZW5kKHtjZmc6aC5leHRlbmQoKSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7Zi5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxibG9ja1NpemU6MTYsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHQuaW5pdChyKS5maW5hbGl6ZShlKX19LF9jcmVhdGVIbWFjSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgcC5ITUFDLmluaXQodCxyKS5maW5hbGl6ZShlKX19fSk7dmFyIHA9cy5hbGdvPXt9O3JldHVybiBzfShNYXRoKSxyKSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuV29yZEFycmF5O2Z1bmN0aW9uIG4odCxlLG4pe2Zvcih2YXIgaT1bXSxhPTAscz0wO3M8ZTtzKyspaWYocyU0KXt2YXIgbz1uW3QuY2hhckNvZGVBdChzLTEpXTw8cyU0KjJ8blt0LmNoYXJDb2RlQXQocyldPj4+Ni1zJTQqMjtpW2E+Pj4yXXw9bzw8MjQtYSU0KjgsYSsrfXJldHVybiByLmNyZWF0ZShpLGEpfWUuZW5jLkJhc2U2ND17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49dGhpcy5fbWFwO3QuY2xhbXAoKTtmb3IodmFyIGk9W10sYT0wO2E8cjthKz0zKWZvcih2YXIgcz0oZVthPj4+Ml0+Pj4yNC1hJTQqOCYyNTUpPDwxNnwoZVthKzE+Pj4yXT4+PjI0LShhKzEpJTQqOCYyNTUpPDw4fGVbYSsyPj4+Ml0+Pj4yNC0oYSsyKSU0KjgmMjU1LG89MDtvPDQmJmErLjc1Km88cjtvKyspaS5wdXNoKG4uY2hhckF0KHM+Pj42KigzLW8pJjYzKSk7dmFyIGg9bi5jaGFyQXQoNjQpO2lmKGgpZm9yKDtpLmxlbmd0aCU0OylpLnB1c2goaCk7cmV0dXJuIGkuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBlPXQubGVuZ3RoLHI9dGhpcy5fbWFwLGk9dGhpcy5fcmV2ZXJzZU1hcDtpZighaSl7aT10aGlzLl9yZXZlcnNlTWFwPVtdO2Zvcih2YXIgYT0wO2E8ci5sZW5ndGg7YSsrKWlbci5jaGFyQ29kZUF0KGEpXT1hfXZhciBzPXIuY2hhckF0KDY0KTtpZihzKXt2YXIgbz10LmluZGV4T2Yocyk7LTEhPT1vJiYoZT1vKX1yZXR1cm4gbih0LGUsaSl9LF9tYXA6IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89In19KCksdC5lbmMuQmFzZTY0fShpLmV4cG9ydHMpfShuKTt2YXIgYT1uLmV4cG9ydHMscz17ZXhwb3J0czp7fX0sbz17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLHM9ci5hbGdvLG89W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PTA7dDw2NDt0Kyspb1t0XT00Mjk0OTY3Mjk2KmUuYWJzKGUuc2luKHQrMSkpfDB9KCk7dmFyIGg9cy5NRDU9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTA7cjwxNjtyKyspe3ZhciBuPWUrcixpPXRbbl07dFtuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgYT10aGlzLl9oYXNoLndvcmRzLHM9dFtlKzBdLGg9dFtlKzFdLF89dFtlKzJdLGY9dFtlKzNdLHA9dFtlKzRdLGc9dFtlKzVdLHk9dFtlKzZdLHY9dFtlKzddLHc9dFtlKzhdLG09dFtlKzldLGI9dFtlKzEwXSx4PXRbZSsxMV0saz10W2UrMTJdLHo9dFtlKzEzXSxBPXRbZSsxNF0sRT10W2UrMTVdLFM9YVswXSxCPWFbMV0sUj1hWzJdLEQ9YVszXTtTPWwoUyxCLFIsRCxzLDcsb1swXSksRD1sKEQsUyxCLFIsaCwxMixvWzFdKSxSPWwoUixELFMsQixfLDE3LG9bMl0pLEI9bChCLFIsRCxTLGYsMjIsb1szXSksUz1sKFMsQixSLEQscCw3LG9bNF0pLEQ9bChELFMsQixSLGcsMTIsb1s1XSksUj1sKFIsRCxTLEIseSwxNyxvWzZdKSxCPWwoQixSLEQsUyx2LDIyLG9bN10pLFM9bChTLEIsUixELHcsNyxvWzhdKSxEPWwoRCxTLEIsUixtLDEyLG9bOV0pLFI9bChSLEQsUyxCLGIsMTcsb1sxMF0pLEI9bChCLFIsRCxTLHgsMjIsb1sxMV0pLFM9bChTLEIsUixELGssNyxvWzEyXSksRD1sKEQsUyxCLFIseiwxMixvWzEzXSksUj1sKFIsRCxTLEIsQSwxNyxvWzE0XSksUz1jKFMsQj1sKEIsUixELFMsRSwyMixvWzE1XSksUixELGgsNSxvWzE2XSksRD1jKEQsUyxCLFIseSw5LG9bMTddKSxSPWMoUixELFMsQix4LDE0LG9bMThdKSxCPWMoQixSLEQsUyxzLDIwLG9bMTldKSxTPWMoUyxCLFIsRCxnLDUsb1syMF0pLEQ9YyhELFMsQixSLGIsOSxvWzIxXSksUj1jKFIsRCxTLEIsRSwxNCxvWzIyXSksQj1jKEIsUixELFMscCwyMCxvWzIzXSksUz1jKFMsQixSLEQsbSw1LG9bMjRdKSxEPWMoRCxTLEIsUixBLDksb1syNV0pLFI9YyhSLEQsUyxCLGYsMTQsb1syNl0pLEI9YyhCLFIsRCxTLHcsMjAsb1syN10pLFM9YyhTLEIsUixELHosNSxvWzI4XSksRD1jKEQsUyxCLFIsXyw5LG9bMjldKSxSPWMoUixELFMsQix2LDE0LG9bMzBdKSxTPXUoUyxCPWMoQixSLEQsUyxrLDIwLG9bMzFdKSxSLEQsZyw0LG9bMzJdKSxEPXUoRCxTLEIsUix3LDExLG9bMzNdKSxSPXUoUixELFMsQix4LDE2LG9bMzRdKSxCPXUoQixSLEQsUyxBLDIzLG9bMzVdKSxTPXUoUyxCLFIsRCxoLDQsb1szNl0pLEQ9dShELFMsQixSLHAsMTEsb1szN10pLFI9dShSLEQsUyxCLHYsMTYsb1szOF0pLEI9dShCLFIsRCxTLGIsMjMsb1szOV0pLFM9dShTLEIsUixELHosNCxvWzQwXSksRD11KEQsUyxCLFIscywxMSxvWzQxXSksUj11KFIsRCxTLEIsZiwxNixvWzQyXSksQj11KEIsUixELFMseSwyMyxvWzQzXSksUz11KFMsQixSLEQsbSw0LG9bNDRdKSxEPXUoRCxTLEIsUixrLDExLG9bNDVdKSxSPXUoUixELFMsQixFLDE2LG9bNDZdKSxTPWQoUyxCPXUoQixSLEQsUyxfLDIzLG9bNDddKSxSLEQscyw2LG9bNDhdKSxEPWQoRCxTLEIsUix2LDEwLG9bNDldKSxSPWQoUixELFMsQixBLDE1LG9bNTBdKSxCPWQoQixSLEQsUyxnLDIxLG9bNTFdKSxTPWQoUyxCLFIsRCxrLDYsb1s1Ml0pLEQ9ZChELFMsQixSLGYsMTAsb1s1M10pLFI9ZChSLEQsUyxCLGIsMTUsb1s1NF0pLEI9ZChCLFIsRCxTLGgsMjEsb1s1NV0pLFM9ZChTLEIsUixELHcsNixvWzU2XSksRD1kKEQsUyxCLFIsRSwxMCxvWzU3XSksUj1kKFIsRCxTLEIseSwxNSxvWzU4XSksQj1kKEIsUixELFMseiwyMSxvWzU5XSksUz1kKFMsQixSLEQscCw2LG9bNjBdKSxEPWQoRCxTLEIsUix4LDEwLG9bNjFdKSxSPWQoUixELFMsQixfLDE1LG9bNjJdKSxCPWQoQixSLEQsUyxtLDIxLG9bNjNdKSxhWzBdPWFbMF0rU3wwLGFbMV09YVsxXStCfDAsYVsyXT1hWzJdK1J8MCxhWzNdPWFbM10rRHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JbaT4+PjVdfD0xMjg8PDI0LWklMzI7dmFyIGE9ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLHM9bjtyWzE1KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpLHJbMTQrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKHM8PDh8cz4+PjI0KXw0Mjc4MjU1MzYwJihzPDwyNHxzPj4+OCksdC5zaWdCeXRlcz00KihyLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBvPXRoaXMuX2hhc2gsaD1vLndvcmRzLGw9MDtsPDQ7bCsrKXt2YXIgYz1oW2xdO2hbbF09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIG99LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2Z1bmN0aW9uIGwodCxlLHIsbixpLGEscyl7dmFyIG89dCsoZSZyfH5lJm4pK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1mdW5jdGlvbiBjKHQsZSxyLG4saSxhLHMpe3ZhciBvPXQrKGUmbnxyJn5uKStpK3M7cmV0dXJuKG88PGF8bz4+PjMyLWEpK2V9ZnVuY3Rpb24gdSh0LGUscixuLGksYSxzKXt2YXIgbz10KyhlXnJebikraStzO3JldHVybihvPDxhfG8+Pj4zMi1hKStlfWZ1bmN0aW9uIGQodCxlLHIsbixpLGEscyl7dmFyIG89dCsocl4oZXx+bikpK2krcztyZXR1cm4obzw8YXxvPj4+MzItYSkrZX1yLk1ENT1hLl9jcmVhdGVIZWxwZXIoaCksci5IbWFjTUQ1PWEuX2NyZWF0ZUhtYWNIZWxwZXIoaCl9KE1hdGgpLHQuTUQ1fShpLmV4cG9ydHMpfShvKTt2YXIgaD17ZXhwb3J0czp7fX0sbD17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuV29yZEFycmF5LGk9ci5IYXNoZXIsYT1lLmFsZ28scz1bXSxvPWEuU0hBMT1pLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBuLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OCwzMjg1Mzc3NTIwXSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj10aGlzLl9oYXNoLndvcmRzLG49clswXSxpPXJbMV0sYT1yWzJdLG89clszXSxoPXJbNF0sbD0wO2w8ODA7bCsrKXtpZihsPDE2KXNbbF09MHx0W2UrbF07ZWxzZXt2YXIgYz1zW2wtM11ec1tsLThdXnNbbC0xNF1ec1tsLTE2XTtzW2xdPWM8PDF8Yz4+PjMxfXZhciB1PShuPDw1fG4+Pj4yNykraCtzW2xdO3UrPWw8MjA/MTUxODUwMDI0OSsoaSZhfH5pJm8pOmw8NDA/MTg1OTc3NTM5MysoaV5hXm8pOmw8NjA/KGkmYXxpJm98YSZvKS0xODk0MDA3NTg4OihpXmFebyktODk5NDk3NTE0LGg9byxvPWEsYT1pPDwzMHxpPj4+MixpPW4sbj11fXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStvfDAscls0XT1yWzRdK2h8MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLGU9dC53b3JkcyxyPTgqdGhpcy5fbkRhdGFCeXRlcyxuPTgqdC5zaWdCeXRlcztyZXR1cm4gZVtuPj4+NV18PTEyODw8MjQtbiUzMixlWzE0KyhuKzY0Pj4+OTw8NCldPU1hdGguZmxvb3Ioci80Mjk0OTY3Mjk2KSxlWzE1KyhuKzY0Pj4+OTw8NCldPXIsdC5zaWdCeXRlcz00KmUubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWkuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtlLlNIQTE9aS5fY3JlYXRlSGVscGVyKG8pLGUuSG1hY1NIQTE9aS5fY3JlYXRlSG1hY0hlbHBlcihvKX0oKSx0LlNIQTF9KGkuZXhwb3J0cyl9KGwpO3ZhciBjPXtleHBvcnRzOnt9fTshZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIGUscixuO3I9KGU9dCkubGliLkJhc2Usbj1lLmVuYy5VdGY4LGUuYWxnby5ITUFDPXIuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLl9oYXNoZXI9bmV3IHQuaW5pdCwic3RyaW5nIj09dHlwZW9mIGUmJihlPW4ucGFyc2UoZSkpO3ZhciByPXQuYmxvY2tTaXplLGk9NCpyO2Uuc2lnQnl0ZXM+aSYmKGU9dC5maW5hbGl6ZShlKSksZS5jbGFtcCgpO2Zvcih2YXIgYT10aGlzLl9vS2V5PWUuY2xvbmUoKSxzPXRoaXMuX2lLZXk9ZS5jbG9uZSgpLG89YS53b3JkcyxoPXMud29yZHMsbD0wO2w8cjtsKyspb1tsXV49MTU0OTU1NjgyOCxoW2xdXj05MDk1MjI0ODY7YS5zaWdCeXRlcz1zLnNpZ0J5dGVzPWksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2hhc2hlcjt0LnJlc2V0KCksdC51cGRhdGUodGhpcy5faUtleSl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9oYXNoZXIscj1lLmZpbmFsaXplKHQpO3JldHVybiBlLnJlc2V0KCksZS5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19KX0oaS5leHBvcnRzKX0oYyksZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5CYXNlLGk9ci5Xb3JkQXJyYXksYT1lLmFsZ28scz1hLk1ENSxvPWEuRXZwS0RGPW4uZXh0ZW5kKHtjZmc6bi5leHRlbmQoe2tleVNpemU6NCxoYXNoZXI6cyxpdGVyYXRpb25zOjF9KSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KX0sY29tcHV0ZTpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcixuPXRoaXMuY2ZnLGE9bi5oYXNoZXIuY3JlYXRlKCkscz1pLmNyZWF0ZSgpLG89cy53b3JkcyxoPW4ua2V5U2l6ZSxsPW4uaXRlcmF0aW9ucztvLmxlbmd0aDxoOyl7ciYmYS51cGRhdGUocikscj1hLnVwZGF0ZSh0KS5maW5hbGl6ZShlKSxhLnJlc2V0KCk7Zm9yKHZhciBjPTE7YzxsO2MrKylyPWEuZmluYWxpemUociksYS5yZXNldCgpO3MuY29uY2F0KHIpfXJldHVybiBzLnNpZ0J5dGVzPTQqaCxzfX0pO2UuRXZwS0RGPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gby5jcmVhdGUocikuY29tcHV0ZSh0LGUpfX0oKSx0LkV2cEtERn0oaS5leHBvcnRzKX0oaCk7dmFyIHU9e2V4cG9ydHM6e319OyFmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt0LmxpYi5DaXBoZXJ8fGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uQmFzZSxhPW4uV29yZEFycmF5LHM9bi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtLG89ci5lbmM7by5VdGY4O3ZhciBoPW8uQmFzZTY0LGw9ci5hbGdvLkV2cEtERixjPW4uQ2lwaGVyPXMuZXh0ZW5kKHtjZmc6aS5leHRlbmQoKSxjcmVhdGVFbmNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fRU5DX1hGT1JNX01PREUsdCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlLHIpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZChyKSx0aGlzLl94Zm9ybU1vZGU9dCx0aGlzLl9rZXk9ZSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7cy5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0scHJvY2VzczpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKX0sZmluYWxpemU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9LGtleVNpemU6NCxpdlNpemU6NCxfRU5DX1hGT1JNX01PREU6MSxfREVDX1hGT1JNX01PREU6MixfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/dzp5fXJldHVybiBmdW5jdGlvbihlKXtyZXR1cm57ZW5jcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZW5jcnlwdChlLHIsbixpKX0sZGVjcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZGVjcnlwdChlLHIsbixpKX19fX0oKX0pO24uU3RyZWFtQ2lwaGVyPWMuZXh0ZW5kKHtfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wcm9jZXNzKCEwKX0sYmxvY2tTaXplOjF9KTt2YXIgdT1yLm1vZGU9e30sZD1uLkJsb2NrQ2lwaGVyTW9kZT1pLmV4dGVuZCh7Y3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZSh0LGUpfSxjcmVhdGVEZWNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlKXt0aGlzLl9jaXBoZXI9dCx0aGlzLl9pdj1lfX0pLF89dS5DQkM9ZnVuY3Rpb24oKXt2YXIgdD1kLmV4dGVuZCgpO2Z1bmN0aW9uIHIodCxyLG4pe3ZhciBpLGE9dGhpcy5faXY7YT8oaT1hLHRoaXMuX2l2PWUpOmk9dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgcz0wO3M8bjtzKyspdFtyK3NdXj1pW3NdfXJldHVybiB0LkVuY3J5cHRvcj10LmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemU7ci5jYWxsKHRoaXMsdCxlLGkpLG4uZW5jcnlwdEJsb2NrKHQsZSksdGhpcy5fcHJldkJsb2NrPXQuc2xpY2UoZSxlK2kpfX0pLHQuRGVjcnlwdG9yPXQuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZSxhPXQuc2xpY2UoZSxlK2kpO24uZGVjcnlwdEJsb2NrKHQsZSksci5jYWxsKHRoaXMsdCxlLGkpLHRoaXMuX3ByZXZCbG9jaz1hfX0pLHR9KCksZj0oci5wYWQ9e30pLlBrY3M3PXtwYWQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9NCplLG49ci10LnNpZ0J5dGVzJXIsaT1uPDwyNHxuPDwxNnxuPDw4fG4scz1bXSxvPTA7bzxuO28rPTQpcy5wdXNoKGkpO3ZhciBoPWEuY3JlYXRlKHMsbik7dC5jb25jYXQoaCl9LHVucGFkOmZ1bmN0aW9uKHQpe3ZhciBlPTI1NSZ0LndvcmRzW3Quc2lnQnl0ZXMtMT4+PjJdO3Quc2lnQnl0ZXMtPWV9fTtuLkJsb2NrQ2lwaGVyPWMuZXh0ZW5kKHtjZmc6Yy5jZmcuZXh0ZW5kKHttb2RlOl8scGFkZGluZzpmfSkscmVzZXQ6ZnVuY3Rpb24oKXt2YXIgdDtjLnJlc2V0LmNhbGwodGhpcyk7dmFyIGU9dGhpcy5jZmcscj1lLml2LG49ZS5tb2RlO3RoaXMuX3hmb3JtTW9kZT09dGhpcy5fRU5DX1hGT1JNX01PREU/dD1uLmNyZWF0ZUVuY3J5cHRvcjoodD1uLmNyZWF0ZURlY3J5cHRvcix0aGlzLl9taW5CdWZmZXJTaXplPTEpLHRoaXMuX21vZGUmJnRoaXMuX21vZGUuX19jcmVhdG9yPT10P3RoaXMuX21vZGUuaW5pdCh0aGlzLHImJnIud29yZHMpOih0aGlzLl9tb2RlPXQuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9dCl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX21vZGUucHJvY2Vzc0Jsb2NrKHQsZSl9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFPyhlLnBhZCh0aGlzLl9kYXRhLHRoaXMuYmxvY2tTaXplKSx0PXRoaXMuX3Byb2Nlc3MoITApKToodD10aGlzLl9wcm9jZXNzKCEwKSxlLnVucGFkKHQpKSx0fSxibG9ja1NpemU6NH0pO3ZhciBwPW4uQ2lwaGVyUGFyYW1zPWkuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQpe3RoaXMubWl4SW4odCl9LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybih0fHx0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpfX0pLGc9KHIuZm9ybWF0PXt9KS5PcGVuU1NMPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dmFyIGU9dC5jaXBoZXJ0ZXh0LHI9dC5zYWx0O3JldHVybihyP2EuY3JlYXRlKFsxMzk4ODkzNjg0LDE3MDEwNzY4MzFdKS5jb25jYXQocikuY29uY2F0KGUpOmUpLnRvU3RyaW5nKGgpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZSxyPWgucGFyc2UodCksbj1yLndvcmRzO3JldHVybiAxMzk4ODkzNjg0PT1uWzBdJiYxNzAxMDc2ODMxPT1uWzFdJiYoZT1hLmNyZWF0ZShuLnNsaWNlKDIsNCkpLG4uc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLHAuY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDplfSl9fSx5PW4uU2VyaWFsaXphYmxlQ2lwaGVyPWkuZXh0ZW5kKHtjZmc6aS5leHRlbmQoe2Zvcm1hdDpnfSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKTt2YXIgaT10LmNyZWF0ZUVuY3J5cHRvcihyLG4pLGE9aS5maW5hbGl6ZShlKSxzPWkuY2ZnO3JldHVybiBwLmNyZWF0ZSh7Y2lwaGVydGV4dDphLGtleTpyLGl2OnMuaXYsYWxnb3JpdGhtOnQsbW9kZTpzLm1vZGUscGFkZGluZzpzLnBhZGRpbmcsYmxvY2tTaXplOnQuYmxvY2tTaXplLGZvcm1hdHRlcjpuLmZvcm1hdH0pfSxkZWNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3JldHVybiBuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpLHQuY3JlYXRlRGVjcnlwdG9yKHIsbikuZmluYWxpemUoZS5jaXBoZXJ0ZXh0KX0sX3BhcnNlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UucGFyc2UodCx0aGlzKTp0fX0pLHY9KHIua2RmPXt9KS5PcGVuU1NMPXtleGVjdXRlOmZ1bmN0aW9uKHQsZSxyLG4pe258fChuPWEucmFuZG9tKDgpKTt2YXIgaT1sLmNyZWF0ZSh7a2V5U2l6ZTplK3J9KS5jb21wdXRlKHQsbikscz1hLmNyZWF0ZShpLndvcmRzLnNsaWNlKGUpLDQqcik7cmV0dXJuIGkuc2lnQnl0ZXM9NCplLHAuY3JlYXRlKHtrZXk6aSxpdjpzLHNhbHQ6bn0pfX0sdz1uLlBhc3N3b3JkQmFzZWRDaXBoZXI9eS5leHRlbmQoe2NmZzp5LmNmZy5leHRlbmQoe2tkZjp2fSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXt2YXIgaT0obj10aGlzLmNmZy5leHRlbmQobikpLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplKTtuLml2PWkuaXY7dmFyIGE9eS5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIGEubWl4SW4oaSksYX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0KTtyZXR1cm4gbi5pdj1pLml2LHkuZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpfShpLmV4cG9ydHMpfSh1KSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxhPVtdLHM9W10sbz1bXSxoPVtdLGw9W10sYz1bXSx1PVtdLGQ9W10sXz1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBmPW5ebjw8MV5uPDwyXm48PDNebjw8NDtmPWY+Pj44XjI1NSZmXjk5LGlbcl09ZixhW2ZdPXI7dmFyIHA9dFtyXSxnPXRbcF0seT10W2ddLHY9MjU3KnRbZl1eMTY4NDMwMDgqZjtzW3JdPXY8PDI0fHY+Pj44LG9bcl09djw8MTZ8dj4+PjE2LGhbcl09djw8OHx2Pj4+MjQsbFtyXT12LHY9MTY4NDMwMDkqeV42NTUzNypnXjI1NypwXjE2ODQzMDA4KnIsY1tmXT12PDwyNHx2Pj4+OCx1W2ZdPXY8PDE2fHY+Pj4xNixkW2ZdPXY8PDh8dj4+PjI0LF9bZl09dixyPyhyPXBedFt0W3RbeV5wXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgZj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0scD1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksYT10aGlzLl9rZXlTY2hlZHVsZT1bXSxzPTA7czxuO3MrKylzPHI/YVtzXT1lW3NdOihsPWFbcy0xXSxzJXI/cj42JiZzJXI9PTQmJihsPWlbbD4+PjI0XTw8MjR8aVtsPj4+MTYmMjU1XTw8MTZ8aVtsPj4+OCYyNTVdPDw4fGlbMjU1JmxdKToobD1pWyhsPWw8PDh8bD4+PjI0KT4+PjI0XTw8MjR8aVtsPj4+MTYmMjU1XTw8MTZ8aVtsPj4+OCYyNTVdPDw4fGlbMjU1JmxdLGxePWZbcy9yfDBdPDwyNCksYVtzXT1hW3Mtcl1ebCk7Zm9yKHZhciBvPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGg9MDtoPG47aCsrKXtpZihzPW4taCxoJTQpdmFyIGw9YVtzXTtlbHNlIGw9YVtzLTRdO29baF09aDw0fHxzPD00P2w6Y1tpW2w+Pj4yNF1dXnVbaVtsPj4+MTYmMjU1XV1eZFtpW2w+Pj44JjI1NV1dXl9baVsyNTUmbF1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUscyxvLGgsbCxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxjLHUsZCxfLGEpLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLGEscyxvKXtmb3IodmFyIGg9dGhpcy5fblJvdW5kcyxsPXRbZV1eclswXSxjPXRbZSsxXV5yWzFdLHU9dFtlKzJdXnJbMl0sZD10W2UrM11eclszXSxfPTQsZj0xO2Y8aDtmKyspe3ZhciBwPW5bbD4+PjI0XV5pW2M+Pj4xNiYyNTVdXmFbdT4+PjgmMjU1XV5zWzI1NSZkXV5yW18rK10sZz1uW2M+Pj4yNF1eaVt1Pj4+MTYmMjU1XV5hW2Q+Pj44JjI1NV1ec1syNTUmbF1ecltfKytdLHk9blt1Pj4+MjRdXmlbZD4+PjE2JjI1NV1eYVtsPj4+OCYyNTVdXnNbMjU1JmNdXnJbXysrXSx2PW5bZD4+PjI0XV5pW2w+Pj4xNiYyNTVdXmFbYz4+PjgmMjU1XV5zWzI1NSZ1XV5yW18rK107bD1wLGM9Zyx1PXksZD12fXA9KG9bbD4+PjI0XTw8MjR8b1tjPj4+MTYmMjU1XTw8MTZ8b1t1Pj4+OCYyNTVdPDw4fG9bMjU1JmRdKV5yW18rK10sZz0ob1tjPj4+MjRdPDwyNHxvW3U+Pj4xNiYyNTVdPDwxNnxvW2Q+Pj44JjI1NV08PDh8b1syNTUmbF0pXnJbXysrXSx5PShvW3U+Pj4yNF08PDI0fG9bZD4+PjE2JjI1NV08PDE2fG9bbD4+PjgmMjU1XTw8OHxvWzI1NSZjXSlecltfKytdLHY9KG9bZD4+PjI0XTw8MjR8b1tsPj4+MTYmMjU1XTw8MTZ8b1tjPj4+OCYyNTVdPDw4fG9bMjU1JnVdKV5yW18rK10sdFtlXT1wLHRbZSsxXT1nLHRbZSsyXT15LHRbZSszXT12fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIocCl9KCksdC5BRVN9KGkuZXhwb3J0cyl9KHMpO3ZhciBkPXMuZXhwb3J0cyxfPXtleHBvcnRzOnt9fTshZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LGE9bi5IYXNoZXIscz1yLmFsZ28sbz1bXSxoPVtdOyFmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByPWUuc3FydCh0KSxuPTI7bjw9cjtuKyspaWYoISh0JW4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIHIodCl7cmV0dXJuIDQyOTQ5NjcyOTYqKHQtKDB8dCkpfDB9Zm9yKHZhciBuPTIsaT0wO2k8NjQ7KXQobikmJihpPDgmJihvW2ldPXIoZS5wb3cobiwuNSkpKSxoW2ldPXIoZS5wb3cobiwxLzMpKSxpKyspLG4rK30oKTt2YXIgbD1bXSxjPXMuU0hBMjU2PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChvLnNsaWNlKDApKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0scz1yWzNdLG89cls0XSxjPXJbNV0sdT1yWzZdLGQ9cls3XSxfPTA7Xzw2NDtfKyspe2lmKF88MTYpbFtfXT0wfHRbZStfXTtlbHNle3ZhciBmPWxbXy0xNV0scD0oZjw8MjV8Zj4+PjcpXihmPDwxNHxmPj4+MTgpXmY+Pj4zLGc9bFtfLTJdLHk9KGc8PDE1fGc+Pj4xNyleKGc8PDEzfGc+Pj4xOSleZz4+PjEwO2xbX109cCtsW18tN10reStsW18tMTZdfXZhciB2PW4maV5uJmFeaSZhLHc9KG48PDMwfG4+Pj4yKV4objw8MTl8bj4+PjEzKV4objw8MTB8bj4+PjIyKSxtPWQrKChvPDwyNnxvPj4+NileKG88PDIxfG8+Pj4xMSleKG88PDd8bz4+PjI1KSkrKG8mY15+byZ1KStoW19dK2xbX107ZD11LHU9YyxjPW8sbz1zK218MCxzPWEsYT1pLGk9bixuPW0rKHcrdil8MH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK2F8MCxyWzNdPXJbM10rc3wwLHJbNF09cls0XStvfDAscls1XT1yWzVdK2N8MCxyWzZdPXJbNl0rdXwwLHJbN109cls3XStkfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cmV0dXJuIHJbaT4+PjVdfD0xMjg8PDI0LWklMzIsclsxNCsoaSs2ND4+Pjk8PDQpXT1lLmZsb29yKG4vNDI5NDk2NzI5NiksclsxNSsoaSs2ND4+Pjk8PDQpXT1uLHQuc2lnQnl0ZXM9NCpyLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1hLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ci5TSEEyNTY9YS5fY3JlYXRlSGVscGVyKGMpLHIuSG1hY1NIQTI1Nj1hLl9jcmVhdGVIbWFjSGVscGVyKGMpfShNYXRoKSx0LlNIQTI1Nn0oaS5leHBvcnRzKX0oXyk7dmFyIGY9Xy5leHBvcnRzLHA9e2V4cG9ydHM6e319OyFmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIpe3ZhciBlPXQubGliLldvcmRBcnJheSxyPWUuaW5pdCxuPWUuaW5pdD1mdW5jdGlvbih0KXtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJih0PW5ldyBVaW50OEFycmF5KHQpKSwodCBpbnN0YW5jZW9mIEludDhBcnJheXx8InVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OENsYW1wZWRBcnJheSYmdCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgSW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHQ9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIGU9dC5ieXRlTGVuZ3RoLG49W10saT0wO2k8ZTtpKyspbltpPj4+Ml18PXRbaV08PDI0LWklNCo4O3IuY2FsbCh0aGlzLG4sZSl9ZWxzZSByLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07bi5wcm90b3R5cGU9ZX19KCksdC5saWIuV29yZEFycmF5fShpLmV4cG9ydHMpfShwKTt2YXIgZz1wLmV4cG9ydHMseT17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LkhtYWNTSEEyNTZ9KGkuZXhwb3J0cyl9KHkpO3ZhciB2PXkuZXhwb3J0cztsZXQgdyxtLGI7e2I9cmVxdWlyZSgiaHR0cHMiKTtjb25zdHtwYXJlbnRQb3J0OnR9PXJlcXVpcmUoIndvcmtlcl90aHJlYWRzIik7dC5vbigibWVzc2FnZSIsKHQ9PmZ1bmN0aW9uKHQpe2NvbnN0e2pvYjpyLGNtZDpuLHNlcnZlcjppLHBhdGg6cyxidWZmZXI6byxrZXlCYXNlNjQ6aCxnemlwOmwscmVmZXJyZXI6YyxpZDp1LGFwcElkOl8scGVyc2lzdGVudElkOnAsQ1JPUVVFVF9WRVJTSU9OOnksZGVidWc6Yix3aGF0Onh9PXQuZGF0YTtpZigidXBsb2FkRW5jcnlwdGVkIj09PW4pUyhzKTtlbHNlIGNvbnNvbGUuZXJyb3IoIlVua25vd24gd29ya2VyIGNvbW1hbmQiLG4pO2Z1bmN0aW9uIGsodCl7Y29uc3QgZT1EYXRlLm5vdygpLHI9Zy5jcmVhdGUodCksbj1hLnBhcnNlKGgpLGk9dihyLG4pLHM9Zy5yYW5kb20oMTYpLHtjaXBoZXJ0ZXh0Om99PWQuZW5jcnlwdChyLG4se2l2OnN9KSxsPW5ldyBBcnJheUJ1ZmZlcig0K3Muc2lnQnl0ZXMraS5zaWdCeXRlcytvLnNpZ0J5dGVzKSxjPW5ldyBEYXRhVmlldyhsKTtsZXQgXz0wO2Muc2V0VWludDMyKF8sMTEyOTQ2ODIwOSwhMSksXys9NDtmb3IoY29uc3QgdCBvZltzLGksb10pZm9yKGNvbnN0IGUgb2YgdC53b3JkcyljLnNldEludDMyKF8sZSwhMSksXys9NDtyZXR1cm4gYiYmY29uc29sZS5sb2coYCR7dX0gJHt4fSBlbmNyeXB0ZWQgKCR7bC5ieXRlTGVuZ3RofSBieXRlcykgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSxsfWZ1bmN0aW9uIHoodCl7Y29uc3Qgcj1EYXRlLm5vdygpLG49ZS5leHBvcnRzLmRlZmxhdGUodCx7Z3ppcDohMCxsZXZlbDoxfSk7cmV0dXJuIGImJmNvbnNvbGUubG9nKGAke3V9ICR7eH0gY29tcHJlc3NlZCAoJHtuLmxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1yfW1zYCksbn1mdW5jdGlvbiBBKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPWYoZy5jcmVhdGUodCkpLG49YS5zdHJpbmdpZnkocikucmVwbGFjZSgvPS9nLCIiKS5yZXBsYWNlKC9cKy9nLCItIikucmVwbGFjZSgvXC8vZywiXyIpO3JldHVybiBiJiZjb25zb2xlLmxvZyhgJHt1fSAke3h9IGhhc2hlZCAoJHt0Lmxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCksbn1hc3luYyBmdW5jdGlvbiBFKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPWAke2kudXJsfS8ke3R9YDtpZighaS5hcGlLZXkpcmV0dXJue3VybDpyLHVwbG9hZFVybDpyfTtjb25zdCBuPWF3YWl0IHcocix7aGVhZGVyczp7IlgtQ3JvcXVldC1BdXRoIjppLmFwaUtleSwiWC1Dcm9xdWV0LUFwcCI6XywiWC1Dcm9xdWV0LUlkIjpwLCJYLUNyb3F1ZXQtU2Vzc2lvbiI6dSwiWC1Dcm9xdWV0LVZlcnNpb24iOnksIlgtQ3JvcXVldC1QYXRoIjpuZXcgVVJMKGMpLnBhdGhuYW1lfSxyZWZlcnJlcjpjfSkse29rOmEsc3RhdHVzOnMsc3RhdHVzVGV4dDpvfT1uO2lmKCFhKXRocm93IEVycm9yKGBFcnJvciBpbiBzaWduaW5nIFVSTDogJHtzfSAtICR7b31gKTtjb25zdHtlcnJvcjpoLHJlYWQ6bCx3cml0ZTpkfT1hd2FpdCBuLmpzb24oKTtpZihoKXRocm93IEVycm9yKGgpO3JldHVybiBiJiZjb25zb2xlLmxvZyhgJHt1fSAke3h9IGF1dGhvcml6ZWQgaW4gJHtEYXRlLm5vdygpLWV9bXNgKSx7dXJsOmwsdXBsb2FkVXJsOmR9fWFzeW5jIGZ1bmN0aW9uIFModCl7dHJ5e2xldCBlPWsobD96KG8pOm8pO2U9bmV3IFVpbnQ4QXJyYXkoZSksdC5pbmNsdWRlcygiJUhBU0glIikmJih0PXQucmVwbGFjZSgiJUhBU0glIixBKGUpKSk7Y29uc3R7dXBsb2FkVXJsOm4sdXJsOml9PWF3YWl0IEUodCksYT1EYXRlLm5vdygpLHtvazpzLHN0YXR1czpoLHN0YXR1c1RleHQ6ZH09YXdhaXQgdyhuLHttZXRob2Q6IlBVVCIsbW9kZToiY29ycyIsaGVhZGVyczp7IkNvbnRlbnQtVHlwZSI6ImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbSIsIlgtQ3JvcXVldC1BcHAiOl8sIlgtQ3JvcXVldC1JZCI6cCwiWC1Dcm9xdWV0LVNlc3Npb24iOnUsIlgtQ3JvcXVldC1WZXJzaW9uIjp5fSxyZWZlcnJlcjpjLGJvZHk6ZX0pO2lmKCFzKXRocm93IEVycm9yKGBzZXJ2ZXIgcmV0dXJuZWQgJHtofSAke2R9IGZvciBQVVQgJHtufWApO2ImJmNvbnNvbGUubG9nKGAke3V9ICR7eH0gdXBsb2FkZWQgKCR7aH0pIGluICR7RGF0ZS5ub3coKS1hfW1zICR7aX1gKSxtKHtqb2I6cix1cmw6aSxvazpzLHN0YXR1czpoLHN0YXR1c1RleHQ6ZH0pfWNhdGNoKHQpe2ImJmNvbnNvbGUubG9nKGAke3V9IHVwbG9hZCBlcnJvciAke3QubWVzc2FnZX1gKSxtKHtqb2I6cixvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDp0Lm1lc3NhZ2V9KX19fSh7ZGF0YTp0fSkpKSx3PWZ1bmN0aW9uKHQsZSl7cmV0dXJuIG5ldyBQcm9taXNlKCgocixuKT0+e2NvbnN0IGk9bmV3IFVSTCh0KSxhPXtob3N0bmFtZTppLmhvc3RuYW1lLHBvcnQ6NDQzLHBhdGg6aS5wYXRobmFtZStpLnNlYXJjaCxtZXRob2Q6ZS5tZXRob2R8fCJHRVQiLGhlYWRlcnM6ZS5oZWFkZXJzfSxzPWIucmVxdWVzdChhLCh0PT57bGV0IGU9IiI7dC5vbigiZGF0YSIsKHQ9PmUrPXQpKSx0Lm9uKCJlbmQiLCgoKT0+e2NvbnN0e3N0YXR1c0NvZGU6bixzdGF0dXNNZXNzYWdlOml9PXQsYT1uPj0yMDAmJm48MzAwLHM9e29rOmEsc3RhdHVzOm4sc3RhdHVzVGV4dDppfTthJiYocy5qc29uPSgpPT5KU09OLnBhcnNlKGUpKSxyKHMpfSkpfSkpO3Mub24oImVycm9yIiwodD0+e24odCl9KSksZS5ib2R5JiZzLndyaXRlKGUuYm9keSkscy5lbmQoKX0pKX0sbT1lPT50LnBvc3RNZXNzYWdlKHtkYXRhOmV9KX19KCk7Cgo=",void 0!==(zd=!1)&&zd),Ud=jd.indexOf("\n",10)+1,Od=jd.substring(Ud)+(Nd?"\/\/# sourceMappingURL="+Nd:""),function(e){return new Ed(Od,Object.assign({},e,{eval:!0}))});const Jd=P,Dd="node"===C;console.log("Croquet "+Jd);const Bd=!Dd;function Ad(e){const t=e.lastIndexOf(":"),r=-1===t?e:e.slice(t+1),s=-1===t?"":e.slice(0,t);let n=Y.backend||s;const i=Y.reflector&&Y.reflector.match(/^wss?:/);if("none"===n||i)return{apiKey:r,signServer:"none",reflector:"overridden"};if(!n&&!Dd)switch(window.location.hostname){case"croquet.dev":n="dev";break;case"staging.croquet.io":n="staging"}let o;switch(n){case"":case"prod":o="croquet.io";break;case"staging":o="staging.croquet.io";break;case"dev":o="croquet.dev";break;default:o=`${n}.croquet.dev`}return{apiKey:r,signServer:`https://api.${o}/sign`,reflector:`wss://api.${o}/reflector/v1`}}let $d=null;const qd=Y.nocheat,eh=[0];let th;const rh=new Qd;rh.onerror=e=>console.error(`UploadWorker error: ${e.message}`);let sh=0;const nh=new Set;function ih(e){for(const t of nh)if(t.id===e){const{appId:e,persistentId:r}=t.sessionSpec;return{appId:e,persistentId:r,uploadEncrypted:e=>t.uploadEncrypted(e),downloadEncrypted:e=>t.downloadEncrypted(e)}}return{}}class oh{constructor(){!function(){const e=Y.dev||!1!==Y.dev&&"localhost",t=Y.dev||!1!==Y.dev&&Bd;$d={messages:Y.has("debug","messages",!1),sends:Y.has("debug","sends",!1),ticks:Y.has("debug","ticks",!1),pong:Y.has("debug","pong",!1),snapshot:Y.has("debug","snapshot",!1),session:Y.has("debug","session",!1),initsnapshot:Y.has("debug","initsnapshot",e),reflector:Y.has("debug","reflector",t)}}(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new ah(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.timeline="",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,le.removeAllSubscriptionsFor(this.viewId),le.addSubscription(this.viewId,"__peers__",this.viewId,(e=>ne(`users now ${e.count}`)),"oncePerFrameWhileSynced"),this.leaving||oe.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){const{name:t,optionsFromUrl:r,password:s,appId:n,apiKey:i,viewIdDebugSuffix:o}=e,a=n?`${n}/${t}`:t;o&&(this.viewId=this.viewId.replace(/_.*$/,"")+"_"+encodeURIComponent((""+o).slice(0,16)).replace(/[^a-z0-9]/gi,(e=>`_${"%"===e?"":e.charCodeAt(0).toString(16).toUpperCase()}`)));const l={...e.options};if(r)for(const e of r)e in Y&&(l[e]=Y[e]);const c={};for(const t of["hashOverride"])t in Y?c[t]=Y[t]:t in e&&(c[t]=e[t]);this.key=Cn(s,"",{keySize:8});const d=await async function(e,t){return $(e+E(t))}(a,l),{developerId:h,token:u}=await this.verifyApiKey(i,n,d),{id:f,codeHash:p,computedCodeHash:m}=await async function(e,t,r,s){let n,i;const o=ee[e];let a="";o?(n=o.codeHashes,i=o.computedCodeHash,a=" (code hashing from cache)"):(n=await Promise.all(q),i=await $([s,...n].join("|")),ee[e]={codeHashes:n,computedCodeHash:i});const{hashOverride:l,...c}=r,d=l||i,h=await $(e+"|"+t+E(c)+d);if(D()&&!te.has(h)){B[i].what="Version ID",B[e].what="Persistent ID",B[h].what="Session ID",d!==i&&(n.push(i),B[i].what="Computed Version ID (replaced by overrideHash)",B[d]={what:"Version ID (as specified by overrideHash)"});const t=[...n,d,e,h].map((e=>({hash:e,...B[e]})));console.log(`Croquet: Debug Hashing for session ${h}${a}`,t),te.add(h)}return{id:h,persistentId:e,codeHash:d,computedCodeHash:i}}(d,h,c,Jd);this.tove=await this.encrypt(f),$d.session&&console.log(`Croquet session "${a}":\n        sessionId=${f}${n?`\n        persistentId=${d}`:""}\n        versionId=${p===m?p:`${p} (specified in hashOverride)\n        versionId=${m} (computed)`}\n        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:l,name:a,id:f,persistentId:d,developerId:h,token:u,codeHash:p,computedCodeHash:m};const{msPerTick:b,multiplier:y}=this.getTickAndMultiplier();this.msPerTick=b,this.tickMultiplier=y,this.setUpActivityChecks()}async establishSession(){const{id:e,persistentId:t,codeHash:r}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:r,created:(new Date).toISOString()}};const s=new Promise((e=>this.sessionSpec.sessionJoined=e));this.checkForConnection(!1),$d.session&&console.log(e,"waiting for SYNC"),await s}async verifyApiKey(e,t,r){const{signServer:s,apiKey:n}=Ad(e);if("none"===s)return{developerId:"unknown_dev_id"};try{const e=await Kd(`${s}/join?meta=login`,{method:"GET",mode:"cors",headers:{"X-Croquet-Auth":n,"X-Croquet-App":t,"X-Croquet-Id":r,"X-Croquet-Version":Jd,"X-Croquet-Path":new URL(oe.referrerURL()).pathname},referrer:oe.referrerURL(),referrerPolicy:"no-referrer-when-downgrade"}),{error:i,developerId:o,token:a}=await e.json();if(i)throw Error(i);return $d.session&&console.log("Croquet: verified API key"),{developerId:o,token:a}}catch(t){throw Error(`Croquet API key validation failed for "${e}": ${t.message}`)}}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){const e=this.vm.snapshot(),t=this.lastKnownTime(e),r=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:r,date:(new globalThis.CroquetViewDate).toISOString(),host:"localhost",sdk:Jd},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,r;try{e=Xn.begin("snapshot"),r=this.takeSnapshot()}catch(e){return ie("snapshot",e),null}finally{t=Xn.end("snapshot")-e}return $d.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)} ms`),r}scheduleSnapshot(){if(!this.connected||!this.vm||this.viewOnly)return;const e=this.vm.time,t=e-this.vm.lastSnapshotPoll;if(t<5e3)return void($d.snapshot&&console.log(`not requesting snapshot poll (${t}ms since poll scheduled)`));const r=new Ih(e,0,"_","handlePollForSnapshot",[]);this.sendTagged(r,{debounce:5e3,msgID:"pollForSnapshot"}),$d.snapshot&&console.log(this.id,"requesting snapshot poll via reflector")}handlePollForSnapshot(e){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const t=this.triggeringCpuTime||this.cpuTime;let r,s,n;this.triggeringCpuTime=null,this.cpuTime=0;try{r=Xn.begin("snapshot"),s={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(e){return void ie("snapshot",e)}finally{n=Xn.end("snapshot")-r,this.cpuTime-=n}$d.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(n)}ms`),Promise.resolve().then((()=>this.pollForSnapshot(e,s)))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),$d.snapshot&&console.log(this.id,"sending snapshot vote",t),this.sendTutti({time:e,topic:"snapshot",data:t,tallyTarget:["handleSnapshotVote"]})}handleSnapshotVote(e){if(!0!==this.synced)return void($d.snapshot&&console.log(this.id,"Ignoring snapshot vote during sync"));const{tally:t}=e;$d.snapshot&&console.log(this.id,"received snapshot votes",t);const{numberOfGroups:r,shouldUpload:s,dissidentFlag:n}=this.analyzeTally(t,"cpuTime");if(r>1&&console.error(this.id,`Session diverged! Snapshots fall into ${r} groups`),s){const e=this.takeSnapshotHandleErrors();e&&Promise.resolve().then((()=>this.uploadSnapshot(e,n)))}}analyzeTally(e,t){let r=!1,s=null;const n=[],i={};let o=null;Object.keys(e).forEach(((e,t)=>{const r=JSON.parse(e);n.push(r);const{hash:s,viewId:a}=r;a===this.viewId&&(o=t),i[s]||(i[s]=[]),i[s].push(t)}));const a=Object.keys(i),l=a.length;let c=0;l>1&&(a.sort(((e,t)=>i[t].length-i[e].length)),i[a[0]].length===i[a[1]].length&&($d.snapshot&&console.log(this.id,"Deciding consensus by tie-break"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==o){const e=n[o].hash,a=i[e];a.length>1&&a.sort(((e,r)=>n[e][t]-n[r][t])),a[0]===o&&(r=!0,e!==d&&(s={groupVotes:a.length,allVotes:n.length}))}return{numberOfGroups:l,shouldUpload:r,dissidentFlag:s}}snapshotPath(e,t,r){const s=Math.ceil(e).toString().padStart(10,"0"),{appId:n,persistentId:i,codeHash:o,apiKey:a}=this.sessionSpec;return a?`apps/${n}/snap/${o}/${i}.${this.id}/${s}_${t}.${r}`:`snapshots/${this.id}/${s}_${t}-${r}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise((t=>{const r={...e};delete r.meta,$(JSON.stringify(r)).then((r=>{e.meta.hash=r,delete e.meta.hashPromise,t(r)}))}))),e.meta.hashPromise)}uploadServer(e){if("string"==typeof Y.files){let e=Y.files;return e.endsWith("/")&&(e=e.slice(0,-1)),{url:e,apiKey:null}}const{apiKey:t,signServer:r}=Ad(e);if("none"===r)throw Error("no file server configured");return{url:r,apiKey:t}}async uploadSnapshot(e,t=null){await this.hashSnapshot(e);const r=Xn.begin("snapshot"),s=JSON.stringify(e),n=Xn.end("snapshot")-r;$d.snapshot&&console.log(this.id,`snapshot stringified (${s.length} bytes) in ${Math.ceil(n)}ms`);const{time:i,seq:o,hash:a}=e.meta,l=this.connection.socket;try{const e=await this.uploadEncrypted({content:s,path:this.snapshotPath(i,o,a),key:this.key,gzip:!0,debug:$d.snapshot,what:"snapshot"});return this.connection.socket!==l?(console.warn(this.id,"Controller was reset while trying to upload snapshot"),!1):(this.announceSnapshotUrl(i,o,a,e,t),!0)}catch(e){return console.error(this.id,"Failed to upload snapshot"),!1}}announceSnapshotUrl(e,t,r,s,n){if($d.snapshot){let i=`time: ${e}, seq: ${t}, hash: ${r}`;n&&(i+=", as dissident; "+JSON.stringify(n)),console.log(this.id,`sending snapshot url to reflector (${i}): ${s}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SNAP",args:{time:e,seq:t,hash:r,url:s,dissident:n}}))}catch(e){console.error("ERROR while sending",e)}}async downloadEncrypted({url:e,gzip:t,key:r,debug:s,json:n,what:i}){e.startsWith("https://croquet.io/files/v1")&&(e=e.replace("https://croquet.io/files/v1","https://files.croquet.io"));let o=Date.now();const a=await Kd(e,{method:"GET",mode:"cors",headers:{"X-Croquet-App":this.sessionSpec.appId,"X-Croquet-Id":this.sessionSpec.persistentId,"X-Croquet-Session":this.sessionSpec.id,"X-Croquet-Version":Jd},referrer:oe.referrerURL()}),l=await a.arrayBuffer();s&&console.log(this.id,`${i} fetched (${l.byteLength} bytes) in ${-o+(o=Date.now())}ms`);const c=this.decryptBinary(l,r);s&&console.log(this.id,`${i} decrypted (${c.length} bytes) in ${-o+(o=Date.now())}ms`);const d=t?Ka.inflate(c):c;return s&&t&&console.log(this.id,`${i} inflated (${d.length} bytes) in ${-o+(o=Date.now())}ms`),n?JSON.parse((new TextDecoder).decode(d)):d}async uploadEncrypted({content:e,path:t,key:r,gzip:s,keep:n,debug:i,what:o}){const a="string"==typeof e?(new TextEncoder).encode(e).buffer:e,l=n?void 0:[a],c="string"==typeof r?r:xn.stringify(r),{apiKey:d,appId:h,persistentId:u}=this.sessionSpec,f=++sh;return new Promise(((e,r)=>{rh.postMessage({job:f,cmd:"uploadEncrypted",server:this.uploadServer(d),path:t,buffer:a,keyBase64:c,gzip:s,referrer:oe.referrerURL(),id:this.id,appId:h,persistentId:u,CROQUET_VERSION:Jd,debug:i,what:o},l);const n=t=>{if(f!==t.data.job)return;const{url:s,ok:i,status:o,statusText:a}=t.data;rh.removeListener("message",n),i?e(s):r(Error(`${o}: ${a}`))};try{rh.addListener("message",n)}catch(e){console.log("failed to add listener",e)}}))}persistentPath(e){const{appId:t,persistentId:r}=this.sessionSpec;return`apps/${t}/${r}/save/${e}`}pollForPersist(e,t,r,s,n){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error("Persistence API requires appId");const i={viewId:this.viewId,hash:s,ms:n+.001*Math.random()},o={persistTime:t,persistentHash:s,persistentString:r};$d.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,i),this.sendTutti({time:e,topic:"persist",data:i,localContext:o,tallyTarget:["handlePersistVote"]})}async handlePersistVote(e){const{tally:t,localContext:r}=e;if($d.snapshot){const e=!!r?`for time @${r.persistTime}`:"that we didn't participate in";console.log(this.id,`received persistence vote ${e}`,t)}const{numberOfGroups:s,shouldUpload:n,dissidentFlag:i}=this.analyzeTally(t,"ms");if(s>1&&console.warn(this.id,`Persistence records fall into ${s} groups`),!n||!r)return;const{persistTime:o,persistentHash:a,persistentString:l}=r,c=await this.uploadEncrypted({path:this.persistentPath(a),content:l,key:this.key,gzip:!0,debug:$d.snapshot,what:"persistent data"});if($d.snapshot){const e=i?` (as dissident; ${JSON.stringify(i)})`:"";console.log(this.id,`sending persistent data url to reflector${e}: ${c}`)}try{this.connection.send(JSON.stringify({id:this.id,action:"SAVE",args:{persistTime:o,url:c,dissident:i}}))}catch(e){console.error("ERROR while sending",e)}}convertReflectorMessage(e){let t="noop",r=[];switch(e[2].what){case"users":{const{joined:s,left:n,active:i,total:o}=e[2];this.users=i,this.usersTotal=o;const a="__peers__",l={entered:s||[],exited:n||[],count:i};t="publishFromModelOnly",r=["__VM__",a,l],le.handleEvent(this.viewId+":"+a,l);break}case"tally":{const{tuttiSeq:s,tuttiKey:n,tally:i,tallyTarget:o,missingClients:a}=e[2];($d.messages||$d.snapshot)&&a&&console.log(`${a} ${1===a?"client":"clients"} failed to participate in tally ${n||s}`),t="handleTuttiResult",r=[{tuttiSeq:s,tuttiKey:n,tally:i,tallyTarget:o}];break}}const s=new Ih(0,0,"_",t,r);e[2]=s.asState()[2]}handleTuttiResult(e){const{tuttiSeq:t,tuttiKey:r,tally:s,tallyTarget:n}=e,i=r?e=>e.tuttiKey===r:e=>e.dummyTuttiSeq===t,o=this.tuttiHistory.findIndex(i),a=-1!==o&&this.tuttiHistory.splice(o,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),n){const[e,...t]=n,r=[...t,{tally:s,localPayload:l,localContext:c}],i=new Ih(0,0,"_",e,r);this.vm.verifyExternal(i),i.executeOn(this.vm,!0)}}async receive(e,t){const r=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case"SYNC":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),nh.add(this);const{messages:e,url:r,persisted:s,time:n,seq:i,snapshotSeq:o,tove:a,reflector:l,flags:c}=t;if(a&&a!==this.tove)try{if(this.decrypt(a)!==this.id)throw Error("wrong sessionId in tove?!")}catch(e){return void this.connection.closeConnectionWithError("SYNC",Error(`failed to decrypt session secret: ${e.message}`),4200)}const d=t.timeline||t.reflectorSession;this.flags=c||{};const h=s?"persisted session":"snapshot";$d.session&&console.log(this.id,`received SYNC from ${l} reflector: time ${n}, ${e.length} messages, ${h} ${r||"<none>"}`);let u=!!this.vm;if(u){this.networkQueue.length=0;const t=!!d&&d===this.timeline,r=e[0],s=i,a=void 0!==o?o:r?r[1]:s;$d.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${a}-#${s}`);let l=t&&Ph(a,this.vm.seq)&&Ph(this.vm.seq,s)&&n>=this.reflectorTime;if(l){let t=0;r&&Ph(r[1],this.vm.seq)&&(t=this.vm.seq-r[1]+1>>>0);for(let r=t;l&&r<e.length;r++){const t=e[r][2];"string"!=typeof t&&"users"===t.what&&t.left&&t.left.includes(this.viewId)&&($d.session&&console.log(this.id,"reflector reports that this view has left"),l=!1)}l&&t&&($d.messages&&console.log(this.id,`rejoin: discarding ${t} messages #${r[1]}-#${this.vm.seq}`),e.splice(0,t))}if(l){if(this.sendBuffer.length>0){const e=this.sendBuffer;this.sendBuffer=[],$d.session&&console.log(this.id,`rejoin: sending ${e.length} messages buffered while disconnected`);for(const t of e)t()}}else $d.session&&console.log(this.id,"cannot rejoin seamlessly; rebooting model/view"),this.leave(!0),u=!1}const f=this.networkQueue;this.networkQueue=[];for(const t of e){if("string"!=typeof t[2])this.convertReflectorMessage(t);else try{t[2]=this.decryptPayload(t[2])[0]}catch(e){return void this.connection.closeConnectionWithError("SYNC",Error(`failed to decrypt message: ${e.message}`),4200)}$d.messages&&console.log(this.id,"received in SYNC "+JSON.stringify(t)),this.networkQueue.push(t)}if(this.networkQueue.push(...f),n>this.reflectorTime&&this.timeFromReflector(n,"reflector"),u)return $d.session&&console.log(this.id,"seamless rejoin successful"),void this.sessionSpec.sessionJoined();let p;if(this.timeline=d||"",$d.snapshot&&r&&console.log(`${this.id} fetching ${h} ${r}`),r)try{p=await this.downloadEncrypted({url:r,gzip:!0,key:this.key,debug:$d.snapshot,json:!0,what:h})}catch(e){return void this.connection.closeConnectionWithError("SYNC",Error(`failed to fetch ${h}: ${e.message}`),4200)}if(!this.connected)return void console.log(this.id,"disconnected during SYNC");s?this.install(p):(p&&(this.sessionSpec.snapshot=p),this.install()),$d.session&&console.log(`${this.id} fast-forwarding from ${Math.round(this.vm.time)}`);const m=await new Promise((e=>{this.fastForwardHandler=t=>{this.connected&&this.vm?"error"===t?e(!1):t&&this.viewId in this.vm.views&&e(!0):(console.log(this.id,"disconnected during SYNC fast-forwarding"),e(!1))},Promise.resolve().then((()=>this.stepSession("fastForward",{budget:200})))}));return delete this.fastForwardHandler,m&&$d.session&&console.log(`${this.id} fast-forwarded to ${Math.round(this.vm.time)}`),void(m&&this.sessionSpec.sessionJoined())}case"RECV":{const e=t;if(e[1]>>>=0,"string"!=typeof e[2])$d.messages&&console.log(this.id,"received META "+JSON.stringify(e)),this.convertReflectorMessage(e),$d.messages&&console.log(this.id,"converted to "+JSON.stringify(e));else try{const[t,r,s]=this.decryptPayload(e[2]);e[2]=t,r===this.viewId&&this.addToStatistics(s,this.lastReceived),$d.messages&&console.log(this.id,"received "+JSON.stringify(e))}catch(e){return void this.connection.closeConnectionWithError("RECV",Error(`failed to decrypt message: ${e.message}`),4200)}let r;return this.networkQueue.push(e),this.flags.rawtime&&(r=e[e.length-1]),this.timeFromReflector(e[0],"reflector",r),void(this.simulateIfNeeded&&Promise.resolve().then((()=>this.simulateIfNeeded())))}case"TICK":{if(!this.vm)return;const e="number"==typeof t?t:t.time;if($d.ticks){const t=r&&this.lastReceived-r-this.msPerTick*this.tickMultiplier|0;console.log(this.id,`Controller received TICK ${e} ${Math.abs(t)<5?"on time":t<0?"early":"late"} (${t} ms)`)}return this.timeFromReflector(e,"reflector"),this.tickMultiplier>1&&this.multiplyTick(e),void(this.simulateIfNeeded&&Promise.resolve().then((()=>this.simulateIfNeeded())))}case"INFO":{const{msg:e,options:r}=t;return void oe.showMessage(e,r)}case"REQU":return $d.snapshot&&console.log("received REQU (snapshot request) from reflector"),void(this.cpuTime=12345);default:console.warn("Unknown action:",e,t)}}install(e){const t=Date.now(),{snapshot:r,initFn:s,options:n}=this.sessionSpec,[i,o]=r.modelsById?["deserializ","snapshot"]:["initializ","root model"];$d.session&&console.log(`${this.id} ${i}ing ${o}`);let a=new Rh(r,(()=>{try{return s(n,e)}catch(e){throw ie("init",e,"fatal"),e}}));if(($d.session||$d.snapshot&&r.modelsById)&&console.log(`${this.id} ${o} ${i}ed in ${Date.now()-t}ms`),$d.initsnapshot&&!r.modelsById){$d.snapshot&&console.log(`${this.id} exercising snapshot and restore after init()`);let e=null;try{e=JSON.stringify(a.snapshot())}catch(e){throw ie("initial snapshot",e,"fatal"),e}try{a=new Rh(JSON.parse(e),(()=>s(n)))}catch(e){throw ie("initial snapshot resume",e,"fatal"),e}}const l=this.lastKnownTime(a);this.reflectorTime=Math.max(this.reflectorTime,l),this.setVM(a)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),$d.session&&console.log(this.id,"Controller sending JOIN");const{tick:e,delay:t}=this.getTickAndMultiplier(),{name:r,codeHash:s,appId:n,apiKey:i,persistentId:o,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,flags:u}=this.sessionSpec,{apiKey:f}=Ad(i),p={name:r,apiKey:f,appId:n,persistentId:o,url:oe.referrerURL(),sdk:Jd,developerId:a,version:1,user:this.viewId,ticks:{tick:e,delay:t},dormantDelay:d,tove:this.tove,codeHash:s};l&&Object.assign(p,{heraldUrl:l}),c&&Object.assign(p,{leaveDelay:c+250}),h!==s&&Object.assign(p,{computedCodeHash:h}),u&&Object.assign(p,{flags:u}),this.connection.send(JSON.stringify({id:this.id,action:"JOIN",args:p})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError("join",Error("SYNC not received in time"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{$d.session&&console.log(this.id,"rejoin timed out"),this.rejoinTimeout=0,this.leave()}),this.sessionSpec.rejoinLimit)))}leave(e=!1){const{rebootModelView:t}=this.sessionSpec;if(this.reset(),$d.session&&console.log(this.id,`resetting ${e?"(but keeping)":"and discarding"} controller`),e||nh.delete(this),!this.sessionSpec)throw Error("do not discard sessionSpec!");t()}async encrypt(e){const t=z.random(16),r=Yn.encrypt(e,this.key,{iv:t}),s=En(e,this.key);return`${xn.stringify(t)}${xn.stringify(s)}${r}`}get deprecatedDefaultKey(){return th||(th=Cn("THIS SHOULDN'T BE IN LOGS","",{keySize:8})),th}decrypt(e,t=this.key){const r=xn.parse(e.slice(0,24)),s=xn.parse(e.slice(24,68)),n=e.slice(68),i=Yn.decrypt(n,t,{iv:r});let o="";try{o=Gn.stringify(i)}catch(e){}const a=En(o,this.key);if(this.compareHmacs(s.words,a.words))return o;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error("Decryption error")}decryptBinary(e,t){const r=(new TextDecoder).decode(new Uint8Array(e,0,4));let s,n,i,o,a;switch("string"==typeof t&&(t=xn.parse(t)),r){case"CRQ0":s=(new TextDecoder).decode(e),n=xn.parse(s.slice(4,28)),i=xn.parse(s.slice(28,72)),o=s.slice(72),a=Yn.decrypt(o,t,{iv:n});break;case"CRQ1":s=new Uint8Array(e),n=z.create(s.subarray(4,20)),i=z.create(s.subarray(20,52)),o=z.create(s.subarray(52)),a=Yn.decrypt({ciphertext:o},t,{iv:n});break;default:throw Error(`${this.id} unknown encryption version ${r}`)}a.clamp();const l=En(a,t);if(this.compareHmacs(i.words,l.words))return O(a);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error("Decryption error")}async encryptMessage(e,t,r){const[s,n,i]=e.asState();return[s,n,await this.encryptPayload([i,t,r])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let r=e.length===t.length;for(let s=0;s<e.length;s++)e[s]!==t[s]&&(r=!1);return r}sendMessage(e){if(this.viewOnly||!this.vm)return;const t=e.asState()[2].length;if(t>16384)return void console.warn(`${this.id} Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to reflector.`);!this.payloadSizeWarned&&t>4096&&(console.log(`${this.id} Message with payload of ${t} bytes being sent to reflector. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const r=Date.now(),s=this.rateLimitedSendTimes,n=this.rateLimitBuffer;if(Xn.perSecondTally({requestedMessages:1}),n.length)return void this.addToRateLimitBuffer(e);let i=0;if(s.length&&this.synced){const e=s[s.length-1],t=1e3/this.eventRateLimit-(r-e);t>1&&(i=Math.ceil(t))}i?(this.addToRateLimitBuffer(e),setTimeout((()=>this.serviceRateLimitBuffer()),i)):(this.recordRateLimitedSend(r),this.socketSendMessage(e),Xn.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){const t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(`${this.id} Sends to reflector are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){Xn.perSecondTally({bundledMessages:1});const t=Date.now(),r=e.asState(),s=r[2].length,n=this.rateLimitBuffer;if(n.length){const e=n[n.length-1],{msgStates:i,totalPayload:o}=e;if(o<4096)return i.push({msgState:r,bufferTime:t}),void(e.totalPayload+=s)}Xn.perSecondTally({newBundles:1}),n.push({msgStates:[{msgState:r,bufferTime:t}],totalPayload:s});const i=n.length;$d.session&&i%5==0&&i!==this.rateLimitLastLogged&&(console.log(`${this.id} SEND rate-limit buffer grew to ${i} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=i),i>this.eventMaxBundles?(console.error(`${this.id} Disconnecting after overflow of SEND rate-limit buffer.`),this.connection.closeConnectionWithError("SEND",Error("Send rate exceeded"),4200)):!this.rateLimitBufferWarned&&i>this.eventMaxBundles/2&&(console.warn(`${this.id} SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected.`),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const e=this.rateLimitBuffer;if(!e.length)return;const t=Date.now(),r=1e3/this.eventRateLimit,s=this.rateLimitedSendTimes;if(s.length){const e=s[s.length-1];if(r-(t-e)>0)return}const n=e.shift(),{msgStates:i,totalPayload:o}=n,a=[];let l=0;if(i.forEach((e=>{a.push(e.msgState),l+=t-e.bufferTime})),1===a.length){const e=Ih.fromState(a[0],this.vm);this.socketSendMessage(e)}else{const e=new Ih(this.vm.time,0,"_","handleBundledEvents",[a]);this.socketSendMessage(e)}if(this.recordRateLimitedSend(t),Xn.perSecondTally({sentBundles:1,sentMessagesTotal:i.length,sendDelay:l,sentBundlePayload:o,sentPayloadTotal:o}),$d.session&&this.connected){const t=e.length;t&&t%5==0&&t!==this.rateLimitLastLogged&&(console.log(`${this.id} SEND rate-limit buffer dropped to ${t} event bundles`),this.rateLimitLastLogged=t)}e.length&&setTimeout((()=>this.serviceRateLimitBuffer()),r)}async socketSendMessage(e,t=null){const r=await this.encryptMessage(e,this.viewId,Date.now()),s=t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`;if(!this.connected)return void(this.vm&&($d.sends&&console.log(this.id,`buffering ${s}`),this.sendBuffer.push((()=>this.socketSendMessage(e,t)))));$d.sends&&console.log(this.id,`sending ${s}`);const n={id:this.id,action:"SEND",args:[...r,this.latency]};t&&(n.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(n))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti({time:e,topic:t,data:r,localContext:s=null,firstMessage:n=null,wantsVote:i=!0,tallyTarget:o=null}){if(this.viewOnly)return;const a=n&&await this.encryptMessage(n,this.viewId,Date.now()),l=E(r);if(!this.connected)return void(this.vm&&($d.sends&&console.log(this.id,`buffering "${t}" TUTTI ${l} ${n&&n.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:e,topic:t,data:r,localContext:s,firstMessage:n,wantsVote:i,tallyTarget:o})))));$d.sends&&console.log(this.id,`sending "${t}" TUTTI ${l} ${n&&n.asState()}`),this.lastSent=Date.now();const c=`${t}@${e}`;this.connection.send(JSON.stringify({id:this.id,action:"TUTTI",args:[e,0,l,a,i,o,c]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:e,tuttiKey:c,dummyTuttiSeq:0,payload:l,localContext:s})}sendLog(...e){this.connected?($d.sends&&console.log(this.id,"sending LOG"),e.length<2&&(e=e[0]),this.connection.send(JSON.stringify({action:"LOG",args:e}))):this.vm&&($d.sends&&console.log(this.id,"buffering LOG"),this.sendBuffer.push((()=>this.sendLog(...e))))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const e=this.sessionSpec.options,t=["number","string"].includes(typeof e.tps)?e.tps:["number","string"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[r,s]=(t+"x").split("x").map((e=>Number.parseFloat("0"+e))),n=1e3/Math.max(1/30,Math.min(60,r)),i=Math.max(1,s);let o=n,a=0;return i>1&&!qd&&(o=n/i,a=Math.ceil(o*(i-1))),{msPerTick:o,multiplier:i,tick:n,delay:a}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{const r=Xn.begin("simulate");for(;t;){const r=this.networkQueue[0];if(!r)break;if(t=this.vm.advanceTo(r[0],e),!t)break;this.networkQueue.shift();const s=this.vm.scheduleExternalMessage(r);t=this.vm.advanceTo(s.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,Xn.end("simulate")-r)}Xn.backlog(this.backlog);const r=this.lag,s=Math.max(200,.1*this.msPerTick),n=Math.max(2e3,.2*this.msPerTick);if("boolean"==typeof this.synced&&this.viewed&&(this.synced&&r>n||!this.synced&&r<s)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<s&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}return this.synced&&t&&this.cpuTime>5e3&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot()),t}catch(e){return ie("simulate",e),this.connection.closeConnectionWithError("simulate",e),"error"}}stepSession(e,t={}){const r=Xn.stepSession(t.frameTime,!0);r&&console.log(r);const{backlog:s,latency:n,starvation:i,activity:o}=this;if("animation"===e){Xn.animationFrame(t.frameTime,{backlog:s,starvation:i,latency:n,activity:o,users:this.users});const e=Date.now();if(this.lastAnimationEnd){const t=e-this.lastAnimationEnd;if(!0===this.animationGapCheck&&t>200&&(this.animationGapCheck=[],$d.session&&console.log(`${this.id} animation has stopped (too long between steps)`)),!0!==this.animationGapCheck){const e=this.animationGapCheck;e.push(t),e.length>4&&e.shift(),4===e.length&&e.reduce(((e,t)=>e+t),0)<=400&&(this.animationGapCheck=!0,$d.session&&console.log(`${this.id} animation has started`))}}this.lastAnimationEnd=e}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(e){case"animation":{const e=t.expectedSimFPS,r=Date.now(),s=eh.reduce(((e,t)=>e+t),0)/eh.length;if(a=this.simulate(r+Math.min(s,200)),!1===a){const t=0===e?0:1e3/e*4;this.backlog>t&&(a=this.simulate(r+200-s))}"error"!==a&&(eh.push(Date.now()-r),eh.length>4&&eh.shift());break}case"fastForward":case"background":a=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(a),"error"!==a&&(Xn.begin("update"),this.processModelViewEvents("animation"===e),Xn.end("update"),this.serviceRateLimitBuffer(),"animation"===e&&(t.view&&(Xn.begin("render"),this.inViewRealm((()=>t.view.update(t.frameTime))),Xn.end("render")),this.lastAnimationEnd=Date.now()))}applySyncChange(e){$d.session&&console.log(this.id,`synced=${e}`),this.synced=e,oe.showSyncWait(!e),this.vm.publishFromView(this.viewId,"synced",e)}inViewRealm(e){return me(this.vm,(()=>e(this.vm)))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,r){e<this.reflectorTime?("controller"!==t||$d.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):("boolean"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&Xn.backlog(this.backlog),this.tickHook&&this.tickHook(e,r))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);const t=this.msPerTick,r=this.tickMultiplier;let s=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(e+s*t),"controller"),$d.ticks&&console.log(this.id,"Controller generate TICK "+this.reflectorTime,s),++s>=r&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),t)}startStepping(e){const t=r=>{this.leaving||(this.isOutOfSight()||e(r),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){this.isOutOfSight=()=>!Dd,this.isBeingAnimated=()=>{const e=!0===this.animationGapCheck,t=Date.now()-this.lastAnimationEnd<200;return e&&!t&&(this.animationGapCheck=[],$d.session&&console.log(`${this.id} animation has stopped (too long since last step)`)),e&&t},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated();const e=this.sessionSpec.autoSleep;let t;if(e){const r=1e3*e;let s=0,n=0;t=()=>{const e=Date.now();e-s<980||(s=e,this.isOutOfSight()?n?e-n>r&&(this.dormantDisconnect(),n=0):n=e:n=0)}}const r=()=>{this.leaving?s&&(clearInterval(s),s=null):this.connected&&this.vm&&(t&&t(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let s=setInterval(r,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(r(),this.connected)){let t=.9*this.msPerTick;e&&(t=Math.min(t,200));const r=this.synced?"background":"fastForward";this.stepSession(r,{budget:t})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class ah{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||this.socket.readyState!==Rc.OPEN)}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1;let e=Ad(this.controller.sessionSpec.apiKey).reflector;const t={},r=this.controller.sessionSpec.token;if(r&&(t.token=r),Y.reflector){const r=Y.reflector.toUpperCase();"CF"===r||r.match(/^[A-Z]{3}$/)?(e=$d.reflector?"wss://croquet.network/reflector/dev/":"wss://croquet.network/reflector/",3===r.length&&(t.colo=r)):Y.reflector.match(/^[-a-z0-9]+$/i)?t.region=Y.reflector:e=Y.reflector}if(!e.match(/^wss?:/))throw Error("Cannot interpret reflector address "+e);e.endsWith("/")||(e+="/");const s=new URL(e+this.id);for(const[e,r]of Object.entries(t))s.searchParams.append(e,r);const n=new Rc(s);n.onopen=e=>{const t=this.socket;t&&(t.onopen=t.onmessage=t.onerror=t.onclose=null),this.socket=n,this.connectHasBeenCalled=!1,$d.session&&console.log(this.id,this.socket.constructor.name,"connected to",this.socket.url),this.reconnectDelay=0,Xn.connected(!0),this.controller.sendJoin()},n.onmessage=e=>{n===this.socket&&this.receive(e.data)},n.onerror=e=>{$d.session&&console.log(this.id,n.constructor.name,"connection error"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},n.onclose=e=>{this.socketClosed(e.code,e.reason)}}socketClosed(e,t){this.controller.clearSyncReceiptTimeout();const r=1e3!==e&&e<4100,s=4110===e;s||1e3===e||this.reconnectDelay||setTimeout((()=>{this.connected||oe.showMessage(`Connection closed: ${e} ${t}`,{level:r?"error":"fatal"})}),500),$d.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+" closed":"closed before opening,"} with code: ${e} ${t}`),Xn.connected(!1),s?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),r&&($d.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e)}receive(e){this.lastReceived=Date.now();const{id:t,action:r,args:s}=JSON.parse(e);if(t)try{this.controller.receive(r,s)}catch(e){this.closeConnectionWithError("receive",e)}else if("PONG"===r){if($d.pong&&console.log("PONG after",Date.now()-s,"ms"),this.pongHook)try{this.pongHook(s)}catch(e){console.error(e)}}else console.warn("Unknown action",r)}dormantDisconnect(){this.connected&&($d.session&&console.log(this.id,"dormant; disconnecting from reflector"),this.closeConnection(4110,"Going dormant"))}closeConnectionWithError(e,t,r=4e3){console.error(t),console.warn("closing socket"),r>=4100&&4110!==r&&(this.controller.leaving=()=>{}),this.closeConnection(r,"Error in "+e)}closeConnection(e,t){this.socket&&(this.socket.onclose=null,this.socket.close(e,t),this.socketClosed(e,t))}PULSE(e){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:"PULSE"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(`${this.id} Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){0!==this.lastReceived&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError("connection",Error("Reflector has gone away")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(e=Date.now()){this.connected&&this.send(JSON.stringify({action:"PING",args:e}))}}globalThis.setInterval((()=>{for(const e of nh)e.connected&&e.vm&&e.connection.keepAlive(Date.now())}),100);const lh=Symbol("hash"),ch=Symbol("key"),dh=Symbol("url"),hh=new Map;function uh(e){return Y.has("debug",e,!1)}function fh(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ph(e){return e.replace(/-/g,"+").replace(/_/g,"/").padEnd(e.length+3&-4,"=")}function mh(e,t){return t.replace(/[\s\S]/g,(t=>String.fromCharCode(t.charCodeAt(0)^e.charCodeAt(0))))}class bh{static async store(e,t,r=!1){if("object"==typeof e&&(console.warn("Deprecated: Croquet.Data.store(sessionId, data) called without sessionId"),t=e),Rh.hasCurrent())throw Error("Croquet.Data.store() called from Model code");const{appId:s,persistentId:n,uploadEncrypted:i}=ih(e),o=z.random(32).toString(xn),a=`apps/${s}/${n}/data/%HASH%`,l=await i({path:a,content:t,key:o,keep:r,debug:uh("data"),what:"shared data"}),c=function(e){return e.replace(/.*\//,"")}(l);return new bh(c,o,l)}static async fetch(e,t){if("object"==typeof e&&(console.warn("Deprecated: Croquet.Data.fetch(sessionId, handle) called without sessionId"),t=e),Rh.hasCurrent())throw Error("Croquet.Data.fetch() called from Model code");const{downloadEncrypted:r}=ih(e),s=t&&t[lh],n=t&&t[ch],i=t&&t[dh];if("string"!=typeof s||"string"!=typeof n||"string"!=typeof i)throw Error("Croquet.Data.fetch() called with invalid handle");return r({url:i,key:n,debug:uh("data"),what:"shared data"})}static hash(e,t="base64url"){"function"==typeof e&&(e=Function.prototype.toString.call(e)),"string"==typeof e?e=(new TextEncoder).encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=(new TextEncoder).encode(E(e)));const r=j(z.create(e));switch(t){case"hex":return r.toString();case"base64":return r.toString(xn);case"base64url":return fh(r.toString(xn));default:throw Error(`Croquet.Data: unknown hash output "${t}", expected "hex"/"base64"/"base64url"`)}}static fromId(e){const t=e.slice(0,1);let r,s,n,i;switch(t){case"0":r=e.slice(1,44),s=e.slice(44),n=`https://files.croquet.io/sessiondata/${r}`;break;case"1":r=e.slice(1,44),s=e.slice(44,87)+"=",i=e.slice(87),n=`https://files.croquet.io/apps/${i}/data/${r}`;break;case"2":r=e.slice(1,44),s=ph(e.slice(44,87)),i=mh(s,atob(ph(e.slice(87)))),n=`https://files.croquet.io/apps/${i}/data/${r}`;break;case"3":s=ph(e.slice(1,44)),n=mh(s,atob(ph(e.slice(44)))),r=n.slice(-43);break;default:throw Error(`Croquet.Data expected handle v0-v3 got v${t}`)}return new this(r,s,n)}static toId(e){if(!e)return"";const t=e[lh],r=e[ch],s=e[dh];if(s.slice(-43)!==t)throw Error("Croquet Data: malformed URL");return`3${fh(r)}${fh(btoa(mh(r,s)))}`}constructor(e,t,r){const s=hh.get(e);if(s)return uh("data")&&console.log(`Croquet.Data: using cached handle for ${e}`),s;if(r.slice(-43)!==e)throw Error("Croquet Data: malformed URL");Object.defineProperty(this,lh,{value:e}),Object.defineProperty(this,ch,{value:t}),Object.defineProperty(this,dh,{value:r}),hh.set(e,this),uh("data")&&console.log(`Croquet.Data: created new handle for ${e}`)}}const yh={cls:bh,write:e=>bh.toId(e),read:e=>bh.fromId(e)};let gh=null,wh=null;class Sh extends Error{}function vh(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>gh.random(),globalThis.CroquetViewMath={...Math};for(const[e,t]of Object.entries(globalThis.CroquetMath)){const r=Math[e];Math[e]=1===t.length?e=>gh?t(e):r(e):(e,s)=>gh?t(e,s):r(e,s)}}if(!globalThis.CroquetViewDate){const s=globalThis.Date;let n=!1;function i(e,t){return n||(n=!0,console.warn(new Sh(`${e} used in Model code`))),t}function o(e,t,r,n,a,l,c){const d=this instanceof o,h=[e,t,r,n,a,l,c];if(h.length=arguments.length,gh)switch(i(d?"new Date()":"Date()"),arguments.length){case 0:h.push(gh.time);break;case 1:break;default:h[0]=s.UTC(...h),h.length=1}const u=new s(...h);return d?u:""+u}o.prototype=s.prototype,o.UTC=s.UTC,o.now=()=>gh?i("Date.now()",gh.time):s.now(),o.parse=(...e)=>gh?i("Date.parse()",0):s.parse(...e),globalThis.CroquetViewDate=s,globalThis.Date=o}}Object.defineProperty(Sh.prototype,"name",{value:"CroquetWarning"});const _h={};function Zh(e,t){const{qPara:r,qArgs:s,qFn:n}=JSON.parse(atob(e.slice(1,-1))),i=JSON.stringify(r),o=_h[i]||(_h[i]=new Function(...r));return"number"==typeof n&&(s[n]=o),o.call(t,...s).bind(t)}function Xh(e,t){if(gh)throw Error("VirtualMachine confusion");if(!(e instanceof Rh))throw Error("not a VM: "+e);const r=gh;try{gh=e,globalThis.CROQUETVM=e,t()}finally{gh=r}}const Lh=["handleModelEventInModel","handleBundledEvents","publishFromModelOnly","handlePollForSnapshot","handleTuttiResult","handleTuttiDivergence","handleSnapshotVote","handlePersistVote","handleModelEventInView","noop"],xh={};for(let e=0;e<Lh.length;e++)xh[Lh[e]]=e;const Th=new WeakMap;function Gh(e){Th.set(e,null)}class kh{random(){throw Error("Math.random() cannot be used in Model.evaluate()")}}class Rh{static current(){return gh||console.warn("VirtualMachine.current() called from outside the vm!"),gh}static hasCurrent(){return!!gh}static evaluate(e){if(gh)return e();vh();const t=gh;try{return gh=new kh,e()}finally{gh=t}}constructor(e,t){vh(),wh={snapshot:Y.has("debug","snapshot",!1),session:Y.has("debug","session",!1)},Gh(this),Xh(this,(()=>{pe(this,(()=>{if(this.modelsById={},this.modelsByName={},this.messages=new gn(((e,t)=>e.before(t))),this.subscriptions={},this.views={},this._random=()=>{throw Error("You must not use random when applying state!")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted="",this.modelsId=0,this.controller=null,e.modelsById){const t=Kh.newOrRecycled(this).readVM(e,"_");let r=[];for(const e of Object.keys(t))e in this||"meta"===e?"messages"===e?r=t.messages:this[e]=t[e]:console.warn(`Ignoring property snapshot.${e}`);for(const e of r)this.messages.add(e.convertIfNeeded(this))}else this._random=new ye(e.id,{state:!0}),t(this),this.addSubscription(this,"__VM__","__peers__",this.generateJoinExit)}))}))}registerModel(e,t){if(gh!==this)throw Error("You can only create models from model code!");return t||(t="M"+ ++this.modelsId),this.modelsById[t]=e,t}deregisterModel(e){if(gh!==this)throw Error("You can only destroy models from model code!");const t=this.modelsById;delete this.modelsById[e];for(const[e,r]of Object.entries(this.modelsByName))t===r&&delete this.modelsByName[e];this.messages.removeMany((t=>t.hasReceiver(e)))}lookUpModel(e){if("_"===e)return this;const t=this.modelsById[e];if(t)return t;const[r,s,n]=e.match(/^([^#]+)#(.*)$/);return this.modelsById[s].lookUp(n)}get(e){return this.modelsByName[e]}set(e,t){if(gh!==this)throw Error("You can only make a model well-known from model code!");this.modelsByName[e]=t}noop(){}generateJoinExit({entered:e,exited:t,count:r}){if(e.length===r){t=Object.keys(this.views);for(const e of t)this.views[e].extraConnections=0}if(0!==e.length&&0!==t.length){const r=e.filter((e=>t.includes(e)));if(0!==r.length&&(e=e.filter((e=>!r.includes(e))),t=t.filter((e=>!r.includes(e))),0===e.length&&0===t.length))return}for(const e of t)if(this.views[e]){if(this.views[e].extraConnections){this.views[e].extraConnections--,wh.session&&console.log(`${this.id} @${this.time}#${this.seq} view ${e} closed extra connection`);continue}delete this.views[e],this.publishFromModelOnly(this.id,"view-exit",e)}else console.error(`${this.id} @${this.time}#${this.seq} view ${e} exited without being present - this should not happen`),this.controller.sendLog(`view-exit-mismatch @${this.time}#${this.seq} ${e} left without being present`);for(const t of e)this.views[t]?(wh.session&&console.log(`${this.id} @${this.time}#${this.seq} view ${t} opened another connection`),this.views[t].extraConnections=(this.views[t].extraConnections||0)+1):(this.views[t]={},this.publishFromModelOnly(this.id,"view-join",t));const s=Object.values(this.views).reduce(((e,t)=>e+1+(t.extraConnections||0)),0);r!==s&&(console.error(`@${this.time}#${this.seq} view count mismatch (model: ${s}, reflector: ${r}) - this should not happen`),this.controller.sendLog(`view-exit-mismatch @${this.time}#${this.seq} connections model: ${s} reflector: ${r}`))}scheduleExternalMessage(e){const t=Ih.fromState(e,this);if(t.time<this.time)throw Error("past message from reflector "+e);const r=this.externalSeq+1>>>0;if(t.seq!==r)throw Error(`External message error. Expected message #${r} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if("_"!==e.receiver)throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in xh))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,r,s){if(e.every)return this.futureRepeat(e.every,t,r,s);if(e<0)throw Error("attempt to send future message into the past");this.futureSeq=this.futureSeq+1>>>0;const n=new Ih(this.time+e,2*this.futureSeq,t,r,s);return this.messages.add(n),n}futureRepeat(e,t,r,s){this.futureSend(e,this.id,"futureExecAndRepeat",[e,t,r,s])}futureExecAndRepeat(e,t,r,s){const n=this.lookUpModel(t);if("function"==typeof n[r])try{n[r](...s)}catch(e){ie(`future message ${n}.${r}`,e)}else{const e=Zh(r,n);try{e(...s)}catch(t){ie(`future message ${n} ${e}`,t)}}this.futureRepeat(e,t,r,s)}future(e,t,r,s){const n=this.asQFunc(e,r);if("string"==typeof n)return this.futureSend(t,e.id,n,s);const i=this;return new Proxy(e,{get(r,s){if("function"==typeof e[s])return(...r)=>{if(i.lookUpModel(e.id)!==e)throw Error("future send to unregistered model");return i.futureSend(t,e.id,s,r)};throw Error("Tried to call "+s+"() on future of "+Object.getPrototypeOf(e).constructor.name+" which is not a function")}})}advanceTo(e,t){if(gh)throw Error("cannot advance time from model code");let r,s=0;for(;(r=this.messages.peek())&&r.time<=e;){const{time:e,seq:n}=r;if(e<this.time)throw Error("past message encountered: "+r);if(1&n&&(this.seq=this.seq+1>>>0,n/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${n/2>>>0} in ${r}`);if(this.messages.poll(),this.time=r.time,r.executeOn(this),++s>100&&(s=0,Date.now()>t))return!1}return this.time=e,!0}asQFunc(e,t){if("string"==typeof t)return t;if("function"==typeof t){if(e[t.name]===t)return t.name;let r=e;for(;null!==r;){for(const[e,s]of Object.entries(Object.getOwnPropertyDescriptors(r)))if(s.value===t)return e;r=Object.getPrototypeOf(r)}se(`subscription handler is not a method of ${e}: ${t}\n`,{only:"once"});const s=/^\(?([a-z][a-z0-9]*)?\)? *=> *this\.([a-z][a-z0-9]*) *\( *([a-z][a-z0-9]*)? *\) *$/i,n=t.toString().match(s);return!n||n[3]&&n[3]!==n[1]?function(e,t){"function"==typeof e&&(t=e,e={});const r=Object.keys(e).concat(["return "+t]),s=Object.values(e),n={qPara:r,qArgs:s},i=s.indexOf(t);return i>=0&&(s[i]=r[i],n.qFn=i),`{${btoa(JSON.stringify(n))}}`}(t):n[2]}return null}addSubscription(e,t,r,s){if(gh!==this)throw Error("Cannot add a model subscription from outside model code");const n=this.asQFunc(e,s);if("string"!=typeof n)throw Error(`Subscription handler for "${r}" must be a method name`);if(n.indexOf(".")<0&&"function"!=typeof e[n]&&"{"!==n[0])throw Error(`Subscriber method for "${r}" not found: ${e}.${n}()`);const i=t+":"+r,o=(e===this?"_":e.id)+"."+n;if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(o))throw Error(`${e}.${n} already subscribed to ${r}`)}else this.subscriptions[i]=[];this.subscriptions[i].push(o)}removeSubscription(e,t,r,s="*"){if(gh!==this)throw Error("Cannot remove a model subscription from outside model code");const n=t+":"+r,i=this.subscriptions[n];if(i)if("*"===s){const t=i.filter((t=>{const[r]=t.split(".");return r!==e.id}));0===t.length?delete this.subscriptions[n]:this.subscriptions[n]=t}else{const t=this.asQFunc(e,s);if("string"!=typeof t)throw Error(`Invalid unsubscribe args for "${r}" in ${e}: ${s}`);const o=e.id+"."+t,a=i.indexOf(o);-1!==a&&(i.splice(a,1),0===i.length&&delete this.subscriptions[n])}}removeAllSubscriptionsFor(e){const t=`${e.id}:`,r=`${e.id}.`;for(const[e,s]of Object.entries(this.subscriptions))if(e.startsWith(t))delete this.subscriptions[e];else{for(let e=s.length-1;e>=0;e--)s[e].startsWith(r)&&s.splice(e,1);0===s.size&&delete this.subscriptions[e]}}publishFromModel(e,t,r){if(gh!==this)throw Error("Cannot publish a model event from outside model code");const s=t.endsWith("#reflected");s&&(t=t.slice(0,t.length-"#reflected".length));const n=e+":"+t;this.handleModelEventInModel(n,r,s),this.handleModelEventInView(n,r)}publishFromModelOnly(e,t,r){if(gh!==this)throw Error("Cannot publish a model event from outside model code");const s=e+":"+t;this.handleModelEventInModel(s,r)}publishFromView(e,t,r){if(gh)throw Error("Cannot publish a view event from model code");const s=e+":"+t;this.handleViewEventInModel(s,r),this.handleViewEventInView(s,r)}handleBundledEvents(e){for(const t of e){const e=Ih.fromState(t,this);this.verifyExternal(e),e.executeOn(this,!0)}}handleModelEventInModel(e,t,r=!1){if(gh!==this)throw Error("handleModelEventInModel called from outside model code");if(r){if(!0!==this.controller.synced)return;const r=e+"#__vote",s=e+"#divergence",n=!!le.subscriptions[r],i=!!this.subscriptions[e],o=!!this.subscriptions[s];n&&o&&console.log(`divergence subscription for ${e} overridden by vote subscription`);const a=i?new Ih(this.time,0,"_","handleModelEventInModel",[e,t]):null;let l;l=n?["handleModelEventInView",r]:["handleTuttiDivergence",s],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:a,wantsVote:n,tallyTarget:l})))}else if(this.subscriptions[e])for(const r of this.subscriptions[e]){const[s,...n]=r.split("."),i=n.join("."),o=this.lookUpModel(s);if(o)if("{"!==i[0])if(i.indexOf(".")>=0){const r=i.indexOf("."),s=i.slice(0,r),n=i.slice(r+1);try{o.call(s,n,t)}catch(t){ie(`event ${e} ${o}.call(${JSON.stringify(s)}, ${JSON.stringify(n)})`,t)}}else if("function"==typeof o[i])try{o[i](t)}catch(t){ie(`event ${e} ${o}.${i}()`,t)}else ie(`event ${e} ${o}.${i}(): method not found`);else{const r=Zh(i,o);try{r(t)}catch(t){ie(`event ${e} ${o} ${r}`,t)}}else se(`event ${e} .${i}(): subscriber not found`)}}handleViewEventInModel(e,t){if(this.subscriptions[e]){const r=[e];void 0!==t&&r.push(t);const s=new Ih(this.time,0,"_","handleModelEventInModel",r);this.controller.sendMessage(s)}}handleModelEventInView(e,t){le.handleEvent(e,t,(e=>function(e){if(!gh)throw Error("VirtualMachine confusion");const t=gh;try{gh=null,e()}finally{gh=t}}((()=>me(this,e,!0)))))}handleViewEventInView(e,t){le.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{const r=e.split(":").slice(-1)[0];console.warn(`uncaptured divergence in ${r}:`,t)}}processModelViewEvents(e){if(gh)throw Error("cannot process view events in model code");return me(this,(()=>le.processFrameEvents(e,!!this.controller.synced)))}handlePollForSnapshot(){const e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}snapshot(){return Yh.newOrRecycled(this).snapshot(this,"_")}getSummaryHash(){return E((new Mh).getHash(this))}persist(e,t){const r=Xn.begin("snapshot"),s="function"==typeof t?t.call(e):t;if("object"!=typeof s)throw Error(`Croquet: persistSession() can only persist objects (got ${typeof s})`);const n=E(s),i=bh.hash(n),o=Xn.end("snapshot")-r,a=this.persisted===i,l=this.time;var c,d;if(wh.snapshot&&console.log(`${this.id} persistent data @${l} collected, stringified and hashed in ${Math.ceil(o)}ms${a?" (unchanged, ignoring)":""}`),!a)if(c=this,d={persistTime:l,persistentString:n,persistentHash:i,ms:o},Th.set(c,d),this.persisted=i,this.inPersistenceCoolOff)wh.snapshot&&console.log(`${this.id} persistence poll postponed by cooloff`);else{const e=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;e>0?(wh.snapshot&&console.log(`${this.id} postponing persistence poll by ${e}ms`),this.futureSend(e,this.id,"triggerPersistencePoll",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const e=(t=this,Th.get(t));var t;if(!e)return;const{persistTime:r,persistentString:s,persistentHash:n,ms:i}=e;if(Gh(this),this.controller&&this.controller.synced){wh.snapshot&&console.log(`${this.id} asking controller to poll for persistence @${r}`);const e=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(e,r,s,n,i)))}}random(){if(gh!==this)throw Error("replicated random accessed from outside the model");return this._random()}randomID(){if(gh!==this)throw Error("replicated random accessed from outside the model");let e="";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,"0");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function Wh(e,t,r){let s;if("_"===e){const e=xh[t];"number"==typeof e&&(s=e.toString(36))}if(void 0===s&&(s=`${e}>${t}`),r.length>0){const e=Eh.newOrRecycled();s+=JSON.stringify(e.encode(r))}return s}function Ch(e,t){let r,s,n;if(1===e.length||"["===e[1]){const t=parseInt(e[0],36);r="_",s=Lh[t],n=e.slice(1)}else{const t=e.indexOf(">");let i=e.indexOf("[");-1===i&&(i=e.length),r=e.slice(0,t),s=e.slice(t+1,i),n=e.slice(i)}let i=[];if(n){i=Hh.newOrRecycled(t).decode(JSON.parse(n))}return{receiver:r,selector:s,args:i}}function Ph(e,t){return(t-e|0)>=0}class Ih{constructor(e,t,r,s,n){this.time=e,this.seq=t,this.receiver=r,this.selector=s,this.args=n}convertIfNeeded(e){if(this.payload){const{receiver:t,selector:r,args:s}=Ch(this.payload,e);delete this.payload,this.receiver=t,this.selector=r,this.args=s}return this}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?Ph(this.externalSeq,e.externalSeq):Ph(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,Wh(this.receiver,this.selector,this.args)]}static fromState(e,t){const[r,s,n]=e,{receiver:i,selector:o,args:a}=Ch(n,t);return new Ih(r,s,i,o,a)}executeOn(e,t=!1){const r=t?e=>e():t=>Xh(e,(()=>pe(e,t))),{receiver:s,selector:n,args:i}=this,o=e.lookUpModel(s);if(o)if("{"===n[0]){const e=Zh(n,o);r((()=>{try{e(...i)}catch(t){ie(`${this.shortString()} ${e}`,t)}}))}else n.indexOf(".")>=0?r((()=>{const e=n.indexOf("."),t=n.slice(0,e),r=n.slice(e+1);try{o.call(t,r,...i)}catch(e){ie(`${this.shortString()} ${o}.call(${JSON.stringify(t)}, ${JSON.stringify(r)})`,e)}})):"function"!=typeof o[n]?se(`${this.shortString()} ${o}.${n}(): method not found`):r((()=>{try{o[n](...i)}catch(e){ie(`${this.shortString()} ${o}.${n}()`,e)}}));else se(`${this.shortString()} ${n}(): receiver not found`)}shortString(){return(this.isExternal()?"External":"Future")+"Message"}toString(){const{receiver:e,selector:t,args:r}=this,s=this.isExternal(),n=s?this.externalSeq:this.internalSeq;return`${s?"External":"Future"}Message[${this.time}${":#"[+s]}${n} ${e}.${t}(${r.map(JSON.stringify).join(", ")})]`}[Symbol.toPrimitive](){return this.toString()}}const Vh=(()=>{const e=new ArrayBuffer(8),t=new DataView(e);return e=>(t.setFloat64(0,e,!0),t.getInt32(0,!0)+t.getInt32(4,!0))})();class Mh{constructor(){this.refs=new Map,this.todo=[],this.hashers=new Map,this.addHasher("Teatime:Message",Ih),this.addHasher("Teatime:Data",yh);for(const[e,t]of Oh.allClassTypes())this.addHasher(e,t)}addHasher(e,t){const{cls:r,write:s}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};this.hashers.set(r,(e=>this.hashStructure(e,s(e))))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[t,r]of Object.entries(e))if("controller"!==t&&"meta"!==t)if("_random"===t)this.hash(r.state(),!1);else if("messages"===t){const e=r.asArray();(this.hashState.fC=e.length)&&this.hash(e,!1)}else this.hashEntry(t,r);return this.hashDeferred(),this.hashState}hashDeferred(){for(;this.todo.length>0;){const{key:e,value:t}=this.todo.shift();this.hashEntry(e,t,!1)}}hash(e,t=!0){switch(typeof e){case"number":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?0===e?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=Vh(e)):this.hashState.infC++);case"string":return this.hashState.sC++,void(this.hashState.sL+=e.length);case"boolean":case"undefined":return;default:if(this.refs.has(e))return;switch(Object.prototype.toString.call(e).slice(8,-1)){case"Array":return void this.hashArray(e,t);case"ArrayBuffer":return void this.hashArray(new Uint8Array(e),!1);case"Set":case"Map":return void this.hashStructure(e,[...e]);case"DataView":return void this.hashArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),!1);case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return void this.hashArray(e,!1);case"Object":if(e instanceof Oh)this.hashModel(e);else if(e.constructor===Object)this.hashObject(e,t);else{const t=this.hashers.get(e.constructor);t&&t(e)}}}}hashModel(e){this.hashState.mC++,this.refs.set(e,!0);for(const[t,r]of Object.entries(e))"__realm"!==t&&void 0!==r&&this.hashEntry(t,r)}hashObject(e,t=!0){this.hashState.oC++,this.refs.set(e,!0);for(const[r,s]of Object.entries(e))void 0!==s&&this.hashEntry(r,s,t)}hashArray(e,t=!0){this.refs.set(e,!0);for(let r=0;r<e.length;r++)this.hashEntry(r,e[r],t)}hashStructure(e,t){void 0!==t&&(this.refs.set(e,!0),this.hash(t,!1))}hashEntry(e,t,r=!0){"$"!==e[0]&&(r&&"object"==typeof t?this.todo.push({key:e,value:t}):this.hash(t))}}class Yh{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter("Teatime:Message",Ih),this.addWriter("Teatime:Data",yh);for(const[e,t]of Oh.allClassTypes())this.addWriter(e,t);this.okayToIgnore={};for(const e of Oh.allClasses())if(Object.prototype.hasOwnProperty.call(e,"okayToIgnore")){const t=e.okayToIgnore();if(!Array.isArray(t))throw new Error("okayToIgnore() must return an array");for(const e of t){if("$"!==e[0])throw Error(`okayToIgnore: ignored prop "${e}" must start with '$'`);this.okayToIgnore[e]=!0}}}addWriter(e,t){const{cls:r,write:s}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};this.writers.set(r,((t,r)=>this.writeAs(e,t,s(t),r)))}snapshot(e){const t={_random:e._random.state(),messages:this.write(e.messages.asArray())};for(const[r,s]of Object.entries(e))"controller"!==r&&(t[r]||this.writeInto(t,r,s,"_"));return this.writeDeferred(),t}writeDeferred(){for(;this.todo.length>0;){const{state:e,key:t,value:r,path:s}=this.todo.shift();this.writeInto(e,t,r,s,!1)}}write(e,t,r=!0){switch(typeof e){case"number":return Object.is(e,-0)?{$class:"NegZero"}:Number.isSafeInteger(e)?e:Number.isNaN(e)?{$class:"NaN"}:Number.isFinite(e)?this.writeFloat(e):{$class:"Infinity",$value:Math.sign(e)};case"string":case"boolean":return e;case"undefined":return{$class:"Undefined"};default:{if(this.refs.has(e))return this.writeRef(e);const s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case"Array":return this.writeArray(e,t,r);case"ArrayBuffer":return this.writeArrayBuffer(e);case"Set":return this.writeAs(s,e,[...e],t);case"Map":return this.writeAs(s,e,[...e].flat(),t);case"DataView":case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":return this.writeTypedArray(s,e);case"Object":{if(e instanceof Oh)return this.writeModel(e,t);if(e.constructor===Object||"function"!=typeof e.constructor)return this.writeObject(e,t,r);const s=this.writers.get(e.constructor);if(s)return s(e,t);throw console.error(`Croquet Snapshot: unknown class ${t}:`,e),Error(`Croquet Snapshot: class not registered in Model.types(): ${e.constructor.name}`)}case"Null":return e;default:throw console.error(`Croquet Snapshot: unsupported property ${t}:`,e),Error(`Croquet Snapshot: ${s}s are not supported as model properties`)}}}}writeModel(e,t){const r={};this.refs.set(e,r);try{r.$model=Oh.classToID(e.constructor)}catch(r){throw console.error(`unregistered model class at ${t}:`,e),r}for(const s of Object.keys(e).sort()){if("__realm"===s)continue;const n=e[s];this.writeInto(r,s,n,t)}return r}writeObject(e,t,r=!0){const s={};this.refs.set(e,s);for(const n of Object.keys(e).sort()){const i=e[n];this.writeInto(s,n,i,t,r)}return s}writeArray(e,t,r=!0){const s=[];this.refs.set(e,s);for(let n=0;n<e.length;n++)this.writeInto(s,n,e[n],t,r);return s}writeArrayBuffer(e){const t={$class:"ArrayBuffer",$value:zh(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){const r={$class:e,$value:[this.writeArrayBuffer(t.buffer),t.byteOffset,"DataView"===e?t.byteLength:t.length]};return this.refs.set(t,r),r}writeFloat(e){return e}writeAs(e,t,r,s){if(void 0===r)return r;const n={$class:e};this.refs.set(t,n);const i=this.write(r,s,!1);return"object"!=typeof i||i.$class||Array.isArray(i)?n.$value=i:Object.assign(n,i),n}writeRef(e){const t=this.refs.get(e);if("object"!=typeof t)throw Error("Non-object in refs: "+e);Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:"Array",$value:[...this]}});return{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,r,s,n=!0){if("$"===t[0])return void(this.okayToIgnore[t]||(se(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:"once"}),this.okayToIgnore[t]=!0));if(n&&"object"==typeof r)return void this.todo.push({state:e,key:t,value:r,path:s});const i=s+("string"==typeof t&&t.match(/^[_a-z][_a-z0-9]*$/i)?`.${t}`:`[${JSON.stringify(t)}]`),o=this.write(r,i);void 0!==o&&(e[t]=o)}}class Kh{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+"-instance"]}static set reusableInstance(e){this[this.name+"-instance"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.readers=new Map,this.addReader("Teatime:Message",Ih),this.addReader("Teatime:Data",yh),this.readers.set("Undefined",(()=>{})),this.readers.set("NaN",(()=>NaN)),this.readers.set("Infinity",(e=>e*(1/0))),this.readers.set("NegZero",(()=>-0)),this.readers.set("ArrayBuffer",(e=>function(e){const t=globalThis.atob(e),r=t.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=t.charCodeAt(e);return s.buffer}(e))),this.readers.set("DataView",(e=>new DataView(...e))),this.readers.set("Int8Array",(e=>new Int8Array(...e))),this.readers.set("Uint8Array",(e=>new Uint8Array(...e))),this.readers.set("Uint8ClampedArray",(e=>new Uint8ClampedArray(...e))),this.readers.set("Int16Array",(e=>new Int16Array(...e))),this.readers.set("Uint16Array",(e=>new Uint16Array(...e))),this.readers.set("Int32Array",(e=>new Int32Array(...e))),this.readers.set("Uint32Array",(e=>new Uint32Array(...e))),this.readers.set("Float32Array",(e=>new Float32Array(...e))),this.readers.set("Float64Array",(e=>new Float64Array(...e)));for(const[e,t]of Oh.allClassTypes())this.addReader(e,t)}addReader(e,t){const r="object"==typeof t?t.read:e=>Object.assign(Object.create(t.prototype),e);this.readers.set(e,r)}readVM(e,t){if("_"!==t)throw Error("VirtualMachine must be root object");const r={_random:new ye(null,{state:e._random})};for(const[s,n]of Object.entries(e))r[s]||this.readInto(r,s,n,t);return this.readDeferred(),this.resolveRefs(),r}readDeferred(){for(;this.todo.length>0;){const{object:e,key:t,value:r,path:s}=this.todo.shift();this.readInto(e,t,r,s,!1)}}resolveRefs(){for(const{object:e,key:t,ref:r,path:s}of this.unresolved){if(!this.refs.has(r))throw Error(`Unresolved ref: ${r} at ${s}[${JSON.stringify(t)}]`);e[t]=this.refs.get(r)}}read(e,t,r=!0){switch(typeof e){case"number":case"string":case"boolean":return e;default:{const s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case"Array":return this.readArray(e,t,r);case"Null":return null;case"Object":{const{$class:s,$model:n,$ref:i}=e;if(i)throw Error("refs should have been handled in readInto()");return n?this.readModel(e,t):s?this.readAs(s,e,t):this.readObject(Object,e,t,r)}default:throw Error(`Don't know how to deserialize ${s} at ${t}`)}}}}readModel(e,t){const r=Oh.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,r);for(const[s,n]of Object.entries(e))"id"!==s&&"$"!==s[0]&&this.readInto(r,s,n,t);return r}readObject(e,t,r,s=!0){const n=new e;t.$id&&this.refs.set(t.$id,n);for(const[e,i]of Object.entries(t))"$"!==e[0]&&this.readInto(n,e,i,r,s);return n}readArray(e,t,r=!0){const s=[];e.$id&&this.refs.set(e.$id,s);for(let n=0;n<e.length;n++)void 0!==e[n]&&this.readInto(s,n,e[n],t,r);return s}readAsArray(e,t,r=!0){const s=e.$value;return e.$id&&(s.$id=e.$id),this.readArray(s,t,r)}readAsSet(e,t){const r=new Set;e.$id&&this.refs.set(e.$id,r);const s=this.read(e.$value,t,!1);for(const e of s)r.add(e);return r}readAsMap(e,t){const r=new Map;e.$id&&this.refs.set(e.$id,r);const s=this.read(e.$value,t,!1);for(let e=0;e<s.length;e+=2)r.set(s[e],s[e+1]);return r}readAsClass(e,t,r){let s={};const n=new Map;if("$value"in t)s=this.read(t.$value,r,!1);else for(const[e,i]of Object.entries(t)){if("$"===e[0])continue;const t=i&&i.$ref;t?this.refs.has(t)?s[e]=this.refs.get(t):(s[e]="<unresolved>",n.set(t,e)):this.readInto(s,e,i,r,!1)}const i=this.readers.get(e)(s,r);i||"Undefined"===e||"NaN"===e||"NegZero"===e||console.warn(`Reading "${e}" returned ${i} at ${r}`),t.$id&&this.refs.set(t.$id,i);for(const[e,t]of n.entries())this.unresolved.push({object:i,key:t,ref:e,path:r});return i}readAs(e,t,r){switch(e){case"Array":return this.readAsArray(t,r);case"Set":return this.readAsSet(t,r);case"Map":return this.readAsMap(t,r);default:return this.readAsClass(e,t,r)}}readRef(e,t,r,s){if(!r||!r.$ref)return!1;const n=r.$ref;return this.refs.has(n)?e[t]=this.refs.get(n):(e[t]="<unresolved>",this.unresolved.push({object:e,key:t,ref:n,path:s})),!0}readInto(e,t,r,s,n=!0){if(this.readRef(e,t,r,s))return;if(n&&"object"==typeof r)return void this.todo.push({object:e,key:t,value:r,path:s});const i=s+("string"==typeof t&&t.match(/^[_a-z][_a-z0-9]*$/i)?`.${t}`:`[${JSON.stringify(t)}]`);e[t]=this.read(r,i)}}class Eh extends Yh{encode(e){const t=this.writeArray(e,"$");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}}class Hh extends Kh{decode(e){const t=this.readArray(e,"$");return this.readDeferred(),this.resolveRefs(),t}resolveRefs(){for(const{object:e,key:t,ref:r,path:s}of this.unresolved)if(this.refs.has(r))e[t]=this.refs.get(r);else{const n=this.vm.lookUpModel(r);if(!n)throw Error(`Unresolved ref: ${r} at ${s}[${JSON.stringify(t)}]`);e[t]=n}}}function Fh(e,t="",r={},s=new Set){const n=Object.values(e).filter((e=>{const t=Object.prototype.toString.call(e).slice(8,-1);return("Object"===t||"Array"===t)&&!s.has(e)}));for(const e of n){s.add(e);const n=t+"."+e.constructor.name;if(r[n]){if(r[n]!==e.constructor)throw new Error("Class with name "+n+" already gathered, but new one has different identity")}else r[n]=e.constructor}for(const e of n)Fh(e,t,r,s)}function zh(e){const t=new Uint8Array(e),r=t.byteLength;let s="";for(let e=0;e<r;e++)s+=String.fromCharCode(t[e]);return globalThis.btoa(s)}const Nh=Y.has("debug","classes",!1);let jh=Symbol("SECRET");const Uh=new WeakSet;class Oh{static create(e,t,r){if(!Bh(this))throw Error(`Model class "${this.name}" not registered`);const s=this,n=fe(),i=new s(jh);return Object.defineProperty(i,"__realm",{value:n}),Object.defineProperty(i,"id",{value:n.register(i),enumerable:!0}),Uh.add(i),"string"==typeof t&&(console.warn(`Croquet: Model.create(..., "${t}") with a well-known name argument is deprecated!`),i.beWellKnownAs(t),t=void 0),r&&i.beWellKnownAs(r),i.init(e,t),Uh.has(i)&&(Uh.delete(i),Object.getPrototypeOf(s)!==Oh&&console.warn(`${i} did not call super.init(options)`)),i}static createNoInit(e){const t=fe(),r=new this(jh);return Object.defineProperty(r,"__realm",{value:t}),Object.defineProperty(r,"id",{value:e,enumerable:!0}),r}static allowConstructors(){jh=void 0,console.warn("disabling error reporting for Model constructors")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/sdk/docs/Model.html#.register`)),Kh.resetInstance(),Yh.resetInstance(),Eh.resetInstance(),Hh.resetInstance(),function(e,t){const r=Q(e),s=$(`${t}:${r}`);q.push(s),D()&&s.then((e=>{B[e].what=`Class ${t}`}))}(this,e),function(e,t){const r=Qh[t];if(r&&r!==e)throw Error(`Registering model class ${e.name} failed, id "${t}" already used by ${r.name}`);Bh(e)?Nh&&!r&&console.warn(`ignoring re-exported model class ${t}`):(Nh&&console.log(`registering model class ${t}`),e[Jh]=t);Qh[t]=e}(this,e),this}static wellKnownModel(e){if(!Rh.hasCurrent())throw Error("static Model.wellKnownModel() called from outside model");return Rh.current().get(e)}static evaluate(e){return Rh.evaluate(e)}static types(){return{}}static okayToIgnore(){return[]}static classToID(e){return function(e){if(Bh(e))return e[Jh];const t=e.name||"ClassName";throw Error(`Model class not registered, did you call ${t}.register("${t}")?`)}(e)}static classFromID(e){return Ah(e)}static allClasses(){return Dh()}static allClassTypes(){return function(){const e={};for(const t of Dh())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return Ah(e).createNoInit(t)}constructor(e){if(e!==jh)throw Error(`You must create ${this} using create() not "new"!`)}init(e){Uh.delete(this)}destroy(){fe().unsubscribeAll(this),fe().deregister(this)}publish(e,t,r){this.__realm||this.__realmError(),this.__realm.publish(t,r,e)}subscribe(e,t,r){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,r)}unsubscribe(e,t,r="*"){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,r)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(e=0,t,...r){return this.__realm||this.__realmError(),this.__realm.future(this,e,t,r)}random(){return fe().random()}now(){return fe().now()}beWellKnownAs(e){fe().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(Rh.current()===this.__realm.vm)return!0;const t=Error(e||`${this}.modelOnly() called from outside a model!`);throw ie("view code",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}persistSession(e){if(this!==this.wellKnownModel("modelRoot"))throw Error("persistSession() must only be called on the root model");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){const e=this.constructor[Jh]||this.constructor.name;return e.includes("Model")?e:`${e}[Model]`}}const Qh={},Jh=Symbol("CLASS_ID");function Dh(){return Object.values(Qh)}function Bh(e){return Object.prototype.hasOwnProperty.call(e,Jh)}function Ah(e){if(Qh[e])return Qh[e];throw Error(`Model class "${e}" in snapshot, but not registered?`)}Oh[Jh]="Croquet.Model",Qh["Croquet.Model"]=Oh;class $h{static displayStatus(e,t){return ne(e,t)}static displayWarning(e,t){return se(e,t)}static displayError(e,t){return function(e,t={}){return e&&oe.showMessage(e,{...t,level:"error"})}(e,t)}constructor(e){"object"==typeof e&&"__realm"in e||console.warn("Croquet: argument to View constructor needs to be a Model");let t=fe("");t&&t.isViewRealm()||(t=me(e.__realm.vm,(()=>fe()),!0)),Object.defineProperty(this,"realm",{value:t}),Object.defineProperty(this,"id",{value:t.register(this),configurable:!0})}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,"id",{value:""})}reattach(){Object.defineProperty(this,"id",{value:this.realm.register(this)})}publish(e,t,r){this.realm.publish(t,r,e)}subscribe(e,t,r){"string"==typeof r&&(r=this[r]);const s=r;(r=s.bind(this)).unbound=s;const{event:n,handling:i}=t.event?t:{event:t};this.realm.subscribe(n,this.id,r,e,i)}unsubscribe(e,t,r=null){"string"==typeof r&&(r=this[r]),this.realm.unsubscribe(t,this.id,r,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}future(e=0){return this.realm.future(this,e)}random(){return fe().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.vm.id}get session(){return this.realm.vm.controller.session}get viewId(){return this.realm.vm.controller.viewId}[Symbol.toPrimitive](){const e=this.constructor.name;return e.includes("View")?e:`${e}[View]`}}const qh=new class{constructor(){this.ready=!1}setReceiver(e){}setIframeEnumerator(e){}on(e,t){}detach(){}removeSubscription(e,t){}removeAllSubscriptions(){}receive(e){}handleEvent(e,t,r){}send(e,t,r){}startPublishingPointerMove(){}stopPublishingPointerMove(){}};let eu=60;class tu{static async join(e){try{return await this.join_impl(e)}catch(e){throw oe.showMessage(e.message,{level:"fatal"}),e}}static async join_impl(e){if("object"!=typeof e)throw Error("Croquet: please use new Session.join( {apiKey, ...} ) API. See https://croquet.io/sdk/docs/Session.html#.join");for(const[u,f]of Object.entries(e))f instanceof Promise&&(e[u]=await f);function t(e,t){return e===t||e.prototype instanceof t}if("string"!=typeof e.apiKey)throw Error("Croquet: no apiKey provided in Session.join()!");if(e.apiKey.length>128)throw Error("Croquet: apiKey > 128 characters in Session.join()!");if("string"!=typeof e.name)throw Error("Croquet: no session name provided in Session.join()!");if(e.name.length>128)throw Error("Croquet: session name > 128 characters in Session.join()!");const r=e.model;if("function"!=typeof r||!t(r,Oh))throw Error("Croquet: bad model class in Session.join()");const s=e.view||$h;if("function"!=typeof s||!t(s,$h))throw Error("Croquet: bad view class in Session.join()");if("string"!=typeof e.appId)throw Error("Croquet: no appId provided in Session.join()");if(!e.appId.length>128)throw Error("Croquet: appId > 128 characters in Session.join()");if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error("Croquet: malformed appId in Session.join()");if("string"!=typeof e.password||!e.password)throw Error("Croquet: no password provided in Session.join()");const n=Y.reflector||e.reflector;if(n&&(n.includes("://")||n.match(/^[-a-z0-9]+$/i)?Y.reflector=n:console.warn(`Croquet: Not a valid websocket url, ignoring reflector "${n}"`)),"manual"!==e.step)throw Error("stepping must be manual in a Node.js app");if("rejoinLimit"in e){if("number"!=typeof e.rejoinLimit||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error("rejoinLimit range: 0-60000")}else e.rejoinLimit=1e3;if("eventRateLimit"in e){if("number"!=typeof e.eventRateLimit||e.eventRateLimit<1||e.eventRateLimit>60)throw Error("eventRateLimit range: 1-60")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error("heraldUrl can only be 256 characters");if(!e.heraldUrl.startsWith("https://"))throw Error("heraldUrl needs to be https")}if(e.hashOverride){if(43!==e.hashOverride.length)throw Error("hashOverride must be 43 characters");if(-1!==e.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error("hashOverride must be base64url encoded")}if(e.debug){function p(e){return"string"==typeof e&&(e=e.split(",")),e?Array.isArray(e)?e:[e]:[]}Y.debug=[...p(e.debug),...p(Y.debug)].join(",")}if("autoSleep"in e){const m=e.autoSleep,b=typeof m;if("number"===b){if(m<0)throw Error("an autoSleep value must be >= 0")}else{if("boolean"!==b)throw Error("autoSleep must be numeric or boolean");e.autoSleep=m?10:0}}else e.autoSleep=10;if(e.flags){let y=e.flags;"string"==typeof y&&(y=y.split(",")),y=y?Array.isArray(y)?y:[y]:[],y=y.filter((e=>"object"!=typeof e)),y.length?(e.flags={},y.forEach((t=>e.flags[t]=!0))):e.flags=null}"expectedSimFPS"in e&&(eu=Math.min(e.expectedSimFPS,120));const i=["name","password","apiKey","appId","tps","autoSleep","heraldUrl","rejoinLimit","eventRateLimit","optionsFromUrl","viewIdDebugSuffix","hashOverride","flags"];!function(){if(Object.isFrozen(ru))return;su(ru),function(e){const t=JSON.stringify(e,((e,t)=>"function"==typeof t?Q(t):t));if("{}"===t)return;const r=JSON.parse(t),s=$(E(r));q.push(s),D()&&s.then((e=>{B[e].what="Croquet Constants"}))}(ru)}();const o=new oh,a=JSON.parse(JSON.stringify({...e.options})),l={id:"",persistentId:"",versionId:"",model:null,view:null,step(e){o.stepSession("animation",{frameTime:e,view:l.view,expectedSimFPS:eu})},leave:()=>tu.leave(l.id),get latency(){return o.latency},get latencies(){return o.latencies}},c={options:a,initFn:(e,t)=>r.create(e,t,"modelRoot"),rebootModelView:h};for(const[g,w]of Object.entries(e))i.includes(g)&&(c[g]=w);await o.initFromSessionSpec(c);let d=!1;return await h(),"manual"!==e.step&&o.startStepping(l.step),l;async function h(){!function(){l.model=null,l.view&&(Y.has("debug","session",!1)&&console.log(l.id,"detaching root view"),l.view.detach(),""!==l.view.id&&console.warn(`Croquet: ${l.view} did not call super.detach()`),l.view=null);oe.clearSessionMoniker(),qh.ready&&qh.detach()}(),o.leaving?o.leaving(!0):d||(d=!0,await o.establishSession(c),d=!1,l.model=o.vm.get("modelRoot"),l.id=o.id,l.persistentId=o.persistentId,l.versionId=o.versionId,o.session=l,oe.makeSessionWidgets(l.id),o.inViewRealm((()=>{Y.has("debug","session",!1)&&console.log(l.id,"creating root view"),l.view=new s(l.model)})))}}static async leave(e){const t=function(e){for(const t of nh)if(t.id===e)return t;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);const r=new Promise((e=>t.leaving=e)),s=t.connection;return!!s.connected&&(s.closeConnection(1e3),r)}static thisSession(){const e=Rh.current();return e?e.id:""}}const ru={};function su(e){if(!Object.isFrozen(e)){Object.freeze(e);for(const t of Object.values(e))!t||"object"!=typeof t&&"function"!=typeof t||su(t)}}let nu=0;const iu={START_BOUNDARY:nu++,HEADER_FIELD_START:nu++,HEADER_FIELD:nu++,HEADER_VALUE_START:nu++,HEADER_VALUE:nu++,HEADER_VALUE_ALMOST_DONE:nu++,HEADERS_ALMOST_DONE:nu++,PART_DATA_START:nu++,PART_DATA:nu++,END:nu++};let ou=1;const au=ou,lu=ou*=2,cu=e=>32|e,du=()=>{};class hu{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=du,this.onHeaderField=du,this.onHeadersEnd=du,this.onHeaderValue=du,this.onPartBegin=du,this.onPartData=du,this.onPartEnd=du,this.boundaryChars={},e="\r\n--"+e;const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=iu.START_BOUNDARY}write(e){let t=0;const r=e.length;let s=this.index,{lookbehind:n,boundary:i,boundaryChars:o,index:a,state:l,flags:c}=this;const d=this.boundary.length,h=d-1,u=e.length;let f,p;const m=e=>{this[e+"Mark"]=t},b=e=>{delete this[e+"Mark"]},y=(e,t,r,s)=>{void 0!==t&&t===r||this[e](s&&s.subarray(t,r))},g=(r,s)=>{const n=r+"Mark";n in this&&(s?(y(r,this[n],t,e),delete this[n]):(y(r,this[n],e.length,e),this[n]=0))};for(t=0;t<r;t++)switch(f=e[t],l){case iu.START_BOUNDARY:if(a===i.length-2){if(45===f)c|=lu;else if(13!==f)return;a++;break}if(a-1==i.length-2){if(c&lu&&45===f)l=iu.END,c=0;else{if(c&lu||10!==f)return;a=0,y("onPartBegin"),l=iu.HEADER_FIELD_START}break}f!==i[a+2]&&(a=-2),f===i[a+2]&&a++;break;case iu.HEADER_FIELD_START:l=iu.HEADER_FIELD,m("onHeaderField"),a=0;case iu.HEADER_FIELD:if(13===f){b("onHeaderField"),l=iu.HEADERS_ALMOST_DONE;break}if(a++,45===f)break;if(58===f){if(1===a)return;g("onHeaderField",!0),l=iu.HEADER_VALUE_START;break}if(p=cu(f),p<97||p>122)return;break;case iu.HEADER_VALUE_START:if(32===f)break;m("onHeaderValue"),l=iu.HEADER_VALUE;case iu.HEADER_VALUE:13===f&&(g("onHeaderValue",!0),y("onHeaderEnd"),l=iu.HEADER_VALUE_ALMOST_DONE);break;case iu.HEADER_VALUE_ALMOST_DONE:if(10!==f)return;l=iu.HEADER_FIELD_START;break;case iu.HEADERS_ALMOST_DONE:if(10!==f)return;y("onHeadersEnd"),l=iu.PART_DATA_START;break;case iu.PART_DATA_START:l=iu.PART_DATA,m("onPartData");case iu.PART_DATA:if(s=a,0===a){for(t+=h;t<u&&!(e[t]in o);)t+=d;t-=h,f=e[t]}if(a<i.length)i[a]===f?(0===a&&g("onPartData",!0),a++):a=0;else if(a===i.length)a++,13===f?c|=au:45===f?c|=lu:a=0;else if(a-1===i.length)if(c&au){if(a=0,10===f){c&=~au,y("onPartEnd"),y("onPartBegin"),l=iu.HEADER_FIELD_START;break}}else c&lu&&45===f?(y("onPartEnd"),l=iu.END,c=0):a=0;if(a>0)n[a-1]=f;else if(s>0){const e=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);y("onPartData",0,s,e),s=0,m("onPartData"),t--}break;case iu.END:break;default:throw new Error(`Unexpected state entered: ${l}`)}g("onHeaderField"),g("onHeaderValue"),g("onPartData"),this.index=a,this.state=l,this.flags=c}end(){if(this.state===iu.HEADER_FIELD_START&&0===this.index||this.state===iu.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==iu.END)throw new Error("MultipartParser.end(): stream ended unexpectedly")}}var uu=Object.freeze({__proto__:null,toFormData:async function(e,t){if(!/multipart/i.test(t))throw new TypeError("Failed to fetch");const r=t.match(/boundary=(?:"([^"]+)"|([^;]+))/i);if(!r)throw new TypeError("no or bad content-type header, no multipart boundary");const s=new hu(r[1]||r[2]);let n,i,o,a,l,c;const d=[],h=new ld,u=e=>{o+=b.decode(e,{stream:!0})},f=e=>{d.push(e)},p=()=>{const e=new qc(d,c,{type:l});h.append(a,e)},m=()=>{h.append(a,o)},b=new TextDecoder("utf-8");b.decode(),s.onPartBegin=function(){s.onPartData=u,s.onPartEnd=m,n="",i="",o="",a="",l="",c=null,d.length=0},s.onHeaderField=function(e){n+=b.decode(e,{stream:!0})},s.onHeaderValue=function(e){i+=b.decode(e,{stream:!0})},s.onHeaderEnd=function(){if(i+=b.decode(),n=n.toLowerCase(),"content-disposition"===n){const e=i.match(/\bname=("([^"]*)"|([^()<>@,;:\\"/[\]?={}\s\t]+))/i);e&&(a=e[2]||e[3]||""),c=function(e){const t=e.match(/\bfilename=("(.*?)"|([^()<>@,;:\\"/[\]?={}\s\t]+))($|;\s)/i);if(!t)return;const r=t[2]||t[3]||"";let s=r.slice(r.lastIndexOf("\\")+1);return s=s.replace(/%22/g,'"'),s=s.replace(/&#(\d{4});/g,((e,t)=>String.fromCharCode(t))),s}(i),c&&(s.onPartData=f,s.onPartEnd=p)}else"content-type"===n&&(l=i);i="",n=""};for await(const t of e)s.write(t);return s.end(),h}});exports.App=oe,exports.Constants=ru,exports.Data=bh,exports.Messenger=qh,exports.Model=Oh,exports.Session=tu,exports.View=$h,exports.gatherInternalClassTypes=function(e,t){const r={};return Fh({root:e},t,r,new Set),r},exports.startSession=function(...e){return oe.showMessage("Croquet.startSession() is deprecated, please use Croquet.Session.join()",{level:"warning",only:"once"}),tu.join(...e)};

